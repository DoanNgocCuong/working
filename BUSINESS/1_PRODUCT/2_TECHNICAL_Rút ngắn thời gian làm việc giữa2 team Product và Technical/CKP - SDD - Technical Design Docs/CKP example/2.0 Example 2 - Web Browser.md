# ðŸ” PHÃ‚N TÃCH KIáº¾N TRÃšC CHI TIáº¾T BROWSER-USE

## Má»¥c lá»¥c

1. [Tá»•ng quan dá»± Ã¡n](https://claude.ai/chat/48c81a80-bd63-423c-8077-bb3e0e4fd110#1-t%E1%BB%95ng-quan-d%E1%BB%B1-%C3%A1n)
2. [Kiáº¿n trÃºc High-Level](https://claude.ai/chat/48c81a80-bd63-423c-8077-bb3e0e4fd110#2-ki%E1%BA%BFn-tr%C3%BAc-high-level)
3. [Kiáº¿n trÃºc Mid-Level](https://claude.ai/chat/48c81a80-bd63-423c-8077-bb3e0e4fd110#3-ki%E1%BA%BFn-tr%C3%BAc-mid-level)
4. [Kiáº¿n trÃºc Low-Level](https://claude.ai/chat/48c81a80-bd63-423c-8077-bb3e0e4fd110#4-ki%E1%BA%BFn-tr%C3%BAc-low-level)
5. [Data Flow & Sequence Diagrams](https://claude.ai/chat/48c81a80-bd63-423c-8077-bb3e0e4fd110#5-data-flow--sequence-diagrams)
6. [Cáº¥u trÃºc thÆ° má»¥c](https://claude.ai/chat/48c81a80-bd63-423c-8077-bb3e0e4fd110#6-c%E1%BA%A5u-tr%C3%BAc-th%C6%B0-m%E1%BB%A5c)
7. [TÃ­ch há»£p vÃ  má»Ÿ rá»™ng](https://claude.ai/chat/48c81a80-bd63-423c-8077-bb3e0e4fd110#7-t%C3%ADch-h%E1%BB%A3p-v%C3%A0-m%E1%BB%9F-r%E1%BB%99ng)

---

## 1. Tá»•ng quan dá»± Ã¡n

### 1.1 Má»¥c Ä‘Ã­ch

**Browser-Use** lÃ  má»™t thÆ° viá»‡n Python mÃ£ nguá»“n má»Ÿ cho phÃ©p cÃ¡c **AI Agent** (Ä‘Æ°á»£c Ä‘iá»u khiá»ƒn bá»Ÿi LLM) tÆ°Æ¡ng tÃ¡c vá»›i trÃ¬nh duyá»‡t web thÃ´ng qua ngÃ´n ngá»¯ tá»± nhiÃªn. Dá»± Ã¡n giáº£i quyáº¿t bÃ i toÃ¡n: "LÃ m sao Ä‘á»ƒ AI cÃ³ thá»ƒ browse web nhÆ° con ngÆ°á»i?"

### 1.2 CÃ¡c tÃ­nh nÄƒng chÃ­nh

- **LLM-Orchestrated Automation**: Agent nháº­n task báº±ng ngÃ´n ngá»¯ tá»± nhiÃªn vÃ  tá»± Ä‘á»™ng thá»±c hiá»‡n
- **Multi-model Integration**: Há»— trá»£ OpenAI, Anthropic, Google Gemini, DeepSeek, Ollama
- **Vision Support**: Agent cÃ³ thá»ƒ "nhÃ¬n" webpage qua screenshots
- **Memory Management**: Theo dÃµi session dÃ i qua nhiá»u pages
- **Modular DOM Extraction**: Parse Ä‘á»™ng vÃ  hiá»ƒu UI webpage
- **Custom Tools**: Cho phÃ©p thÃªm tools/actions tÃ¹y chá»‰nh

### 1.3 Use Cases

- Tá»± Ä‘á»™ng Ä‘iá»n form, apply job
- Thu tháº­p dá»¯ liá»‡u tá»« web
- E-commerce automation (so sÃ¡nh giÃ¡, thÃªm vÃ o giá»)
- Lead management (CRM integration)
- Testing vÃ  monitoring websites

---

## 2. Kiáº¿n trÃºc High-Level

### 2.1 Tá»•ng quan kiáº¿n trÃºc 3 lá»›p

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     USER / APPLICATION LAYER                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   CLI/API    â”‚  â”‚   Web UI     â”‚  â”‚   Python Scripts     â”‚  â”‚
â”‚  â”‚   Interface  â”‚  â”‚   (Gradio)   â”‚  â”‚   (examples/)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                 â”‚                     â”‚
          â–¼                 â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AGENT ORCHESTRATION LAYER                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        AGENT                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚   Brain     â”‚  â”‚   Memory    â”‚  â”‚   Controller    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ (AgentBrain)â”‚  â”‚   Manager   â”‚  â”‚   (Registry)    â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              MESSAGE MANAGER / LLM INTEGRATION             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚ â”‚
â”‚  â”‚  â”‚  System Prompt  â”‚  â”‚  LLM Clients   â”‚                 â”‚ â”‚
â”‚  â”‚  â”‚    Generator    â”‚  â”‚ (LangChain)    â”‚                 â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BROWSER AUTOMATION LAYER                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      BROWSER                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  BrowserConfig  â”‚  â”‚     BrowserContext          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  (settings)     â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚     DOMService        â”‚  â”‚  â”‚   â”‚
â”‚  â”‚                       â”‚  â”‚  (DOM Tree Builder)   â”‚  â”‚  â”‚   â”‚
â”‚  â”‚                       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚   â”‚
â”‚  â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    PLAYWRIGHT ENGINE                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚  Chromium   â”‚  â”‚   Firefox   â”‚  â”‚     WebKit      â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 CÃ¡c thÃ nh pháº§n chÃ­nh

|Component|Vai trÃ²|Dependencies|
|---|---|---|
|**Agent**|Äiá»u phá»‘i toÃ n bá»™ workflow|LLM, Browser, Controller|
|**Browser**|Quáº£n lÃ½ browser instances|Playwright, BrowserConfig|
|**BrowserContext**|Session browser cÃ´ láº­p|DOMService, Page|
|**Controller/Registry**|ÄÄƒng kÃ½ vÃ  quáº£n lÃ½ actions|Action models|
|**MessageManager**|Quáº£n lÃ½ conversation vá»›i LLM|SystemPrompt, Memory|
|**DOMService**|Extract vÃ  phÃ¢n tÃ­ch DOM|Playwright Page|

---

## 3. Kiáº¿n trÃºc Mid-Level

### 3.1 Agent Core Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              AGENT                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                        INITIALIZATION                          â”‚ â”‚
â”‚  â”‚  â€¢ task: str              â€¢ llm: BaseChatModel                â”‚ â”‚
â”‚  â”‚  â€¢ browser: Browser       â€¢ controller: Controller             â”‚ â”‚
â”‚  â”‚  â€¢ use_vision: bool       â€¢ sensitive_data: Dict              â”‚ â”‚
â”‚  â”‚  â€¢ initial_actions: List  â€¢ max_failures: int                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    AgentState       â”‚  â”‚         AgentHistoryList            â”‚  â”‚
â”‚  â”‚  â”œâ”€ agent_id        â”‚  â”‚  â”œâ”€ history: List[AgentHistory]    â”‚  â”‚
â”‚  â”‚  â”œâ”€ n_steps         â”‚  â”‚  â”œâ”€ is_done()                      â”‚  â”‚
â”‚  â”‚  â”œâ”€ consecutive_    â”‚  â”‚  â”œâ”€ is_successful()                â”‚  â”‚
â”‚  â”‚  â”‚   failures       â”‚  â”‚  â”œâ”€ final_result()                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ last_result     â”‚  â”‚  â”œâ”€ screenshots()                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ history         â”‚  â”‚  â”œâ”€ model_outputs()                â”‚  â”‚
â”‚  â”‚  â”œâ”€ paused/stopped  â”‚  â”‚  â””â”€ save_to_file()                 â”‚  â”‚
â”‚  â”‚  â””â”€ message_manager â”‚  â”‚                                     â”‚  â”‚
â”‚  â”‚     _state          â”‚  â”‚                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      CORE METHODS                              â”‚ â”‚
â”‚  â”‚  â€¢ run(max_steps)           â†’ AgentHistoryList                â”‚ â”‚
â”‚  â”‚  â€¢ step(step_info)          â†’ None                            â”‚ â”‚
â”‚  â”‚  â€¢ take_step()              â†’ (is_done, is_valid)             â”‚ â”‚
â”‚  â”‚  â€¢ get_next_action(msgs)    â†’ AgentOutput                     â”‚ â”‚
â”‚  â”‚  â€¢ multi_act(actions)       â†’ List[ActionResult]              â”‚ â”‚
â”‚  â”‚  â€¢ pause() / resume() / stop()                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Browser Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            BROWSER                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      BrowserConfig                             â”‚ â”‚
â”‚  â”‚  â€¢ wss_url / cdp_url       â†’ Remote browser connection        â”‚ â”‚
â”‚  â”‚  â€¢ browser_class           â†’ 'chromium' | 'firefox' | 'webkit'â”‚ â”‚
â”‚  â”‚  â€¢ headless: bool          â†’ Run without UI                   â”‚ â”‚
â”‚  â”‚  â€¢ disable_security        â†’ Disable CORS, CSP                â”‚ â”‚
â”‚  â”‚  â€¢ proxy: ProxySettings    â†’ Proxy configuration              â”‚ â”‚
â”‚  â”‚  â€¢ extra_browser_args      â†’ Additional launch arguments      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    BrowserContext                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚               BrowserContextConfig                       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ cookies_file         â€¢ window_width/height           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ wait_for_network_idle_page_load_time                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ wait_between_actions â€¢ highlight_elements            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ save_recording_path  â€¢ locale / user_agent           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ allowed_domains      â€¢ permissions                   â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚   Page Management    â”‚  â”‚      State Management       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ get_current_page()â”‚  â”‚  â€¢ get_state() â†’ BrowserStateâ”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ switch_to_tab()   â”‚  â”‚  â€¢ get_selector_map()       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ create_new_tab()  â”‚  â”‚  â€¢ take_screenshot()        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ close_current_tab â”‚  â”‚  â€¢ get_page_html()          â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  Navigation Actions  â”‚  â”‚     Element Location        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ navigate_to(url)  â”‚  â”‚  â€¢ get_dom_element_by_index â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ refresh_page()    â”‚  â”‚  â€¢ get_locate_element()     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ go_back()         â”‚  â”‚  â€¢ get_locate_element_by_   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ go_forward()      â”‚  â”‚     css_selector/xpath/text â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 Controller & Actions Registry

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONTROLLER / REGISTRY                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                        Controller                              â”‚ â”‚
â”‚  â”‚  â€¢ exclude_actions: list[str]   â†’ Actions to exclude          â”‚ â”‚
â”‚  â”‚  â€¢ output_model: Type[BaseModel]â†’ Custom output validation    â”‚ â”‚
â”‚  â”‚  â€¢ registry: Registry           â†’ Internal registry instance  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                        Registry                                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚              @action decorator                           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ description: str      â†’ MÃ´ táº£ action cho LLM         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ param_model           â†’ Pydantic model cho params    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ domains: list[str]    â†’ Giá»›i háº¡n domain cho action   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ page_filter           â†’ Filter theo page hiá»‡n táº¡i    â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚             Built-in Actions                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Navigation:                                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ go_to_url         â€¢ go_back         â€¢ go_forward   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Element Interaction:                                    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ click_element_by_index    â€¢ input_text             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ scroll_down/up            â€¢ hover_element          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ drag_drop                 â€¢ select_dropdown        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Content Extraction:                                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ extract_page_content      â€¢ get_element_text       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ get_dropdown_options                               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Tab Management:                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ open_new_tab             â€¢ switch_tab              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ close_tab                                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Control:                                                â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ done                     â€¢ wait                    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ send_keys                â€¢ upload_file             â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 Message & Memory Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MESSAGE MANAGER                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                  MessageManagerSettings                        â”‚ â”‚
â”‚  â”‚  â€¢ max_input_tokens: int = 128000                             â”‚ â”‚
â”‚  â”‚  â€¢ estimated_characters_per_token: int = 3                    â”‚ â”‚
â”‚  â”‚  â€¢ image_tokens: int = 800                                    â”‚ â”‚
â”‚  â”‚  â€¢ include_attributes: list[str]                              â”‚ â”‚
â”‚  â”‚  â€¢ sensitive_data: Dict[str, str]                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                  Core Methods                                  â”‚ â”‚
â”‚  â”‚  â€¢ add_state_message(state, result, step_info, use_vision)   â”‚ â”‚
â”‚  â”‚  â€¢ add_model_output(model_output: AgentOutput)               â”‚ â”‚
â”‚  â”‚  â€¢ add_plan(plan, position)                                   â”‚ â”‚
â”‚  â”‚  â€¢ get_messages() â†’ List[BaseMessage]                        â”‚ â”‚
â”‚  â”‚  â€¢ cut_messages() â†’ Truncate to fit token limits             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      MEMORY                                    â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚                   MemoryConfig                           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ memory_interval: int = 10     (steps between summary)â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ embedder_provider: 'openai'|'huggingface'|'ollama'   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ embedder_model: str                                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ vector_store_provider: 'faiss'                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ llm_instance: BaseChatModel                           â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â”‚  â€¢ create_procedural_memory(current_step)                    â”‚ â”‚
â”‚  â”‚    â†’ Consolidate messages into summarized memory             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Kiáº¿n trÃºc Low-Level

### 4.1 DOM Service & Element Tree

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DOM SERVICE                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      DOMService                                â”‚ â”‚
â”‚  â”‚  def __init__(self, page: 'Page'):                            â”‚ â”‚
â”‚  â”‚      """Initialize DOM service for a Playwright page."""      â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚  async def get_clickable_elements(                            â”‚ â”‚
â”‚  â”‚      self,                                                    â”‚ â”‚
â”‚  â”‚      highlight_elements: bool = True,                         â”‚ â”‚
â”‚  â”‚      focus_element: int = -1,                                 â”‚ â”‚
â”‚  â”‚      viewport_expansion: int = 0                              â”‚ â”‚
â”‚  â”‚  ) -> DOMState:                                               â”‚ â”‚
â”‚  â”‚      """Get clickable elements from the page DOM."""          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                     DOMState                                   â”‚ â”‚
â”‚  â”‚  element_tree: DOMElementNode    # Root cá»§a DOM tree          â”‚ â”‚
â”‚  â”‚  selector_map: SelectorMap       # Map index â†’ DOMElementNode â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   DOMElementNode                               â”‚ â”‚
â”‚  â”‚  @dataclass                                                   â”‚ â”‚
â”‚  â”‚  class DOMElementNode:                                        â”‚ â”‚
â”‚  â”‚      tag_name: str              # 'div', 'a', 'button', ...  â”‚ â”‚
â”‚  â”‚      xpath: str                 # Full XPath to element       â”‚ â”‚
â”‚  â”‚      attributes: Dict[str, str] # HTML attributes             â”‚ â”‚
â”‚  â”‚      children: List[DOMBaseNode]# Child nodes                 â”‚ â”‚
â”‚  â”‚      is_visible: bool           # Visibility status           â”‚ â”‚
â”‚  â”‚      parent: Optional[DOMElementNode]                         â”‚ â”‚
â”‚  â”‚      is_interactive: bool       # Can be clicked/input        â”‚ â”‚
â”‚  â”‚      is_top_element: bool       # Visually on top             â”‚ â”‚
â”‚  â”‚      is_in_viewport: bool       # In current viewport         â”‚ â”‚
â”‚  â”‚      shadow_root: bool          # Has shadow DOM              â”‚ â”‚
â”‚  â”‚      highlight_index: Optional[int]  # Index for highlighting â”‚ â”‚
â”‚  â”‚      viewport_coordinates: Optional[CoordinateSet]            â”‚ â”‚
â”‚  â”‚      page_coordinates: Optional[CoordinateSet]                â”‚ â”‚
â”‚  â”‚      is_new: bool | None        # New since last state update â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â”‚  Methods:                                                     â”‚ â”‚
â”‚  â”‚      get_all_text_till_next_clickable_element()              â”‚ â”‚
â”‚  â”‚      clickable_elements_to_string(include_attributes)        â”‚ â”‚
â”‚  â”‚      get_file_upload_element(check_siblings)                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   CoordinateSet                                â”‚ â”‚
â”‚  â”‚  @dataclass                                                   â”‚ â”‚
â”‚  â”‚  class CoordinateSet:                                         â”‚ â”‚
â”‚  â”‚      x: int      # X-coordinate top-left                      â”‚ â”‚
â”‚  â”‚      y: int      # Y-coordinate top-left                      â”‚ â”‚
â”‚  â”‚      width: int  # Element width                              â”‚ â”‚
â”‚  â”‚      height: int # Element height                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Agent Output & Brain Models

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AGENT OUTPUT MODELS                              â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      AgentOutput                               â”‚ â”‚
â”‚  â”‚  current_state: AgentBrain      # Thought process              â”‚ â”‚
â”‚  â”‚  action: List[ActionModel]      # Actions to execute           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                       â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚         â–¼                                         â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     AgentBrain       â”‚              â”‚     ActionModel         â”‚ â”‚
â”‚  â”‚  evaluation_previous â”‚              â”‚  (Base type cho cÃ¡c     â”‚ â”‚
â”‚  â”‚    _goal: str        â”‚              â”‚   action cá»¥ thá»ƒ)        â”‚ â”‚
â”‚  â”‚  memory: str         â”‚              â”‚                         â”‚ â”‚
â”‚  â”‚  next_goal: str      â”‚              â”‚  Examples:              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â€¢ click_element_by_    â”‚ â”‚
â”‚                                        â”‚    index(index: int)    â”‚ â”‚
â”‚                                        â”‚  â€¢ input_text(index,    â”‚ â”‚
â”‚                                        â”‚    text: str)           â”‚ â”‚
â”‚                                        â”‚  â€¢ go_to_url(url: str)  â”‚ â”‚
â”‚                                        â”‚  â€¢ done(text: str,      â”‚ â”‚
â”‚                                        â”‚    success: bool)       â”‚ â”‚
â”‚                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      ActionResult                              â”‚ â”‚
â”‚  â”‚  is_done: bool | None = False     # Task complete?            â”‚ â”‚
â”‚  â”‚  success: bool | None = None      # 'done' action success?    â”‚ â”‚
â”‚  â”‚  extracted_content: Optional[str] # Content extracted         â”‚ â”‚
â”‚  â”‚  error: Optional[str]             # Error message             â”‚ â”‚
â”‚  â”‚  include_in_memory: bool = False  # Include in memory?        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 Browser State Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BROWSER STATE                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      BrowserState                              â”‚ â”‚
â”‚  â”‚  url: str                      # Current page URL              â”‚ â”‚
â”‚  â”‚  title: str                    # Page title                    â”‚ â”‚
â”‚  â”‚  tabs: list[TabInfo]           # Open tabs                     â”‚ â”‚
â”‚  â”‚  element_tree: DOMElementNode  # DOM tree                      â”‚ â”‚
â”‚  â”‚  selector_map: SelectorMap     # Map index â†’ DOMElementNode    â”‚ â”‚
â”‚  â”‚  screenshot: Optional[str]     # Base64 encoded screenshot     â”‚ â”‚
â”‚  â”‚  pixels_above: int = 0         # Scrollable pixels above       â”‚ â”‚
â”‚  â”‚  pixels_below: int = 0         # Scrollable pixels below       â”‚ â”‚
â”‚  â”‚  browser_errors: list[str]     # Console errors                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                       TabInfo                                  â”‚ â”‚
â”‚  â”‚  page_id: int                  # Tab ID                        â”‚ â”‚
â”‚  â”‚  url: str                      # Tab URL                       â”‚ â”‚
â”‚  â”‚  title: str                    # Tab title                     â”‚ â”‚
â”‚  â”‚  parent_page_id: Optional[int] # Parent if popup/iframe        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4 History & Metadata Models

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      HISTORY MODELS                                  â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    AgentHistoryList                            â”‚ â”‚
â”‚  â”‚  history: List[AgentHistory]                                  â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚  Methods:                                                      â”‚ â”‚
â”‚  â”‚  â”œâ”€ is_done() â†’ bool                                          â”‚ â”‚
â”‚  â”‚  â”œâ”€ is_successful() â†’ bool | None                             â”‚ â”‚
â”‚  â”‚  â”œâ”€ final_result() â†’ Optional[str]                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ errors() â†’ list[str | None]                               â”‚ â”‚
â”‚  â”‚  â”œâ”€ has_errors() â†’ bool                                       â”‚ â”‚
â”‚  â”‚  â”œâ”€ urls() â†’ list[str | None]                                 â”‚ â”‚
â”‚  â”‚  â”œâ”€ screenshots() â†’ list[str | None]                          â”‚ â”‚
â”‚  â”‚  â”œâ”€ action_names() â†’ list[str]                                â”‚ â”‚
â”‚  â”‚  â”œâ”€ model_thoughts() â†’ list[AgentBrain]                       â”‚ â”‚
â”‚  â”‚  â”œâ”€ model_outputs() â†’ list[AgentOutput]                       â”‚ â”‚
â”‚  â”‚  â”œâ”€ total_duration_seconds() â†’ float                          â”‚ â”‚
â”‚  â”‚  â”œâ”€ total_input_tokens() â†’ int                                â”‚ â”‚
â”‚  â”‚  â”œâ”€ save_to_file(filepath)                                    â”‚ â”‚
â”‚  â”‚  â”œâ”€ load_from_file(filepath, output_model)                    â”‚ â”‚
â”‚  â”‚  â””â”€ save_as_playwright_script(output_path, ...)               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      AgentHistory                              â”‚ â”‚
â”‚  â”‚  model_output: Optional[AgentOutput]   # Thoughts & actions   â”‚ â”‚
â”‚  â”‚  result: List[ActionResult]            # Action results       â”‚ â”‚
â”‚  â”‚  state: BrowserStateHistory            # Browser state        â”‚ â”‚
â”‚  â”‚  metadata: Optional[StepMetadata]      # Timing & tokens      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      StepMetadata                              â”‚ â”‚
â”‚  â”‚  step_start_time: float                                       â”‚ â”‚
â”‚  â”‚  step_end_time: float                                         â”‚ â”‚
â”‚  â”‚  input_tokens: int          # Approximate tokens for step     â”‚ â”‚
â”‚  â”‚  step_number: int                                             â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚  @property                                                    â”‚ â”‚
â”‚  â”‚  def duration_seconds(self) â†’ float                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Data Flow & Sequence Diagrams

### 5.1 Agent Run Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User   â”‚     â”‚  Agent   â”‚     â”‚  Browser    â”‚     â”‚   LLM    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                â”‚                  â”‚                 â”‚
     â”‚  1. run(task)  â”‚                  â”‚                 â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚                 â”‚
     â”‚                â”‚                  â”‚                 â”‚
     â”‚                â”‚  2. get_state()  â”‚                 â”‚
     â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
     â”‚                â”‚                  â”‚                 â”‚
     â”‚                â”‚  3. BrowserState â”‚                 â”‚
     â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚
     â”‚                â”‚   (DOM, screenshot, URL)          â”‚
     â”‚                â”‚                  â”‚                 â”‚
     â”‚                â”‚  4. add_state_message()            â”‚
     â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ â”‚
     â”‚                â”‚                                   â”‚
     â”‚                â”‚  5. get_next_action(messages)     â”‚
     â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                â”‚                                     â”‚
     â”‚                â”‚  6. AgentOutput (thoughts + actions)â”‚
     â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                â”‚                  â”‚                 â”‚
     â”‚                â”‚  7. multi_act()  â”‚                 â”‚
     â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
     â”‚                â”‚                  â”‚                 â”‚
     â”‚                â”‚  8. ActionResult â”‚                 â”‚
     â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚
     â”‚                â”‚                  â”‚                 â”‚
     â”‚                â”‚  [Repeat steps 2-8 until done]    â”‚
     â”‚                â”‚                  â”‚                 â”‚
     â”‚  9. History    â”‚                  â”‚                 â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚                 â”‚
     â”‚                â”‚                  â”‚                 â”‚
```

### 5.2 Action Execution Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ACTION EXECUTION FLOW                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LLM Output:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ {                                                                 â”‚
â”‚   "current_state": {                                             â”‚
â”‚     "evaluation_previous_goal": "Successfully opened Google",    â”‚
â”‚     "memory": "Task: Search for Python tutorials",               â”‚
â”‚     "next_goal": "Type search query in search box"               â”‚
â”‚   },                                                             â”‚
â”‚   "action": [                                                    â”‚
â”‚     {                                                            â”‚
â”‚       "input_text": {                                            â”‚
â”‚         "index": 5,                                              â”‚
â”‚         "text": "Python tutorials"                               â”‚
â”‚       }                                                          â”‚
â”‚     },                                                           â”‚
â”‚     {                                                            â”‚
â”‚       "click_element_by_index": {                                â”‚
â”‚         "index": 12                                              â”‚
â”‚       }                                                          â”‚
â”‚     }                                                            â”‚
â”‚   ]                                                              â”‚
â”‚ }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CONTROLLER                                   â”‚
â”‚  1. Parse action tá»« AgentOutput                                  â”‚
â”‚  2. Validate params vá»›i Pydantic model                           â”‚
â”‚  3. Check domain/page filter                                     â”‚
â”‚  4. Execute action via Registry                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BROWSER CONTEXT                                â”‚
â”‚  1. Get element by index tá»« selector_map                         â”‚
â”‚  2. Locate Playwright ElementHandle                              â”‚
â”‚  3. Execute Playwright action (click, type, etc.)                â”‚
â”‚  4. Wait for page load / network idle                            â”‚
â”‚  5. Return ActionResult                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 DOM Extraction Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DOM EXTRACTION FLOW                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

get_state() called
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DOMService           â”‚
â”‚ get_clickable_       â”‚
â”‚ elements()           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                JavaScript Injection                               â”‚
â”‚  â€¢ Query all elements in DOM                                     â”‚
â”‚  â€¢ Filter interactive elements (buttons, links, inputs, etc.)   â”‚
â”‚  â€¢ Calculate visibility, viewport position                       â”‚
â”‚  â€¢ Build element metadata (xpath, attributes, coordinates)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ _build_dom_tree()    â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ DOMElementNode Tree         â”‚
â”‚                      â”‚         â”‚ â”œâ”€ <body>                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â”‚  â”œâ”€ <header> [idx: 1]     â”‚
                                 â”‚ â”‚  â”‚  â””â”€ <nav>              â”‚
                                 â”‚ â”‚  â”œâ”€ <main>                â”‚
                                 â”‚ â”‚  â”‚  â”œâ”€ <form>             â”‚
                                 â”‚ â”‚  â”‚  â”‚  â”œâ”€ <input> [idx: 5]â”‚
                                 â”‚ â”‚  â”‚  â”‚  â””â”€ <button>[idx:12]â”‚
                                 â”‚ â”‚  â”‚  â””â”€ ...                â”‚
                                 â”‚ â”‚  â””â”€ <footer>              â”‚
                                 â”‚ â””â”€ ...                      â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ selector_map:        â”‚
â”‚ {                    â”‚
â”‚   1: DOMElementNode, â”‚  â† header element
â”‚   5: DOMElementNode, â”‚  â† input element
â”‚   12: DOMElementNode â”‚  â† button element
â”‚ }                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Highlight Elements (if enabled)                                   â”‚
â”‚  â€¢ Inject CSS overlays vá»›i index numbers                         â”‚
â”‚  â€¢ Visual feedback cho debugging                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Return:              â”‚
â”‚ BrowserState {       â”‚
â”‚   url, title, tabs,  â”‚
â”‚   element_tree,      â”‚
â”‚   selector_map,      â”‚
â”‚   screenshot,        â”‚
â”‚   pixels_above/below â”‚
â”‚ }                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Cáº¥u trÃºc thÆ° má»¥c

```
browser-use/
â”œâ”€â”€ browser_use/                    # Main package
â”‚   â”œâ”€â”€ __init__.py                 # Package exports
â”‚   â”œâ”€â”€ agent/                      # Agent module
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ service.py              # Agent class implementation
â”‚   â”‚   â”œâ”€â”€ views.py                # AgentHistory, AgentOutput, etc.
â”‚   â”‚   â”œâ”€â”€ prompts.py              # SystemPrompt class
â”‚   â”‚   â””â”€â”€ message_manager/        # Message handling
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ service.py          # MessageManager class
â”‚   â”‚       â””â”€â”€ views.py            # MessageManagerSettings, etc.
â”‚   â”‚
â”‚   â”œâ”€â”€ browser/                    # Browser module
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ browser.py              # Browser class
â”‚   â”‚   â”œâ”€â”€ context.py              # BrowserContext class
â”‚   â”‚   â””â”€â”€ views.py                # BrowserConfig, BrowserState, etc.
â”‚   â”‚
â”‚   â”œâ”€â”€ controller/                 # Controller module
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ registry/               # Action registry
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ views.py            # Registry class, decorators
â”‚   â”‚   â””â”€â”€ views.py                # Controller class
â”‚   â”‚
â”‚   â”œâ”€â”€ dom/                        # DOM module
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ service.py              # DOMService class
â”‚   â”‚   â”œâ”€â”€ views.py                # DOMElementNode, DOMState, etc.
â”‚   â”‚   â””â”€â”€ extraction.js           # JS injection for DOM extraction
â”‚   â”‚
â”‚   â”œâ”€â”€ memory/                     # Memory module
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ service.py              # Memory class
â”‚   â”‚   â””â”€â”€ views.py                # MemoryConfig
â”‚   â”‚
â”‚   â””â”€â”€ utils/                      # Utilities
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ examples/                       # Example scripts
â”‚   â”œâ”€â”€ getting_started/            # Basic examples
â”‚   â”œâ”€â”€ features/                   # Feature demonstrations
â”‚   â”œâ”€â”€ use-cases/                  # Real-world use cases
â”‚   â”‚   â”œâ”€â”€ apply_to_job.py
â”‚   â”‚   â”œâ”€â”€ buy_groceries.py
â”‚   â”‚   â””â”€â”€ pcpartpicker.py
â”‚   â””â”€â”€ browser/
â”‚       â””â”€â”€ real_browser.py         # Using existing browser profile
â”‚
â”œâ”€â”€ tests/                          # Test suite
â”‚   â”œâ”€â”€ test_agent.py
â”‚   â”œâ”€â”€ test_browser.py
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ docs/                           # Documentation
â”œâ”€â”€ docker/                         # Docker configurations
â”œâ”€â”€ static/                         # Static assets
â”œâ”€â”€ pyproject.toml                  # Project configuration
â”œâ”€â”€ Dockerfile                      # Main Dockerfile
â”œâ”€â”€ README.md
â”œâ”€â”€ AGENTS.md                       # LLM agent documentation
â”œâ”€â”€ CLAUDE.md                       # Claude-specific docs
â””â”€â”€ CLOUD.md                        # Cloud deployment docs
```

---

## 7. TÃ­ch há»£p vÃ  má»Ÿ rá»™ng

### 7.1 Custom Actions

```python
from browser_use import Tools

tools = Tools()

@tools.action(description='Search for products on the current page')
def search_products(query: str) -> str:
    """Custom action to search products."""
    return f"Searching for: {query}"

@tools.action(
    description='Add item to cart',
    domains=['amazon.com', 'ebay.com']  # Chá»‰ hoáº¡t Ä‘á»™ng trÃªn domains nÃ y
)
async def add_to_cart(product_id: str, quantity: int = 1) -> str:
    """Add item to shopping cart."""
    # Implementation
    return f"Added {quantity} of {product_id} to cart"

# Sá»­ dá»¥ng
agent = Agent(
    task="Your task",
    llm=llm,
    browser=browser,
    tools=tools,
)
```

### 7.2 LLM Integration

```python
# OpenAI
from langchain_openai import ChatOpenAI
llm = ChatOpenAI(model='gpt-4o')

# Anthropic
from langchain_anthropic import ChatAnthropic
llm = ChatAnthropic(model='claude-3-5-sonnet')

# Google
from langchain_google_genai import ChatGoogleGenerativeAI
llm = ChatGoogleGenerativeAI(model='gemini-2.0-flash-exp')

# Browser Use Cloud (optimized)
from browser_use import ChatBrowserUse
llm = ChatBrowserUse()

# Ollama (local)
from langchain_ollama import ChatOllama
llm = ChatOllama(model='llama3.2')
```

### 7.3 Browser Profiles & Authentication

```python
from browser_use import Browser, BrowserConfig, BrowserContextConfig

# Sá»­ dá»¥ng existing Chrome profile
config = BrowserConfig(
    chrome_user_data_dir='/path/to/chrome/profile',
    headless=False,
)

# Vá»›i cookies persistence
context_config = BrowserContextConfig(
    cookies_file='cookies.json',
    save_recording_path='recordings/',
)

browser = Browser(config=config)
context = await browser.new_context(config=context_config)
```

### 7.4 Cloud Deployment (Sandbox)

```python
from browser_use import Browser, sandbox, ChatBrowserUse
from browser_use.agent.service import Agent

@sandbox()
async def my_task(browser: Browser):
    agent = Agent(
        task="Find the top HN post",
        browser=browser,
        llm=ChatBrowserUse()
    )
    await agent.run()

# Run nhÆ° má»™t async function bÃ¬nh thÆ°á»ng
asyncio.run(my_task())
```

---

## 8. Káº¿t luáº­n

### 8.1 Äiá»ƒm máº¡nh cá»§a kiáº¿n trÃºc

- **Modular Design**: CÃ¡c components tÃ¡ch biá»‡t rÃµ rÃ ng, dá»… test vÃ  má»Ÿ rá»™ng
- **Flexible LLM Integration**: Há»— trá»£ nhiá»u LLM providers qua LangChain
- **Robust DOM Handling**: DOM extraction thÃ´ng minh vá»›i highlighting vÃ  viewport tracking
- **Memory Management**: Há»— trá»£ long-running sessions vá»›i procedural memory
- **Production Ready**: Cloud deployment, recordings, error handling Ä‘áº§y Ä‘á»§

### 8.2 CÃ¡c patterns chÃ­nh

- **Agent Loop Pattern**: ReAct (Reasoning + Acting) loop
- **Observer Pattern**: Callbacks cho step events
- **Registry Pattern**: Dynamic action registration
- **State Machine**: Agent state management (running, paused, stopped)
- **Chain of Responsibility**: Message pipeline processing

### 8.3 Recommended Reading

- [Official Documentation](https://docs.browser-use.com/)
- [GitHub Repository](https://github.com/browser-use/browser-use)
- [API Reference](https://evgeny-kim.github.io/browser-use-docs/api-reference.html)
- [Examples](https://github.com/browser-use/browser-use/tree/main/examples)