```mermaid
graph TD
    User["ğŸ‘¤ Financial Analyst<br/>(User)"]
    UI["ğŸ–¥ï¸ Web UI Dashboard<br/>(React/TypeScript)"]
    Socket["âš¡ WebSocket Client<br/>(Real-time Feedback)"]
    API["ğŸš€ API Gateway<br/>(FastAPI)"]
    Auth["ğŸ›¡ï¸ Auth & Rate Limit"]
    
    State["ğŸ§  Shared State<br/>(Messages, Plan, Context)"]
    M1["Module 1:<br/>Input & Ingestion<br/>(Validation/Safety)"]
    M2["Module 2:<br/>Query Understanding<br/>(Intent/Context)"]
    M3["Module 3:<br/>Router & Planner<br/>(Task Decomposition)"]
    M4["Module 4:<br/>Browser Agent<br/>(Action Execution)"]
    M5["Module 5:<br/>Reasoning<br/>(Evidence Analysis)"]
    M6["Module 6:<br/>Synthesis<br/>(Final Answer)"]
    
    PW["âš™ï¸ Playwright Controller"]
    TreeParser["ğŸŒ³ DOM / A11y Tree Parser<br/>(Primary: 90%)"]
    Vision["ğŸ‘ï¸ Vision Engine<br/>(Fallback: 10%)"]
    Chrome["ğŸŒ Headless Chromium"]
    
    LLM["ğŸ¤– LLM Service<br/>(GPT-4 / Claude)"]
    DB["ğŸ—„ï¸ PostgreSQL<br/>(User Data)"]
    Redis["âš¡ Redis<br/>(Cache/Queue)"]
    
    %% Client Flow
    User -->|interact| UI
    UI <-->|WebSocket| Socket
    UI -->|REST/JSON| API
    Socket <-->|Real-time| API
    API -->|Auth check| Auth
    API -->|invoke| M1
    
    %% Agent Flow
    M1 -->|process| M2
    M2 -->|analyze| M3
    M3 -->|plan| M4
    M4 -->|retry/loop| M4
    M4 -->|collected| M5
    M5 -->|evidence| M6
    M6 -->|response| API
    
    %% State connections
    State -.->|read/write| M1
    State -.->|read/write| M2
    State -.->|read/write| M3
    State -.->|read/write| M4
    State -.->|read/write| M5
    State -.->|read/write| M6
    
    %% Browser interaction
    M4 -->|commands| PW
    PW -->|control| Chrome
    Chrome -->|HTML| TreeParser
    Chrome -->|screenshot| Vision
    TreeParser -->|structured data| M4
    Vision -->|coordinates| M4
    
    %% Human approval loop
    M3 -.->|âš ï¸ Plan Review| UI
    M4 -.->|âš ï¸ Approval Req| UI
    
    %% External services
    M1 -.->|LLM call| LLM
    M2 -.->|LLM call| LLM
    M3 -.->|LLM call| LLM
    M4 -.->|LLM call| LLM
    M5 -.->|LLM call| LLM
    M6 -.->|LLM call| LLM
    
    %% Data persistence
    State -->|persist| DB
    State -->|cache| Redis
    
    %% Styling
    classDef actor fill:#ffdfba,stroke:#333,stroke-width:2px
    classDef frontend fill:#baffc9,stroke:#333,stroke-width:2px
    classDef backend fill:#bae1ff,stroke:#333,stroke-width:2px
    classDef agent fill:#ffffba,stroke:#d4a017,stroke-width:2px
    classDef module fill:#ffffff,stroke:#333,stroke-width:2px
    classDef browser fill:#eecbff,stroke:#333,stroke-width:2px
    classDef external fill:#e2e2e2,stroke:#333,stroke-width:2px
    classDef db fill:#ffb3ba,stroke:#333,stroke-width:2px
    
    class User actor
    class UI,Socket frontend
    class API,Auth backend
    class State,M1,M2,M3,M4,M5,M6 agent
    class PW,TreeParser,Vision,Chrome browser
    class LLM external
    class DB,Redis db


```


```mermaid
graph TD
    root["ğŸ“ finai-agent-browser/"]
    
    root --> backend["ğŸ“ backend/"]
    root --> frontend["ğŸ“ frontend/"]
    root --> agent["ğŸ“ agent/"]
    root --> browser["ğŸ“ browser/"]
    root --> common["ğŸ“ common/"]
    root --> tests["ğŸ“ tests/"]
    root --> config["ğŸ“ config/"]
    root --> docs["ğŸ“ docs/"]
    root --> scripts["ğŸ“ scripts/"]
    root --> files1["ğŸ“„ pyproject.toml<br/>ğŸ“„ package.json<br/>ğŸ“„ docker-compose.yml"]
    
    %% Backend
    backend --> app["ğŸ“ app/"]
    app --> api["ğŸ“ api/"]
    app --> services["ğŸ“ services/"]
    app --> models["ğŸ“ models/"]
    app --> db["ğŸ“ db/"]
    api --> routes["ğŸ“ routes/"]
    routes --> r1["ğŸ“„ agent.py<br/>ğŸ“„ chat.py"]
    services --> s1["ğŸ“„ agent_service.py<br/>ğŸ“„ browser_service.py<br/>ğŸ“„ llm_service.py"]
    models --> m1["ğŸ“„ agent.py<br/>ğŸ“„ chat.py"]
    db --> d1["ğŸ“„ connection.py<br/>ğŸ“„ models.py"]
    
    %% Frontend
    frontend --> src["ğŸ“ src/"]
    src --> components["ğŸ“ components/"]
    src --> pages["ğŸ“ pages/"]
    src --> hooks["ğŸ“ hooks/"]
    src --> services_fe["ğŸ“ services/"]
    src --> stores["ğŸ“ stores/"]
    components --> c1["ğŸ“ chat/<br/>ğŸ“ browser/<br/>ğŸ“ layout/"]
    
    %% Agent
    agent --> orchestrator["ğŸ“„ orchestrator.py"]
    agent --> state["ğŸ“ state/"]
    agent --> nodes["ğŸ“ nodes/"]
    agent --> tools["ğŸ“ tools/"]
    agent --> prompts["ğŸ“ prompts/"]
    agent --> guards["ğŸ“ guards/"]
    agent --> llm["ğŸ“ llm/"]
    nodes --> n1["ğŸ“„ input_ingestion.py<br/>ğŸ“„ query_understanding.py<br/>ğŸ“„ browser_agent.py<br/>ğŸ“„ reasoning.py<br/>ğŸ“„ synthesis.py"]
    tools --> t1["ğŸ“„ registry.py<br/>ğŸ“„ browser_tools.py<br/>ğŸ“„ search_tools.py"]
    guards --> g1["ğŸ“„ input_guard.py<br/>ğŸ“„ safety_guard.py"]
    llm --> l1["ğŸ“„ provider.py<br/>ğŸ“„ openai_client.py"]
    
    %% Browser
    browser --> controller["ğŸ“„ controller.py"]
    browser --> client["ğŸ“ client/"]
    browser --> dom["ğŸ“ dom/"]
    browser --> a11y["ğŸ“ a11y/"]
    browser --> vision["ğŸ“ vision/"]
    browser --> interaction["ğŸ“ interaction/"]
    browser --> security["ğŸ“ security/"]
    client --> cl1["ğŸ“„ chromium.py<br/>ğŸ“„ page.py"]
    dom --> do1["ğŸ“„ parser.py<br/>ğŸ“„ serializer.py"]
    a11y --> a1["ğŸ“„ extractor.py<br/>ğŸ“„ validator.py"]
    vision --> v1["ğŸ“„ screenshot.py"]
    interaction --> in1["ğŸ“„ actions.py<br/>ğŸ“„ keyboard.py<br/>ğŸ“„ mouse.py"]
    security --> sec1["ğŸ“„ pii_detector.py<br/>ğŸ“„ injection_guard.py"]
    
    %% Common
    common --> c_models["ğŸ“ models/"]
    common --> enums["ğŸ“ enums/"]
    common --> exceptions["ğŸ“ exceptions/"]
    common --> logging["ğŸ“ logging/"]
    
    %% Tests
    tests --> unit["ğŸ“ unit/"]
    tests --> integration["ğŸ“ integration/"]
    tests --> e2e["ğŸ“ e2e/"]
    unit --> u1["ğŸ“„ test_agent.py<br/>ğŸ“„ test_browser.py"]
    integration --> int1["ğŸ“„ test_agent_flow.py<br/>ğŸ“„ test_api.py"]
    
    %% Config
    config --> env["ğŸ“„ development.env<br/>ğŸ“„ production.env"]
    config --> llm_cfg["ğŸ“ llm/"]
    config --> db_cfg["ğŸ“ database/"]
    
    %% Docs
    docs --> doc_files["ğŸ“„ README.md<br/>ğŸ“„ ARCHITECTURE.md<br/>ğŸ“„ API.md"]
    docs --> guides["ğŸ“ guides/"]
    
    %% Scripts
    scripts --> sh["ğŸ“„ setup.sh<br/>ğŸ“„ dev.sh<br/>ğŸ“„ test.sh<br/>ğŸ“„ deploy.sh"]
    scripts --> docker["ğŸ“ docker/"]
    scripts --> k8s["ğŸ“ k8s/"]
    
    style root fill:#e1f5ff
    style backend fill:#fff3e0
    style frontend fill:#f3e5f5
    style agent fill:#e8f5e9
    style browser fill:#fce4ec
    style common fill:#f1f8e9
    style tests fill:#ede7f6
    style config fill:#fff9c4
    style docs fill:#e0f2f1
    style scripts fill:#f5f5f5

```



---

```
Váº½ cho tá»› SÆ¡ Ä‘á»“ Kiáº¿n trÃºc Tá»•ng thá»ƒ (High-Level Architecture) vÃ  folder structure overview
```

TÃ´i sáº½ váº½ cho báº¡n:

1. **SÆ¡ Ä‘á»“ Kiáº¿n trÃºc Tá»•ng thá»ƒ (High-Level Architecture)**Â - dáº¡ng diagram
2. **Folder Structure Overview**Â - cáº¥u trÃºc thÆ° má»¥c chi tiáº¿t

TÃ´i sáº½ táº¡o cáº£ hai dÆ°á»›i dáº¡ng text/ASCII art vÃ  Mermaid diagrams Ä‘á»ƒ báº¡n cÃ³ thá»ƒ visualize dá»… dÃ ng.

Báº¯t Ä‘áº§u ngay!

## âœ… HoÃ n thÃ nh: SÆ¡ Ä‘á»“ Kiáº¿n trÃºc & Folder Structure

TÃ´i Ä‘Ã£ táº¡o tÃ i liá»‡u chi tiáº¿t vá»›i **894 dÃ²ng** bao gá»“m:

### ğŸ“Š Ná»™i dung TÃ i liá»‡u

#### **1. SÆ¡ Ä‘á»“ Kiáº¿n trÃºc Tá»•ng thá»ƒ (High-Level Architecture)**

- **ASCII Art Diagram:** Visualization Ä‘áº§y Ä‘á»§ cá»§a 7 layers
    
    - Frontend Layer (Web UI, Mobile, API Clients)
    - API Gateway Layer (FastAPI, Auth, Rate Limiter)
    - Orchestration Layer (LangGraph Agent vá»›i 8 tools)
    - Processing Layer (6 Modules)
    - Browser Control Layer (Playwright, A11y Tree, DOM Parser)
    - Browser Engine (Chromium)
    - External Services (OpenAI, Anthropic, LangFuse)
    - Data Layer (PostgreSQL, Redis, S3, Vector DB)
- **Mermaid Diagram:** Interactive diagram cÃ³ thá»ƒ render
    

#### **2. SÆ¡ Ä‘á»“ Luá»“ng Dá»¯ liá»‡u (Data Flow Diagram)**

- End-to-end flow tá»« user query Ä‘áº¿n final response
- VÃ­ dá»¥ cá»¥ thá»ƒ: "Find Tesla's latest earnings report"
- Chi tiáº¿t tá»«ng bÆ°á»›c qua 6 modules

#### **3. SÆ¡ Ä‘á»“ Component Chi tiáº¿t**

- **LangGraph Agent Architecture:**Â StateGraph vá»›i decision nodes
- **Browser Control Layer:**Â Playwright Controller + Page Context Extractor

#### **4. Folder Structure Overview**

- **Project Root:** Cáº¥u trÃºc tá»•ng thá»ƒ vá»›i 10+ top-level directories
    
- **Backend Structure:** Chi tiáº¿t tá»«ng file vÃ  folder
    
    - `src/api/`Â - FastAPI routes vÃ  middleware
    - `src/modules/`Â - 6 processing modules
    - `src/orchestration/`Â - LangGraph agent
    - `src/llm/`Â - LLM integrations
    - `src/database/`,Â `src/cache/`,Â `src/storage/`
    - `src/security/`,Â `src/utils/`
    - `tests/`Â - Unit, integration, e2e tests
- **Module 2 Detailed:** Cáº¥u trÃºc chi tiáº¿t cá»§a Query Understanding module
    
- **Module 4 Detailed:** Cáº¥u trÃºc chi tiáº¿t cá»§a Browser Executor module
    

#### **5. Module Dependencies**

- **Dependency Graph:**Â Mermaid diagram showing module relationships
- **Technology Stack Table:**Â Technologies cho tá»«ng layer

#### **6. Deployment Architecture**

- Production deployment trÃªn AWS
- Load Balancer â†’ API Gateway â†’ Processing Layer â†’ Browser Pool â†’ Data Layer

### ğŸ¨ Highlights

**ASCII Art Diagrams:**

- Dá»… Ä‘á»c, khÃ´ng cáº§n tools Ä‘áº·c biá»‡t
- Copy-paste vÃ o báº¥t ká»³ text editor nÃ o

**Mermaid Diagrams:**

- CÃ³ thá»ƒ render interactive trong GitHub, VS Code, Notion
- Professional-looking cho presentations

**Folder Structure:**

- Cá»±c ká»³ chi tiáº¿t, Ä‘áº¿n tá»«ng file
- MÃ´ táº£ purpose cá»§a tá»«ng file/folder
- Ready Ä‘á»ƒ báº¯t Ä‘áº§u implementation

### ğŸ“ CÃ¡c File ÄÃ£ Táº¡o

1. âœ…Â **PHASE1_2_Deep_Research_Web_Browser_AI_Agents_50_Pages.md**Â (2,135 dÃ²ng)
2. âœ…Â **finAI_Architecture_Diagrams_and_Folder_Structure.md**Â (894 dÃ²ng)

Báº¡n cÃ³ muá»‘n tÃ´i:

1. Render cÃ¡c Mermaid diagrams thÃ nh images (PNG/SVG)?
2. Táº¡o thÃªm sÆ¡ Ä‘á»“ nÃ o khÃ¡c?
3. Báº¯t Ä‘áº§uÂ **PHASE 3**Â (Viáº¿t TÃ i liá»‡u System Architecture 50 trang cho finAI)?

Vui lÃ²ng xÃ¡c nháº­n!

finAI_Architecture_Diagrams_and_Folder_Structure

Markdown Â· 51.36 KB

Xem táº¥t cáº£ tá»‡p trong nhiá»‡m vá»¥ nÃ y

# finAI Agentic Browser - SÆ¡ Ä‘á»“ Kiáº¿n trÃºc & Folder Structure

**TÃ¡c giáº£:** AI Architecture Team  
**NgÃ y:** 14/12/2025  
**PhiÃªn báº£n:** 1.0

---

## Má»¤C Lá»¤C

1. [SÆ¡ Ä‘á»“ Kiáº¿n trÃºc Tá»•ng thá»ƒ (High-Level Architecture)](#1-sÆ¡-Ä‘á»“-kiáº¿n-trÃºc-tá»•ng-thá»ƒ)
2. [SÆ¡ Ä‘á»“ Luá»“ng Dá»¯ liá»‡u (Data Flow Diagram)](#2-sÆ¡-Ä‘á»“-luá»“ng-dá»¯-liá»‡u)
3. [SÆ¡ Ä‘á»“ Component Chi tiáº¿t](#3-sÆ¡-Ä‘á»“-component-chi-tiáº¿t)
4. [Folder Structure Overview](#4-folder-structure-overview)
5. [Module Dependencies](#5-module-dependencies)

---

## 1. SÆ¡ Ä‘á»“ Kiáº¿n trÃºc Tá»•ng thá»ƒ

### 1.1. High-Level Architecture (ASCII Art)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          finAI Agentic Browser                          â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    FRONTEND LAYER                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚  â”‚  â”‚   Web UI    â”‚  â”‚   Mobile    â”‚  â”‚     API     â”‚              â”‚ â”‚
â”‚  â”‚  â”‚   (React)   â”‚  â”‚    (RN)     â”‚  â”‚   Clients   â”‚              â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚  â”‚         â”‚                 â”‚                 â”‚                     â”‚ â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚ â”‚
â”‚  â”‚                           â”‚                                        â”‚ â”‚
â”‚  â”‚                    WebSocket / REST API                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜ â”‚
â”‚                              â”‚                                     â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â” â”‚
â”‚  â”‚                    API GATEWAY LAYER                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚  â”‚  â”‚   FastAPI   â”‚  â”‚    Auth     â”‚  â”‚Rate Limiter â”‚              â”‚ â”‚
â”‚  â”‚  â”‚   Router    â”‚  â”‚ Middleware  â”‚  â”‚   & Cache   â”‚              â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜ â”‚
â”‚                              â”‚                                     â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â” â”‚
â”‚  â”‚                   ORCHESTRATION LAYER                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚              LangGraph Agent Orchestrator                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  State Management (StateGraph)                         â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  - Current Page Context                                â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  - Task Progress                                       â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  - Extracted Data                                      â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  - User Preferences                                    â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ Browser  â”‚  â”‚   Data   â”‚  â”‚ Analysis â”‚  â”‚  Safety  â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   Tool   â”‚  â”‚ Extract  â”‚  â”‚   Tool   â”‚  â”‚   Gate   â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚          â”‚  â”‚   Tool   â”‚  â”‚          â”‚  â”‚          â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚Reasoning â”‚  â”‚  Memory  â”‚  â”‚  Human   â”‚  â”‚  Logging â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   Tool   â”‚  â”‚   Tool   â”‚  â”‚ Approval â”‚  â”‚   Tool   â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜ â”‚
â”‚                              â”‚                                     â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â” â”‚
â”‚  â”‚                    PROCESSING LAYER                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  Module 1        â”‚  â”‚  Module 2        â”‚  â”‚  Module 3      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Input &         â”‚â†’ â”‚  Query           â”‚â†’ â”‚  Router &      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Ingestion       â”‚  â”‚  Understanding   â”‚  â”‚  Planner       â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  Module 4        â”‚  â”‚  Module 5        â”‚  â”‚  Module 6      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Browser         â”‚â†’ â”‚  Reasoning &     â”‚â†’ â”‚  Synthesis &   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Executor        â”‚  â”‚  Analysis        â”‚  â”‚  Response      â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜ â”‚
â”‚                              â”‚                                     â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â” â”‚
â”‚  â”‚                   BROWSER CONTROL LAYER                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚  â”‚  â”‚  Playwright â”‚  â”‚   A11y Tree â”‚  â”‚     DOM     â”‚              â”‚ â”‚
â”‚  â”‚  â”‚  Automation â”‚  â”‚  Extractor  â”‚  â”‚   Parser    â”‚              â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚  â”‚                                                                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚  â”‚  â”‚ Screenshot  â”‚  â”‚   Element   â”‚  â”‚   Action    â”‚              â”‚ â”‚
â”‚  â”‚  â”‚  Capture    â”‚  â”‚  Selector   â”‚  â”‚  Executor   â”‚              â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜ â”‚
â”‚                              â”‚                                     â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â” â”‚
â”‚  â”‚                      BROWSER ENGINE                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚                  Chromium Browser                           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - Rendering Engine                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - JavaScript Engine (V8)                                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - Network Stack                                            â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                     EXTERNAL SERVICES                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ â”‚
â”‚  â”‚  â”‚  OpenAI  â”‚  â”‚Anthropic â”‚  â”‚  Google  â”‚  â”‚ LangFuse â”‚         â”‚ â”‚
â”‚  â”‚  â”‚  GPT-4   â”‚  â”‚  Claude  â”‚  â”‚  Gemini  â”‚  â”‚(Observ.) â”‚         â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      DATA LAYER                                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ â”‚
â”‚  â”‚  â”‚PostgreSQLâ”‚  â”‚  Redis   â”‚  â”‚    S3    â”‚  â”‚  Vector  â”‚         â”‚ â”‚
â”‚  â”‚  â”‚(User DB) â”‚  â”‚ (Cache)  â”‚  â”‚ (Files)  â”‚  â”‚   DB     â”‚         â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2. High-Level Architecture (Mermaid Diagram)

```mermaid
graph TB
    subgraph Frontend["Frontend Layer"]
        WebUI["Web UI (React)"]
        MobileUI["Mobile (React Native)"]
        APIClient["API Clients"]
    end
    
    subgraph APIGateway["API Gateway Layer"]
        FastAPI["FastAPI Router"]
        Auth["Auth Middleware"]
        RateLimit["Rate Limiter & Cache"]
    end
    
    subgraph Orchestration["Orchestration Layer (LangGraph)"]
        StateGraph["State Management"]
        BrowserTool["Browser Tool"]
        DataExtractTool["Data Extract Tool"]
        AnalysisTool["Analysis Tool"]
        SafetyGate["Safety Gate"]
    end
    
    subgraph Processing["Processing Layer (6 Modules)"]
        Module1["Module 1: Input & Ingestion"]
        Module2["Module 2: Query Understanding"]
        Module3["Module 3: Router & Planner"]
        Module4["Module 4: Browser Executor"]
        Module5["Module 5: Reasoning & Analysis"]
        Module6["Module 6: Synthesis & Response"]
    end
    
    subgraph BrowserControl["Browser Control Layer"]
        Playwright["Playwright Automation"]
        A11yTree["A11y Tree Extractor"]
        DOMParser["DOM Parser"]
        Screenshot["Screenshot Capture"]
    end
    
    subgraph BrowserEngine["Browser Engine"]
        Chromium["Chromium Browser"]
    end
    
    subgraph ExternalServices["External Services"]
        OpenAI["OpenAI GPT-4"]
        Anthropic["Anthropic Claude"]
        LangFuse["LangFuse (Observability)"]
    end
    
    subgraph DataLayer["Data Layer"]
        PostgreSQL["PostgreSQL (User DB)"]
        Redis["Redis (Cache)"]
        S3["S3 (Files)"]
        VectorDB["Vector DB (Embeddings)"]
    end
    
    WebUI --> FastAPI
    MobileUI --> FastAPI
    APIClient --> FastAPI
    
    FastAPI --> Auth
    Auth --> RateLimit
    RateLimit --> StateGraph
    
    StateGraph --> BrowserTool
    StateGraph --> DataExtractTool
    StateGraph --> AnalysisTool
    StateGraph --> SafetyGate
    
    BrowserTool --> Module1
    Module1 --> Module2
    Module2 --> Module3
    Module3 --> Module4
    Module4 --> Module5
    Module5 --> Module6
    
    Module4 --> Playwright
    Playwright --> A11yTree
    Playwright --> DOMParser
    Playwright --> Screenshot
    
    A11yTree --> Chromium
    DOMParser --> Chromium
    Screenshot --> Chromium
    
    Module2 --> OpenAI
    Module5 --> Anthropic
    StateGraph --> LangFuse
    
    Auth --> PostgreSQL
    RateLimit --> Redis
    Module6 --> S3
    Module2 --> VectorDB
```

---

## 2. SÆ¡ Ä‘á»“ Luá»“ng Dá»¯ liá»‡u

### 2.1. End-to-End Data Flow

```
User Query: "Find Tesla's latest earnings report and summarize key metrics"
    â”‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Module 1: Input & Ingestion                                   â”‚
â”‚ - Parse query                                                 â”‚
â”‚ - Detect language, intent                                     â”‚
â”‚ - Extract entities: ["Tesla", "earnings report", "metrics"]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Module 2: Query Understanding                                 â”‚
â”‚ - Understand financial context                                â”‚
â”‚ - Identify data sources: [SEC EDGAR, Tesla IR]               â”‚
â”‚ - Generate TaskSpec:                                          â”‚
â”‚   {                                                           â”‚
â”‚     "intent": "research",                                     â”‚
â”‚     "scope": "single_company",                                â”‚
â”‚     "artifact": "earnings_report",                            â”‚
â”‚     "action_level": "read_only"                               â”‚
â”‚   }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Module 3: Router & Planner                                    â”‚
â”‚ - Select mode: "single_site"                                  â”‚
â”‚ - Generate ActionPlan:                                        â”‚
â”‚   [                                                           â”‚
â”‚     {action: "navigate", url: "sec.gov/edgar"},              â”‚
â”‚     {action: "search", query: "Tesla 10-Q"},                 â”‚
â”‚     {action: "extract", selector: "table.financials"},       â”‚
â”‚     {action: "analyze", task: "summarize_metrics"}           â”‚
â”‚   ]                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Module 4: Browser Executor (LangGraph Agent)                  â”‚
â”‚                                                               â”‚
â”‚ Step 1: Navigate to SEC EDGAR                                â”‚
â”‚   - Playwright: page.goto("https://sec.gov/edgar")           â”‚
â”‚   - Extract A11y Tree                                         â”‚
â”‚   - Current State: {url: "sec.gov/edgar", ...}               â”‚
â”‚                                                               â”‚
â”‚ Step 2: Search for Tesla 10-Q                                â”‚
â”‚   - Find search box (via A11y Tree)                           â”‚
â”‚   - Type "Tesla 10-Q"                                         â”‚
â”‚   - Click search button                                       â”‚
â”‚   - Wait for results                                          â”‚
â”‚                                                               â”‚
â”‚ Step 3: Extract financial table                              â”‚
â”‚   - Parse DOM to find table.financials                        â”‚
â”‚   - Extract table data â†’ CSV                                  â”‚
â”‚   - Store in State: {extracted_data: [...]}                  â”‚
â”‚                                                               â”‚
â”‚ Step 4: Verify extraction                                    â”‚
â”‚   - Check if data is complete                                 â”‚
â”‚   - If not, retry with alternative selector                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Module 5: Reasoning & Analysis                                â”‚
â”‚ - LLM analyzes extracted data                                 â”‚
â”‚ - Identify key metrics:                                       â”‚
â”‚   - Revenue: $25.2B (â†‘18% YoY)                               â”‚
â”‚   - Net Income: $1.9B (â†‘20% YoY)                             â”‚
â”‚   - EPS: $0.62 (â†‘15% YoY)                                    â”‚
â”‚ - Generate insights                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Module 6: Synthesis & Response                                â”‚
â”‚ - Format results                                              â”‚
â”‚ - Generate natural language summary                           â”‚
â”‚ - Attach source links                                         â”‚
â”‚ - Return to user                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
User receives: "Tesla's Q3 2024 earnings show strong growth:
                Revenue $25.2B (â†‘18%), Net Income $1.9B (â†‘20%),
                EPS $0.62 (â†‘15%). [Source: SEC EDGAR]"
```

---

## 3. SÆ¡ Ä‘á»“ Component Chi tiáº¿t

### 3.1. LangGraph Agent Architecture

```mermaid
graph LR
    subgraph LangGraphAgent["LangGraph Agent"]
        Start([Start]) --> QueryUnderstanding["Query Understanding Node"]
        QueryUnderstanding --> RouterPlanner["Router & Planner Node"]
        RouterPlanner --> Decision{Mode?}
        
        Decision -->|Single Site| SingleSiteExecutor["Single Site Executor"]
        Decision -->|Multi Site| MultiSiteExecutor["Multi Site Executor"]
        Decision -->|API Only| APIExecutor["API Executor"]
        
        SingleSiteExecutor --> BrowserAction["Browser Action Node"]
        MultiSiteExecutor --> BrowserAction
        
        BrowserAction --> SafetyCheck{Safety Check}
        SafetyCheck -->|Pass| ExecuteAction["Execute Action"]
        SafetyCheck -->|Fail| HumanApproval["Human Approval"]
        HumanApproval -->|Approved| ExecuteAction
        HumanApproval -->|Rejected| End([End])
        
        ExecuteAction --> VerifyResult{Result OK?}
        VerifyResult -->|Yes| ExtractData["Extract Data Node"]
        VerifyResult -->|No| Retry{Retry?}
        Retry -->|Yes| BrowserAction
        Retry -->|No| End
        
        ExtractData --> AnalyzeData["Analyze Data Node"]
        APIExecutor --> AnalyzeData
        
        AnalyzeData --> SynthesizeResponse["Synthesize Response Node"]
        SynthesizeResponse --> End
    end
    
    BrowserAction -.->|Uses| PlaywrightTool["Playwright Tool"]
    ExtractData -.->|Uses| DataExtractTool["Data Extract Tool"]
    AnalyzeData -.->|Uses| LLMTool["LLM Tool"]
```

### 3.2. Browser Control Layer Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Browser Control Layer                          â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚         Playwright Controller                          â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚  â”‚  Browser Context Manager                         â”‚ â”‚â”‚
â”‚  â”‚  â”‚  - Create/destroy browser instances              â”‚ â”‚â”‚
â”‚  â”‚  â”‚  - Manage multiple tabs                          â”‚ â”‚â”‚
â”‚  â”‚  â”‚  - Handle cookies & sessions                     â”‚ â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â”‚                                                        â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚  â”‚  Navigation  â”‚  â”‚    Action    â”‚  â”‚   Element   â”‚ â”‚â”‚
â”‚  â”‚  â”‚   Handler    â”‚  â”‚   Executor   â”‚  â”‚   Locator   â”‚ â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                            â†“                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚         Page Context Extractor                         â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚  â”‚  A11y Tree   â”‚  â”‚     DOM      â”‚  â”‚ Screenshot  â”‚ â”‚â”‚
â”‚  â”‚  â”‚  Extractor   â”‚  â”‚    Parser    â”‚  â”‚   Capture   â”‚ â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â”‚         â”‚                  â”‚                 â”‚         â”‚â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚â”‚
â”‚  â”‚                            â†“                            â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚  â”‚       Unified Page Context                         â”‚â”‚â”‚
â”‚  â”‚  â”‚  {                                                 â”‚â”‚â”‚
â”‚  â”‚  â”‚    url: string,                                    â”‚â”‚â”‚
â”‚  â”‚  â”‚    title: string,                                  â”‚â”‚â”‚
â”‚  â”‚  â”‚    a11y_tree: A11yNode[],                          â”‚â”‚â”‚
â”‚  â”‚  â”‚    dom_snapshot: DOMSnapshot,                      â”‚â”‚â”‚
â”‚  â”‚  â”‚    screenshot: bytes (optional),                   â”‚â”‚â”‚
â”‚  â”‚  â”‚    interactive_elements: Element[]                 â”‚â”‚â”‚
â”‚  â”‚  â”‚  }                                                 â”‚â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Folder Structure Overview

### 4.1. Project Root Structure

```
finai-agentic-browser/
â”‚
â”œâ”€â”€ README.md
â”œâ”€â”€ LICENSE
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .env.example
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Makefile
â”‚
â”œâ”€â”€ docs/                          # Documentation
â”‚   â”œâ”€â”€ architecture/
â”‚   â”‚   â”œâ”€â”€ high-level-design.md
â”‚   â”‚   â”œâ”€â”€ low-level-design.md
â”‚   â”‚   â””â”€â”€ diagrams/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ openapi.yaml
â”‚   â””â”€â”€ user-guide/
â”‚
â”œâ”€â”€ frontend/                      # Frontend applications
â”‚   â”œâ”€â”€ web/                       # React web app
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ tsconfig.json
â”‚   â””â”€â”€ mobile/                    # React Native mobile app
â”‚       â”œâ”€â”€ src/
â”‚       â”œâ”€â”€ ios/
â”‚       â”œâ”€â”€ android/
â”‚       â””â”€â”€ package.json
â”‚
â”œâ”€â”€ backend/                       # Backend services
â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â”œâ”€â”€ poetry.lock
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”‚
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ api/                   # FastAPI application
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ main.py            # FastAPI app entry point
â”‚   â”‚   â”‚   â”œâ”€â”€ dependencies.py
â”‚   â”‚   â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ rate_limit.py
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ logging.py
â”‚   â”‚   â”‚   â””â”€â”€ routes/
â”‚   â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚       â”œâ”€â”€ query.py       # Query endpoints
â”‚   â”‚   â”‚       â”œâ”€â”€ user.py        # User management
â”‚   â”‚   â”‚       â””â”€â”€ health.py      # Health checks
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ core/                  # Core business logic
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ config.py          # Configuration
â”‚   â”‚   â”‚   â”œâ”€â”€ exceptions.py      # Custom exceptions
â”‚   â”‚   â”‚   â””â”€â”€ constants.py       # Constants
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ modules/               # 6 Processing Modules
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ module1_input_ingestion/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ models.py      # Pydantic models
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ service.py     # Main logic
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ parsers/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ text_parser.py
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ voice_parser.py
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ file_parser.py
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ validators/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ input_validator.py
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ module2_query_understanding/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ models.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ service.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ rules/         # Rule Engine
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ main.py
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ intent.py
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ facets.py
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ entities.py
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ confidence.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ slm/           # SLM Backup
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ client.py
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ prompts.py
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ parser.py
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ policy/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ overrides.py
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ module3_router_planner/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ models.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ service.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ router/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ mode_selector.py
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ complexity_estimator.py
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ planner/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ action_planner.py
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ sub_query_generator.py
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ module4_browser_executor/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ models.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ service.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ agent/         # LangGraph Agent
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ graph.py   # StateGraph definition
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ nodes.py   # Agent nodes
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ tools.py   # Agent tools
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ browser/       # Browser control
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ controller.py
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ playwright_wrapper.py
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ a11y_extractor.py
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ dom_parser.py
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ screenshot_capture.py
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ module5_reasoning_analysis/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ models.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ service.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ analyzers/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ financial_analyzer.py
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ sentiment_analyzer.py
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ trend_analyzer.py
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ reasoners/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ llm_reasoner.py
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ rule_reasoner.py
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ module6_synthesis_response/
â”‚   â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚       â”œâ”€â”€ models.py
â”‚   â”‚   â”‚       â”œâ”€â”€ service.py
â”‚   â”‚   â”‚       â”œâ”€â”€ formatters/
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ text_formatter.py
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ table_formatter.py
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ chart_formatter.py
â”‚   â”‚   â”‚       â””â”€â”€ generators/
â”‚   â”‚   â”‚           â””â”€â”€ response_generator.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ orchestration/         # LangGraph Orchestration
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ agent.py           # Main agent orchestrator
â”‚   â”‚   â”‚   â”œâ”€â”€ state.py           # State definitions
â”‚   â”‚   â”‚   â”œâ”€â”€ tools/             # LangGraph tools
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ browser_tool.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ data_extract_tool.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ analysis_tool.py
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ safety_gate_tool.py
â”‚   â”‚   â”‚   â””â”€â”€ callbacks/
â”‚   â”‚   â”‚       â””â”€â”€ langfuse_callback.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ llm/                   # LLM integrations
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py            # Base LLM interface
â”‚   â”‚   â”‚   â”œâ”€â”€ openai_client.py
â”‚   â”‚   â”‚   â”œâ”€â”€ anthropic_client.py
â”‚   â”‚   â”‚   â”œâ”€â”€ gemini_client.py
â”‚   â”‚   â”‚   â””â”€â”€ router.py          # LLM router
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ database/              # Database layer
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ models.py          # SQLAlchemy models
â”‚   â”‚   â”‚   â”œâ”€â”€ session.py         # DB session
â”‚   â”‚   â”‚   â””â”€â”€ repositories/
â”‚   â”‚   â”‚       â”œâ”€â”€ user_repo.py
â”‚   â”‚   â”‚       â”œâ”€â”€ query_repo.py
â”‚   â”‚   â”‚       â””â”€â”€ cache_repo.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ cache/                 # Caching layer
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ redis_client.py
â”‚   â”‚   â”‚   â””â”€â”€ cache_manager.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ storage/               # File storage
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ s3_client.py
â”‚   â”‚   â”‚   â””â”€â”€ file_manager.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ security/              # Security utilities
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚   â”‚   â”œâ”€â”€ encryption.py
â”‚   â”‚   â”‚   â””â”€â”€ pii_detector.py
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ utils/                 # Utility functions
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ logger.py
â”‚   â”‚       â”œâ”€â”€ metrics.py
â”‚   â”‚       â””â”€â”€ helpers.py
â”‚   â”‚
â”‚   â””â”€â”€ tests/                     # Test suite
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ conftest.py            # Pytest fixtures
â”‚       â”œâ”€â”€ unit/
â”‚       â”‚   â”œâ”€â”€ test_module1.py
â”‚       â”‚   â”œâ”€â”€ test_module2.py
â”‚       â”‚   â””â”€â”€ ...
â”‚       â”œâ”€â”€ integration/
â”‚       â”‚   â”œâ”€â”€ test_api.py
â”‚       â”‚   â”œâ”€â”€ test_browser.py
â”‚       â”‚   â””â”€â”€ ...
â”‚       â””â”€â”€ e2e/
â”‚           â””â”€â”€ test_workflows.py
â”‚
â”œâ”€â”€ infrastructure/                # Infrastructure as Code
â”‚   â”œâ”€â”€ terraform/
â”‚   â”‚   â”œâ”€â”€ main.tf
â”‚   â”‚   â”œâ”€â”€ variables.tf
â”‚   â”‚   â””â”€â”€ outputs.tf
â”‚   â”œâ”€â”€ kubernetes/
â”‚   â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”‚   â”œâ”€â”€ service.yaml
â”‚   â”‚   â””â”€â”€ ingress.yaml
â”‚   â””â”€â”€ docker/
â”‚       â”œâ”€â”€ Dockerfile.backend
â”‚       â”œâ”€â”€ Dockerfile.frontend
â”‚       â””â”€â”€ Dockerfile.browser
â”‚
â”œâ”€â”€ scripts/                       # Utility scripts
â”‚   â”œâ”€â”€ setup.sh
â”‚   â”œâ”€â”€ deploy.sh
â”‚   â”œâ”€â”€ migrate.sh
â”‚   â””â”€â”€ seed_data.py
â”‚
â””â”€â”€ monitoring/                    # Monitoring configs
    â”œâ”€â”€ prometheus/
    â”‚   â””â”€â”€ prometheus.yml
    â”œâ”€â”€ grafana/
    â”‚   â””â”€â”€ dashboards/
    â””â”€â”€ alerts/
        â””â”€â”€ alert_rules.yml
```

### 4.2. Module 2 (Query Understanding) Detailed Structure

```
module2_query_understanding/
â”‚
â”œâ”€â”€ __init__.py
â”‚
â”œâ”€â”€ models.py                      # Pydantic models
â”‚   â”œâ”€â”€ UnifiedInputCore
â”‚   â”œâ”€â”€ TaskSpecV1
â”‚   â”œâ”€â”€ RuleEngineResult
â”‚   â”œâ”€â”€ SLMResult
â”‚   â””â”€â”€ PolicyOverride
â”‚
â”œâ”€â”€ service.py                     # Main orchestrator
â”‚   â””â”€â”€ run_query_understanding()
â”‚
â”œâ”€â”€ exceptions.py                  # Custom exceptions
â”‚   â”œâ”€â”€ QueryUnderstandingError
â”‚   â”œâ”€â”€ RuleEngineError
â”‚   â””â”€â”€ SLMError
â”‚
â”œâ”€â”€ rules/                         # Rule Engine (Fast Path)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                    # Rule engine orchestrator
â”‚   â”‚   â””â”€â”€ run_rule_engine()
â”‚   â”œâ”€â”€ intent.py                  # Intent classification
â”‚   â”‚   â””â”€â”€ classify_intent()
â”‚   â”œâ”€â”€ facets.py                  # Facet classification
â”‚   â”‚   â”œâ”€â”€ classify_scope()
â”‚   â”‚   â”œâ”€â”€ classify_artifact()
â”‚   â”‚   â”œâ”€â”€ classify_action_level()
â”‚   â”‚   â””â”€â”€ classify_risk()
â”‚   â”œâ”€â”€ entities.py                # Entity extraction
â”‚   â”‚   â”œâ”€â”€ extract_companies()
â”‚   â”‚   â”œâ”€â”€ extract_dates()
â”‚   â”‚   â”œâ”€â”€ extract_numbers()
â”‚   â”‚   â””â”€â”€ extract_metrics()
â”‚   â”œâ”€â”€ policy.py                  # Policy checks
â”‚   â”‚   â”œâ”€â”€ detect_pii()
â”‚   â”‚   â””â”€â”€ detect_injection()
â”‚   â””â”€â”€ confidence.py              # Confidence scoring
â”‚       â””â”€â”€ calculate_confidence()
â”‚
â”œâ”€â”€ slm/                           # SLM Backup (Slow Path)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ client.py                  # SLM client
â”‚   â”‚   â””â”€â”€ call_slm()
â”‚   â”œâ”€â”€ prompts.py                 # Prompt templates
â”‚   â”‚   â”œâ”€â”€ INTENT_CLASSIFICATION_PROMPT
â”‚   â”‚   â”œâ”€â”€ FACET_CLASSIFICATION_PROMPT
â”‚   â”‚   â””â”€â”€ ENTITY_EXTRACTION_PROMPT
â”‚   â””â”€â”€ parser.py                  # Response parser
â”‚       â””â”€â”€ parse_slm_response()
â”‚
â”œâ”€â”€ policy/                        # Policy Overrides
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ overrides.py
â”‚       â”œâ”€â”€ apply_policy_overrides()
â”‚       â””â”€â”€ POLICY_RULES
â”‚
â””â”€â”€ tests/                         # Module-specific tests
    â”œâ”€â”€ test_rules.py
    â”œâ”€â”€ test_slm.py
    â”œâ”€â”€ test_policy.py
    â””â”€â”€ golden_files/
        â”œâ”€â”€ query_001.json
        â”œâ”€â”€ query_002.json
        â””â”€â”€ ...
```

### 4.3. Module 4 (Browser Executor) Detailed Structure

```
module4_browser_executor/
â”‚
â”œâ”€â”€ __init__.py
â”‚
â”œâ”€â”€ models.py                      # Pydantic models
â”‚   â”œâ”€â”€ ActionPlan
â”‚   â”œâ”€â”€ Action
â”‚   â”œâ”€â”€ PageContext
â”‚   â”œâ”€â”€ ExecutionResult
â”‚   â””â”€â”€ EvidencePack
â”‚
â”œâ”€â”€ service.py                     # Main orchestrator
â”‚   â””â”€â”€ execute_browser_workflow()
â”‚
â”œâ”€â”€ agent/                         # LangGraph Agent
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ graph.py                   # StateGraph definition
â”‚   â”‚   â”œâ”€â”€ create_agent_graph()
â”‚   â”‚   â””â”€â”€ compile_graph()
â”‚   â”œâ”€â”€ state.py                   # State schema
â”‚   â”‚   â””â”€â”€ BrowserAgentState
â”‚   â”œâ”€â”€ nodes.py                   # Agent nodes
â”‚   â”‚   â”œâ”€â”€ navigate_node()
â”‚   â”‚   â”œâ”€â”€ extract_node()
â”‚   â”‚   â”œâ”€â”€ analyze_node()
â”‚   â”‚   â”œâ”€â”€ verify_node()
â”‚   â”‚   â””â”€â”€ retry_node()
â”‚   â”œâ”€â”€ tools.py                   # LangGraph tools
â”‚   â”‚   â”œâ”€â”€ BrowserTool
â”‚   â”‚   â”œâ”€â”€ DataExtractTool
â”‚   â”‚   â””â”€â”€ SafetyGateTool
â”‚   â””â”€â”€ callbacks.py               # Callbacks
â”‚       â””â”€â”€ LangFuseCallback
â”‚
â”œâ”€â”€ browser/                       # Browser Control
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ controller.py              # High-level controller
â”‚   â”‚   â”œâ”€â”€ BrowserController
â”‚   â”‚   â”œâ”€â”€ navigate()
â”‚   â”‚   â”œâ”€â”€ click()
â”‚   â”‚   â”œâ”€â”€ type_text()
â”‚   â”‚   â””â”€â”€ extract_data()
â”‚   â”œâ”€â”€ playwright_wrapper.py      # Playwright wrapper
â”‚   â”‚   â”œâ”€â”€ PlaywrightManager
â”‚   â”‚   â”œâ”€â”€ create_browser()
â”‚   â”‚   â”œâ”€â”€ create_context()
â”‚   â”‚   â””â”€â”€ create_page()
â”‚   â”œâ”€â”€ a11y_extractor.py          # A11y Tree extraction
â”‚   â”‚   â”œâ”€â”€ extract_a11y_tree()
â”‚   â”‚   â””â”€â”€ parse_a11y_node()
â”‚   â”œâ”€â”€ dom_parser.py              # DOM parsing
â”‚   â”‚   â”œâ”€â”€ parse_dom()
â”‚   â”‚   â”œâ”€â”€ extract_text()
â”‚   â”‚   â”œâ”€â”€ extract_links()
â”‚   â”‚   â””â”€â”€ extract_forms()
â”‚   â”œâ”€â”€ screenshot_capture.py      # Screenshot capture
â”‚   â”‚   â”œâ”€â”€ capture_screenshot()
â”‚   â”‚   â””â”€â”€ capture_element_screenshot()
â”‚   â””â”€â”€ element_selector.py        # Element selection
â”‚       â”œâ”€â”€ find_element()
â”‚       â””â”€â”€ generate_selector()
â”‚
â””â”€â”€ tests/
    â”œâ”€â”€ test_agent.py
    â”œâ”€â”€ test_browser.py
    â””â”€â”€ fixtures/
        â””â”€â”€ mock_pages/
```

---

## 5. Module Dependencies

### 5.1. Module Dependency Graph

```mermaid
graph TD
    Module1["Module 1<br/>Input & Ingestion"] --> Module2["Module 2<br/>Query Understanding"]
    Module2 --> Module3["Module 3<br/>Router & Planner"]
    Module3 --> Module4["Module 4<br/>Browser Executor"]
    Module4 --> Module5["Module 5<br/>Reasoning & Analysis"]
    Module5 --> Module6["Module 6<br/>Synthesis & Response"]
    
    Module4 -.->|Uses| BrowserControl["Browser Control Layer"]
    Module2 -.->|Uses| LLMLayer["LLM Layer"]
    Module5 -.->|Uses| LLMLayer
    Module6 -.->|Uses| LLMLayer
    
    Module4 -.->|Orchestrated by| LangGraph["LangGraph Orchestrator"]
    
    BrowserControl -.->|Controls| Chromium["Chromium Browser"]
    
    LLMLayer -.->|Calls| OpenAI["OpenAI"]
    LLMLayer -.->|Calls| Anthropic["Anthropic"]
    
    Module2 -.->|Logs to| LangFuse["LangFuse"]
    Module4 -.->|Logs to| LangFuse
    Module5 -.->|Logs to| LangFuse
```

### 5.2. Technology Stack by Layer

| Layer | Technologies |
|-------|-------------|
| **Frontend** | React, TypeScript, TailwindCSS, WebSocket |
| **API Gateway** | FastAPI, Pydantic, JWT, Redis (rate limiting) |
| **Orchestration** | LangChain, LangGraph, Python 3.11+ |
| **Processing** | Python, Pydantic, asyncio |
| **Browser Control** | Playwright, Chromium, CDP (Chrome DevTools Protocol) |
| **LLM** | OpenAI GPT-4, Anthropic Claude, Google Gemini |
| **Database** | PostgreSQL (user data), Redis (cache), S3 (files) |
| **Monitoring** | LangFuse, Sentry, Prometheus, Grafana |
| **Infrastructure** | AWS (ECS, Lambda), Kubernetes, Docker, Terraform |

---

## 6. Deployment Architecture

### 6.1. Production Deployment Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AWS Cloud                              â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              Load Balancer (ALB)                        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                        â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              API Gateway (ECS)                          â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚â”‚
â”‚  â”‚  â”‚ Instance â”‚  â”‚ Instance â”‚  â”‚ Instance â”‚             â”‚â”‚
â”‚  â”‚  â”‚    1     â”‚  â”‚    2     â”‚  â”‚    3     â”‚             â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                        â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚         Processing Layer (ECS/Lambda)                   â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚â”‚
â”‚  â”‚  â”‚ Module 1 â”‚  â”‚ Module 2 â”‚  â”‚ Module 3 â”‚             â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚â”‚
â”‚  â”‚  â”‚ Module 4 â”‚  â”‚ Module 5 â”‚  â”‚ Module 6 â”‚             â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                        â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚         Browser Pool (ECS)                              â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚â”‚
â”‚  â”‚  â”‚ Browser  â”‚  â”‚ Browser  â”‚  â”‚ Browser  â”‚             â”‚â”‚
â”‚  â”‚  â”‚    1     â”‚  â”‚    2     â”‚  â”‚    3     â”‚             â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              Data Layer                                 â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚â”‚
â”‚  â”‚  â”‚PostgreSQLâ”‚  â”‚  Redis   â”‚  â”‚    S3    â”‚             â”‚â”‚
â”‚  â”‚  â”‚   (RDS)  â”‚  â”‚(ElastiC.)â”‚  â”‚ (Bucket) â”‚             â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Káº¾T LUáº¬N

TÃ i liá»‡u nÃ y cung cáº¥p:
1. **SÆ¡ Ä‘á»“ Kiáº¿n trÃºc Tá»•ng thá»ƒ** - High-level view cá»§a toÃ n bá»™ há»‡ thá»‘ng
2. **SÆ¡ Ä‘á»“ Luá»“ng Dá»¯ liá»‡u** - End-to-end data flow tá»« user query Ä‘áº¿n response
3. **SÆ¡ Ä‘á»“ Component Chi tiáº¿t** - LangGraph Agent vÃ  Browser Control Layer
4. **Folder Structure** - Cáº¥u trÃºc thÆ° má»¥c chi tiáº¿t cho toÃ n bá»™ project
5. **Module Dependencies** - Dependency graph vÃ  technology stack

CÃ¡c sÆ¡ Ä‘á»“ nÃ y sáº½ Ä‘Æ°á»£c sá»­ dá»¥ng lÃ m reference cho viá»‡c implementation trong cÃ¡c phase tiáº¿p theo.

---

**End of Document**



---

## PhÃ¢n tÃ­ch vÃ  ÄÃ¡nh giÃ¡ Kiáº¿n trÃºc finAI Agentic Browser

### **1. So sÃ¡nh Thiáº¿t káº¿ Hiá»‡n táº¡i cá»§a finAI vá»›i Framework 4 Quadrant**

Kiáº¿n trÃºc hiá»‡n táº¡i cá»§a finAI, vá»›i 6 stages tuáº§n tá»± (Input â†’ Query Understanding â†’ Router/Planner â†’ Executor â†’ Reasoning â†’ Synthesis), thuá»™c vá» **Quadrant 2: Orchestration**.

**LÃ½ do:**
- **Äiá»u phá»‘i táº­p trung:** CÃ³ má»™t luá»“ng chÃ­nh Ä‘iá»u phá»‘i cÃ´ng viá»‡c qua cÃ¡c stage.
- **ChuyÃªn mÃ´n hÃ³a:** Má»—i stage lÃ  má»™t module chuyÃªn biá»‡t (giá»‘ng nhÆ° má»™t agent chuyÃªn biá»‡t).
- **Agency tháº¥p:** CÃ¡c module chá»‰ thá»±c hiá»‡n tÃ¡c vá»¥ Ä‘Æ°á»£c giao, khÃ´ng tá»± ra quyáº¿t Ä‘á»‹nh.

**Äiá»ƒm máº¡nh cá»§a thiáº¿t káº¿ hiá»‡n táº¡i:**
- **Äá»™ tin cáº­y cao:** Luá»“ng xá»­ lÃ½ cÃ³ thá»ƒ dá»± Ä‘oÃ¡n Ä‘Æ°á»£c, dá»… debug.
- **Tá»‘i Æ°u hÃ³a latency:** Rule-first approach trong Module 2 giÃºp xá»­ lÃ½ nhanh cÃ¡c yÃªu cáº§u phá»• biáº¿n.
- **Dá»… quáº£n lÃ½:** TÃ¡ch biá»‡t concerns rÃµ rÃ ng, dá»… dÃ ng phÃ¡t triá»ƒn vÃ  báº£o trÃ¬ tá»«ng module.

**Äiá»ƒm yáº¿u cá»§a thiáº¿t káº¿ hiá»‡n táº¡i:**
- **Thiáº¿u linh hoáº¡t:** KhÃ³ xá»­ lÃ½ cÃ¡c yÃªu cáº§u phá»©c táº¡p, Ä‘a bÆ°á»›c, hoáº·c cáº§n feedback loop.
- **KhÃ³ má»Ÿ rá»™ng:** KhÃ´ng dá»… dÃ ng thÃªm cÃ¡c tools hoáº·c workflows má»›i mÃ  khÃ´ng thay Ä‘á»•i code cá»§a orchestrator.
- **KhÃ´ng cÃ³ "trÃ­ nhá»›":** KhÃ³ thá»±c hiá»‡n cÃ¡c cuá»™c há»™i thoáº¡i dÃ i, nhiá»u lÆ°á»£t.

### **2. ÄÃ¡nh giÃ¡ Kiáº¿n trÃºc tá»« gÃ³c Ä‘á»™ Master System Architect**

Vá»›i vai trÃ² lÃ  má»™t Master System Architect, tÃ´i Ä‘Ã¡nh giÃ¡ kiáº¿n trÃºc hiá»‡n táº¡i cá»§a finAI lÃ  má»™t **ná»n táº£ng vá»¯ng cháº¯c, nhÆ°ng chÆ°a pháº£i lÃ  má»™t há»‡ thá»‘ng agent thá»±c thá»¥**.

**Äiá»ƒm cá»™ng (+):**
- **Modular & Scalable:** Thiáº¿t káº¿ 6 stages lÃ  má»™t best practice, cho phÃ©p scale tá»«ng module Ä‘á»™c láº­p.
- **Focus vÃ o Safety & Reliability:** Rule Engine vÃ  Safety Checks lÃ  cá»±c ká»³ quan trá»ng cho domain tÃ i chÃ­nh.
- **Tá»‘i Æ°u hÃ³a Performance:** Nháº­n thá»©c Ä‘Æ°á»£c táº§m quan trá»ng cá»§a latency vÃ  cÃ³ giáº£i phÃ¡p (Rule-first).

**Äiá»ƒm trá»« (-):**
- **Thiáº¿u "Agency":** Há»‡ thá»‘ng váº«n Ä‘ang hoáº¡t Ä‘á»™ng nhÆ° má»™t pipeline xá»­ lÃ½ dá»¯ liá»‡u thÃ´ng minh, chÆ°a pháº£i lÃ  má»™t agent cÃ³ kháº£ nÄƒng tá»± chá»§.
- **Coupling cao:** CÃ¡c stages váº«n cÃ²n phá»¥ thuá»™c nhiá»u vÃ o nhau, khÃ³ tÃ¡i sá»­ dá»¥ng hoáº·c thay Ä‘á»•i thá»© tá»±.
- **KhÃ³ má»Ÿ rá»™ng Toolset:** Viá»‡c thÃªm tool má»›i Ä‘Ã²i há»i pháº£i thay Ä‘á»•i cáº£ Router, Planner, vÃ  Executor.

### **3. Recommendations Ä‘á»ƒ Chuyá»ƒn Ä‘á»•i sang Kiáº¿n trÃºc Agent thá»±c thá»¥ (Quadrant 3: Autonomy)**

Äá»ƒ Ä‘Æ°a finAI lÃªn má»™t táº§m cao má»›i, chÃºng ta cáº§n chuyá»ƒn Ä‘á»•i tá»« **Orchestration (Quadrant 2)** sang **Autonomy (Quadrant 3)**. ÄÃ¢y lÃ  cÃ¡c bÆ°á»›c cá»¥ thá»ƒ:

**Recommendation 1: Ãp dá»¥ng LangGraph lÃ m Orchestrator chÃ­nh**
- Thay tháº¿ pipeline 6 stages cá»©ng nháº¯c báº±ng má»™t **StateGraph** cá»§a LangGraph.
- Má»—i node trong graph sáº½ lÃ  má»™t module (hoáº·c má»™t tool).
- CÃ¡c cáº¡nh (edges) sáº½ lÃ  cÃ¡c quyáº¿t Ä‘á»‹nh (do LLM Ä‘Æ°a ra) Ä‘á»ƒ chuyá»ƒn tá»« node nÃ y sang node khÃ¡c.

**Recommendation 2: Biáº¿n cÃ¡c Modules thÃ nh Tools**
- **Module 2 (Query Understanding):** Váº«n giá»¯ láº¡i, nhÆ°ng Ä‘Ã³ng gÃ³i thÃ nh má»™t tool `understand_query`.
- **Module 3 (Router/Planner):** Bá» Ä‘i, vÃ¬ LangGraph sáº½ Ä‘áº£m nhiá»‡m vai trÃ² nÃ y.
- **Module 4 (Browser Executor):** Chia nhá» thÃ nh cÃ¡c tools cá»¥ thá»ƒ: `browse_url`, `click_element`, `input_text`, `scroll_page`, etc.
- **Module 5 (Reasoning):** TÃ­ch há»£p vÃ o agent state cá»§a LangGraph.
- **Module 6 (Synthesis):** Giá»¯ láº¡i nhÆ° má»™t tool `synthesize_answer`.

**Recommendation 3: Thiáº¿t káº¿ Agent State (StateGraph)**
- State cá»§a LangGraph sáº½ chá»©a toÃ n bá»™ context cá»§a cuá»™c há»™i thoáº¡i:
  - `user_query`: YÃªu cáº§u ban Ä‘áº§u
  - `task_spec`: Output tá»« Module 2
  - `browser_snapshots`: Lá»‹ch sá»­ cÃ¡c trang Ä‘Ã£ xem (A11y Tree)
  - `scratchpad`: Suy nghÄ© vÃ  quyáº¿t Ä‘á»‹nh cá»§a agent
  - `final_answer`: CÃ¢u tráº£ lá»i cuá»‘i cÃ¹ng

**Recommendation 4: XÃ¢y dá»±ng má»™t "Master Agent"**
- Master Agent nÃ y sáº½ lÃ  má»™t LangGraph StateGraph.
- NÃ³ sáº½ cÃ³ má»™t bá»™ tools bao gá»“m cÃ¡c modules Ä‘Ã£ Ä‘Æ°á»£c Ä‘Ã³ng gÃ³i láº¡i.
- Luá»“ng hoáº¡t Ä‘á»™ng sáº½ lÃ  má»™t vÃ²ng láº·p ReAct (Reason-Act-Observe) Ä‘Æ°á»£c quáº£n lÃ½ bá»Ÿi LangGraph.

### **4. Kiáº¿n trÃºc Äá» xuáº¥t (Proposed Architecture)**

```mermaid
flowchart TD
    User --> API_Gateway[API Gateway]
    API_Gateway --> LangGraph_Agent[LangGraph Agent (Master Agent)]

    subgraph LangGraph_Agent
        direction LR
        State[Agent State]
        State --> Router{Router Node}
        Router --> Tool_Executor[Tool Executor Node]
        Tool_Executor --> State
    end

    subgraph Tool_Registry
        direction TB
        Tool1[understand_query]
        Tool2[browse_url]
        Tool3[click_element]
        Tool4[input_text]
        Tool5[synthesize_answer]
    end

    Tool_Executor --> Tool_Registry

    LangGraph_Agent --> Final_Response[Final Response]
    Final_Response --> User
```

### **5. Lá»£i Ã­ch cá»§a Kiáº¿n trÃºc Má»›i**

- **Linh hoáº¡t & Má»Ÿ rá»™ng:** Dá»… dÃ ng thÃªm tools má»›i mÃ  khÃ´ng cáº§n thay Ä‘á»•i kiáº¿n trÃºc.
- **TÄƒng "Agency":** Agent cÃ³ thá»ƒ tá»± quyáº¿t Ä‘á»‹nh luá»“ng xá»­ lÃ½, thá»±c hiá»‡n cÃ¡c tÃ¡c vá»¥ phá»©c táº¡p, Ä‘a bÆ°á»›c.
- **CÃ³ "TrÃ­ nhá»›":** Agent State cho phÃ©p agent nhá»› láº¡i cÃ¡c bÆ°á»›c Ä‘Ã£ lÃ m vÃ  há»c há»i tá»« Ä‘Ã³.
- **Dá»… Debug & Observe:** LangFuse cÃ³ thá»ƒ tÃ­ch há»£p vá»›i LangGraph Ä‘á»ƒ visualize tá»«ng bÆ°á»›c cháº¡y cá»§a agent.
- **TÃ¡i sá»­ dá»¥ng Code:** CÃ¡c modules hiá»‡n táº¡i cÃ³ thá»ƒ Ä‘Æ°á»£c tÃ¡i sá»­ dá»¥ng nhÆ° cÃ¡c tools.

Báº±ng cÃ¡ch thá»±c hiá»‡n cÃ¡c thay Ä‘á»•i nÃ y, finAI sáº½ chuyá»ƒn mÃ¬nh tá»« má»™t há»‡ thá»‘ng xá»­ lÃ½ dá»¯ liá»‡u thÃ´ng minh thÃ nh má»™t **Web Browser AI Agent thá»±c thá»¥**, sáºµn sÃ ng cáº¡nh tranh vá»›i cÃ¡c sáº£n pháº©m hÃ ng Ä‘áº§u trÃªn tháº¿ giá»›i.


---
```mermaid
graph TD
    %% ============= FRONTEND LAYER =============
    subgraph Frontend["ğŸ–¥ï¸ FRONTEND LAYER"]
        WebUI["Web UI<br/>(React/TypeScript)"]
        MobileApp["ğŸ“± Mobile App<br/>(React Native)"]
        APIClients["ğŸ”Œ API Clients"]
        WebSocket["ğŸ”„ WebSocket<br/>Real-time Connection"]
    end
    
    %% ============= API GATEWAY LAYER =============
    subgraph APIGateway["ğŸš€ API GATEWAY LAYER"]
        FastAPI["FastAPI Router<br/>(REST/WebSocket)"]
        AuthMiddleware["ğŸ” Auth Middleware<br/>(JWT, OAuth)"]
        RateLimiter["âš¡ Rate Limiter<br/>& Cache Manager"]
    end
    
    %% ============= ORCHESTRATION LAYER (LangGraph Core) =============
    subgraph Orchestration["ğŸ§  ORCHESTRATION LAYER (LangGraph Core)"]
        direction TB
        AgentOrch["Agent Orchestrator<br/>(StateGraph)"]
        StateManagement["ğŸ“Š State Management<br/>- messages<br/>- task_status<br/>- browser_context<br/>- scratchpad"]
        
        subgraph ReActLoop["âš™ï¸ ReAct Loop"]
            ReasonNode["ğŸ’­ REASON NODE<br/>(LLM Thinking)"]
            ActionNode["ğŸ¯ ACTION NODE<br/>(Tool Selection)"]
            ObserveNode["ğŸ‘ï¸ OBSERVE NODE<br/>(Result Processing)"]
        end
        
        ReasonNode -->|Decision| ActionNode
        ActionNode -->|Execute| ObserveNode
        ObserveNode -->|Update| StateManagement
        StateManagement -->|Context| ReasonNode
        
        AgentOrch -.->|Controls| ReActLoop
        
        SafetyGate["ğŸ›¡ï¸ Safety Gate<br/>(Policy Enforcement)"]
        HumanApproval["âœ‹ Human Approval<br/>(Transaction Checkpoint)"]
    end
    
    %% ============= TOOL REGISTRY (Refactored Modules) =============
    subgraph ToolRegistry["ğŸ”§ TOOL REGISTRY (Refactored Modules as Tools)"]
        direction TB
        
        subgraph BrowserTools["ğŸŒ Browser Tools"]
            NavTool["navigate_url<br/>(Module 4)"]
            ClickTool["click_element"]
            InputTool["input_text"]
            ExtractTool["extract_data<br/>(A11y/DOM)"]
            ScrollTool["scroll_page"]
        end
        
        subgraph AnalysisTools["ğŸ“ˆ Analysis Tools"]
            FinancialAnalysis["financial_reasoning<br/>(Module 5)"]
            TrendAnalysis["trend_analysis"]
            SentimentAnalysis["sentiment_analysis"]
        end
        
        subgraph PlanningTools["ğŸ“‹ Planning Tools"]
            QueryAnalysis["analyze_query<br/>(Module 2)"]
            TaskPlanning["task_planning"]
            SubQueryGen["sub_query_generator"]
        end
        
        subgraph SafetyTools["ğŸ”’ Safety Tools"]
            InputValidation["validate_input<br/>(Module 1)"]
            InjectionGuard["injection_guard"]
            PiiDetector["pii_detector"]
        end
        
        subgraph ResponseTools["ğŸ“ Response Tools"]
            GenerateReport["generate_report<br/>(Module 6)"]
            FormatTable["format_table"]
            FormatChart["format_chart"]
        end
    end
    
    %% ============= BROWSER CONTROL LAYER =============
    subgraph BrowserControl["ğŸ® BROWSER CONTROL LAYER"]
        direction TB
        PlaywrightCtrl["âš™ï¸ Playwright Controller<br/>(Instance Manager)"]
        
        subgraph PageContext["ğŸ“„ Page Context Extractor"]
            A11yExtractor["ğŸŒ³ A11y Tree Extractor<br/>(Primary Path - 90%)<br/>- Semantic Elements<br/>- Text Content<br/>- Interactive Roles"]
            DOMParser["ğŸŒ² DOM Parser<br/>(Backup)<br/>- Selectors<br/>- Attributes"]
            ScreenshotCapture["ğŸ“¸ Screenshot Capture<br/>(Fallback - 10%)<br/>- Vision Processing<br/>- OCR"]
        end
        
        PlaywrightCtrl --> A11yExtractor
        PlaywrightCtrl --> DOMParser
        PlaywrightCtrl --> ScreenshotCapture
        
        ActionExecutor["ğŸ¬ Action Executor<br/>- Keyboard Events<br/>- Mouse Events<br/>- Form Submission"]
        
        A11yExtractor --> ActionExecutor
        DOMParser --> ActionExecutor
    end
    
    %% ============= BROWSER ENGINE =============
    subgraph BrowserEngine["ğŸŒ BROWSER ENGINE"]
        Chromium["ğŸŒ Headless Chromium<br/>- Rendering Engine<br/>- V8 JavaScript<br/>- Network Stack<br/>- Cookie Manager"]
    end
    
    %% ============= EXTERNAL SERVICES & DATA =============
    subgraph ExternalServices["â˜ï¸ EXTERNAL SERVICES & DATA LAYER"]
        direction TB
        
        subgraph LLMProviders["ğŸ¤– LLM Providers"]
            OpenAI["OpenAI<br/>GPT-4 Turbo"]
            Anthropic["Anthropic<br/>Claude 3.5"]
            GeminiLLM["Google<br/>Gemini"]
        end
        
        subgraph Observability["ğŸ“Š Observability"]
            LangFuse["LangFuse<br/>(Trace & Monitor)"]
            Logging["Logging Service<br/>(Structured Logs)"]
        end
        
        subgraph DataStorage["ğŸ’¾ Data Storage"]
            PostgreSQL["ğŸ—„ï¸ PostgreSQL<br/>(User Data,<br/>Configs)"]
            Redis["âš¡ Redis<br/>(Cache,<br/>Message Queue)"]
            S3["ğŸ“¦ S3 Storage<br/>(Files,<br/>Reports)"]
            VectorDB["ğŸ” Vector DB<br/>(Embeddings,<br/>RAG)"]
        end
    end
    
    %% ============= CONNECTIONS =============
    
    %% Frontend to API Gateway
    WebUI --> FastAPI
    MobileApp --> FastAPI
    APIClients --> FastAPI
    WebSocket --> FastAPI
    
    %% API Gateway to Orchestration
    FastAPI --> AuthMiddleware
    AuthMiddleware --> RateLimiter
    RateLimiter --> AgentOrch
    
    %% Orchestration to Tool Registry
    ActionNode --> BrowserTools
    ActionNode --> AnalysisTools
    ActionNode --> PlanningTools
    ActionNode --> SafetyTools
    ActionNode --> ResponseTools
    
    %% Orchestration to Safety
    AgentOrch --> SafetyGate
    SafetyGate --> HumanApproval
    
    %% Tool Registry to Browser Control
    ExtractTool --> PlaywrightCtrl
    NavTool --> PlaywrightCtrl
    ClickTool --> PlaywrightCtrl
    InputTool --> PlaywrightCtrl
    ScrollTool --> PlaywrightCtrl
    
    %% Browser Control to Browser Engine
    PlaywrightCtrl --> Chromium
    ActionExecutor --> Chromium
    
    %% Browser Engine back to Page Context
    Chromium --> A11yExtractor
    Chromium --> DOMParser
    Chromium --> ScreenshotCapture
    
    %% Tool Registry to External Services
    ReasonNode --> OpenAI
    ReasonNode --> Anthropic
    FinancialAnalysis --> GeminiLLM
    
    %% Observability
    AgentOrch -.->|Logs Trace| LangFuse
    ActionNode -.->|Logs Actions| Logging
    
    %% Data Storage
    AuthMiddleware --> PostgreSQL
    RateLimiter --> Redis
    GenerateReport --> S3
    QueryAnalysis --> VectorDB
    
    %% Feedback Loops
    ObserveNode -->|Context Update| StateManagement
    ExtractTool -->|Data| AnalysisTools
    FinancialAnalysis -->|Insights| GenerateReport
    
    %% Styling
    classDef frontend fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px,color:#000
    classDef apiGateway fill:#bbdefb,stroke:#1565c0,stroke-width:2px,color:#000
    classDef orchestration fill:#fff9c4,stroke:#f57f17,stroke-width:3px,color:#000
    classDef toolRegistry fill:#f3e5f5,stroke:#6a1b9a,stroke-width:2px,color:#000
    classDef browser fill:#ffe0b2,stroke:#e65100,stroke-width:2px,color:#000
    classDef engine fill:#ffccbc,stroke:#bf360c,stroke-width:2px,color:#000
    classDef external fill:#cfd8dc,stroke:#37474f,stroke-width:2px,color:#000
    
    class Frontend frontend
    class APIGateway apiGateway
    class Orchestration,ReActLoop orchestration
    class ToolRegistry,BrowserTools,AnalysisTools,PlanningTools,SafetyTools,ResponseTools toolRegistry
    class BrowserControl,PageContext browser
    class BrowserEngine engine
    class ExternalServices,LLMProviders,Observability,DataStorage external

```



