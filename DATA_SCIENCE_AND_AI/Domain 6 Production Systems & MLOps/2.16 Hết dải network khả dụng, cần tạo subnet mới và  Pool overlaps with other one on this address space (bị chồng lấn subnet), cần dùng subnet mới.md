```
=> CACHED [intent-api 8/10] RUN pip3 install --no-cache-dir --upgrade pip && pip3 install --no-cache-dir -r /app/requi 0.0s => CACHED [intent-api 9/10] COPY src/ /app/src/ 0.0s => CACHED [intent-api 10/10] RUN mkdir -p /app/src/logs 0.0s => [intent-api] exporting to image 0.0s => => exporting layers 0.0s => => writing image sha256:f82813ab1604d9c58868f6d27b9ac37fdf15a01eb3c227088b45a42362d255f4 0.0s => => naming to docker.io/library/miniprod_nlp2_intentclassification_mappingfastresponse_t1_2025_stepupeducation-intent-api 0.0s [+] Running 1/0 ‚úò Network miniprod_nlp2_intentclassification_mappingfastresponse_t1_2025_stepupeducation_intent-network Error 0.0s failed to create network miniprod_nlp2_intentclassification_mappingfastresponse_t1_2025_stepupeducation_intent-network: Error response from daemon: could not find an available, non-overlapping IPv4 address pool among the defaults to assign to the network Œ∏73¬∞ [ubuntu@mgc-dev2-3090:~/truc_ai/MiniProd_NLP2_IntentClassification_MappingFastResponse_T1_2025_StepUpEducation/src] master(+10/-4)* ¬± L·ªói g√¨ ƒë√¢y nh·ªâ
```

## 1. V·∫•n ƒë·ªÅ g·∫∑p ph·∫£i

### L·ªói ch√≠nh

```
failed to create network miniprod_nlp2_intentclassification_mappingfastresponse_t1_2025_stepupeducation_intent-network: 
Error response from daemon: could not find an available, non-overlapping IPv4 address pool among the defaults to assign to the network
```

### Tri·ªáu ch·ª©ng

- Docker Compose kh√¥ng th·ªÉ t·∫°o custom network m·ªõi
- Container build th√†nh c√¥ng nh∆∞ng kh√¥ng th·ªÉ start do l·ªói network
- L·ªói x·∫£y ra li√™n t·ª•c d√π ƒë√£ th·ª≠ docker network prune

### Nguy√™n nh√¢n g·ªëc r·ªÖ

Docker daemon ƒë√£ c·∫°n ki·ªát c√°c d·∫£i IP kh·∫£ d·ª•ng do c√≥ qu√° nhi·ªÅu networks ƒëang t·ªìn t·∫°i tr√™n h·ªá th·ªëng.

## 2. Ki·ªÉm tra c√°c m·∫°ng hi·ªán t·∫°i

### Network inventory

H·ªá th·ªëng hi·ªán c√≥ **30+ Docker networks** ƒëang ho·∫°t ƒë·ªông:

```bash
$ docker network ls
NETWORK ID     NAME                                                                   DRIVER    SCOPE
1ee83a85e17e   ai-agent-coach_robot-ai-workflow-network-master                        bridge    local
01684692a642   ai-agent-master_robot-ai-workflow-network-master                       bridge    local
22a276825d4a   ai-agent-noti_robot-ai-workflow-network-master                         bridge    local
b4815173bfb5   ai-agent-router-dev_robot-ai-workflow-network-master                   bridge    local
# ... v√† 25+ networks kh√°c
```

```bash
docker network ls -q | xargs -n1 docker network inspect --format '{{.Name}}: {{range .IPAM.Config}}{{.Subnet}} (gw {{.Gateway}}){{end}}'

```

```
Œ∏74¬∞ [ubuntu@mgc-dev2-3090:~/cuong_dn/robot-lesson-workflow/utils/UI] manual-refactor-agent-registry(+9/-4)+* ¬± docker network ls -q | xargs -n1 docker network inspect --format '{{.Name}}: {{range .IPAM.Config}}{{.Subnet}} (gw {{.Gateway}}){{end}}'
ai-agent-coach_robot-ai-workflow-network-master: 192.168.160.0/20 (gw 192.168.160.1)
ai-agent-master_robot-ai-workflow-network-master: 172.22.0.0/16 (gw 172.22.0.1)
ai-agent-noti_robot-ai-workflow-network-master: 172.24.0.0/16 (gw 172.24.0.1)
ai-agent-router-dev_robot-ai-workflow-network-master: 192.168.224.0/20 (gw 192.168.224.1)
ai-agent-router_robot-ai-workflow-network-master: 192.168.144.0/20 (gw 192.168.144.1)
ai_service_default: 172.23.0.0/16 (gw 172.23.0.1)
bridge: 172.17.0.0/16 (gw 172.17.0.1)
deploy_default: 172.31.0.0/16 (gw 172.31.0.1)
deployapi_server_default: 192.168.192.0/20 (gw 192.168.192.1)
deployproduction_intent_network: 192.168.128.0/20 (gw 192.168.128.1)
dify_default_dev: 192.168.176.0/20 (gw 192.168.176.1)
dify_ssrf_proxy_network_dev: 192.168.112.0/20 (gw 192.168.112.1)
docker_default: 172.25.0.0/16 (gw 172.25.0.1)
docker_ssrf_proxy_network: 192.168.240.0/20 (gw 192.168.240.1)
host: 
kokoro_default: 172.26.0.0/16 (gw 172.26.0.1)
langfuse_default: 170.28.0.0/24 (gw )
langgraph_n8n_langgraph-n8n-network-master: 172.19.0.0/16 (gw 172.19.0.1)
legal_rag: 192.168.80.0/20 (gw 192.168.80.1)
lesson-builder-backend_web: 170.26.0.0/24 (gw )
ls_ai_automation_default: 172.28.0.0/16 (gw 172.28.0.1)
milvus: 172.21.0.0/16 (gw 172.21.0.1)
miniprod_nlp2_intentclassification_mappingfastresponse_t1_2025_stepupeducation_intent-network: 10.20.0.0/24 (gw 10.20.0.1)
n8n_n8n-services-network-master: 172.18.0.0/16 (gw 172.18.0.1)
none: 
personalized-ai-coach-dev_robot-ai-workflow-network-master: 192.168.64.0/20 (gw 192.168.64.1)
personalized-ai-coach_robot-ai-workflow-network-master: 192.168.32.0/20 (gw 192.168.32.1)
prod_deploy_default: 172.29.0.0/16 (gw 172.29.0.1)
robot-ai-lesson_robot-ai-workflow-network-master: 192.168.48.0/20 (gw 192.168.48.1)
robot-ai-service_default: 172.27.0.0/16 (gw 172.27.0.1)
robot-ai-workflow-dev_robot-ai-workflow-network-dev: 172.30.0.0/16 (gw 172.30.0.1)
robot-ai-workflow_robot-ai-workflow-network-master: 192.168.0.0/20 (gw 192.168.0.1)
robot-lesson-workflow-dev_studio-ai-platform-workflow-network-master: 192.168.16.0/20 (gw 192.168.16.1)
tool_su_table_to_json_default: 192.168.208.0/20 (gw 192.168.208.1)
vioedu_vioedu-generator-math-network: 192.168.96.0/20 (gw 192.168.96.1)
voicetrans_voicetrans_app: 172.20.0.0/16 (gw 172.20.0.1)
Œ∏74¬∞ [ubuntu@mgc-dev2-3090:~/cuong_dn/robot-lesson-workflow/utils/UI] manual-refactor-agent-registry(+9/-4)+* ¬± 
```
### IP Range Analysis

T·ª´ `ip route` output, c√°c d·∫£i IP ƒëang ƒë∆∞·ª£c s·ª≠ d·ª•ng:

**172.x.x.x networks:**

- 172.17.0.0/16 (docker0 - default bridge)
- 172.18.0.0/16 ƒë·∫øn 172.31.0.0/16 (14 networks)

**192.168.x.x networks:**

- 192.168.0.0/20 ƒë·∫øn 192.168.240.0/20 (16 networks)

**170.x.x.x networks:**

- 170.26.0.0/24, 170.28.0.0/24

**T·ªïng c·ªông: 32 active networks** s·ª≠ d·ª•ng h·∫ßu h·∫øt c√°c d·∫£i IP m·∫∑c ƒë·ªãnh c·ªßa Docker.

## 3. Gi·∫£i ph√°p ƒë∆∞·ª£c √°p d·ª•ng

### B∆∞·ªõc 1: Cleanup c∆° b·∫£n

```bash
# Th·ª≠ d·ªçn d·∫πp networks kh√¥ng s·ª≠ d·ª•ng
docker network prune -f
# K·∫øt qu·∫£: Kh√¥ng c√≥ network n√†o b·ªã x√≥a (t·∫•t c·∫£ ƒë·ªÅu ƒëang ƒë∆∞·ª£c s·ª≠ d·ª•ng)
```

### B∆∞·ªõc 2: Ch·ªânh s·ª≠a Network Configuration

#### Docker Compose Configuration m·ªõi:

```yaml
version: '3.8'

services:
  intent-api:
    build: .
    container_name: intent-classification-api
    ports:
      - "20012:20012"
    env_file:
      - .env
    volumes:
      # Model persistence
      - ./src/exported_models:/app/src/exported_models
      - ./src/trained_models:/app/src/trained_models
      # Response files
      - ./src/intent_reponse.json:/app/src/intent_reponse.json
      - ./src/intent_reponse_v2.json:/app/src/intent_reponse_v2.json
      - ./src/fixed_response.json:/app/src/fixed_response.json
      # Logs
      - ./logs:/app/src/logs
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:20012/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    deploy:
      resources:
        limits:
          memory: 4G
        reservations:
          memory: 2G
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    runtime: nvidia
    networks:
      - intent-network

networks:
  intent-network:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 10.10.0.0/24
          gateway: 10.10.0.1
```

#### C√°c d·∫£i n√†o c√≥ th·ªÉ ƒë∆∞·ª£c d√πng 

- D·∫£i:¬†`10.10.0.0/24`¬†‚Üí IP usable:¬†`10.10.0.1`¬†‚Üí¬†`10.10.0.254`
- Gateway (c·ªïng ra m·∫°ng) ph·∫£i l√† m·ªôt ƒë·ªãa ch·ªâ IP h·ª£p l·ªá¬†**trong kho·∫£ng 10.10.0.1 ƒë·∫øn 10.10.0.254** 
- B√¨nh th∆∞·ªùng ng∆∞·ªùi ta hay ch·ªçn .1 v√¨ ti·ªán nh·ªõ (10.10.0.1), 
- Gateway kh√¥ng ƒë∆∞·ª£c l√†¬†`10.10.0.0`¬†(network), kh√¥ng ƒë∆∞·ª£c l√†¬†`10.10.0.255`¬†(broadcast) v√† mi·ªÖn kh√¥ng tr√πng v·ªõi c√°c container kh√°c. 
https://docs.docker.com/reference/compose-file/networks/
https://www.warp.dev/terminus/docker-compose-networks

---
# so·∫πt 24 

```
networks:
  name-network:               # t√™n m·∫°ng b·∫°n t·∫°o
    driver: bridge              # ki·ªÉu m·∫°ng: bridge (m·∫∑c ƒë·ªãnh c·ªßa Docker)
    ipam:                       # IP Address Management - qu·∫£n l√Ω d·∫£i IP
      driver: default
      config:
        - subnet: 10.200.0.0/24 # d·∫£i m·∫°ng (CIDR) d√πng cho network n√†y
          gateway: 10.200.0.1   # ƒë·ªãa ch·ªâ gateway (c·ªïng m·∫∑c ƒë·ªãnh) c·ªßa network
```

```
networks:
  name-network:               # t√™n m·∫°ng b·∫°n t·∫°o
    driver: bridge              # ki·ªÉu m·∫°ng: bridge (m·∫∑c ƒë·ªãnh c·ªßa Docker)
    ipam:                       # IP Address Management - qu·∫£n l√Ω d·∫£i IP
      driver: default
      config:
        - subnet: 10.3.0.0/24 # d·∫£i m·∫°ng (CIDR) d√πng cho network n√†y
          gateway: 10.3.0.1   # ƒë·ªãa ch·ªâ gateway (c·ªïng m·∫∑c ƒë·ªãnh) c·ªßa network
```

- B·∫°n ƒëang t·∫°o m·ªôt m·∫°ng Docker t√™n **`intent-network`**.
    
- M·∫°ng n√†y c√≥ d·∫£i IP ri√™ng: `10.200.0.0/24`.
    
- Docker s·∫Ω c·∫•p ph√°t IP cho container trong d·∫£i n√†y (v√≠ d·ª• `10.200.0.2`, `10.200.0.3`‚Ä¶).
    
- Gateway (`10.200.0.1`) l√† ‚Äúc·∫ßu n·ªëi‚Äù ƒë·ªÉ container ƒëi ra internet ho·∫∑c giao ti·∫øp v·ªõi host.

---

`/24` (so·∫πt 24) l√† c√°ch vi·∫øt t·∫Øt trong **CIDR notation** (Classless Inter-Domain Routing) ƒë·ªÉ ch·ªâ ƒë·ªô d√†i **subnet mask**.

- `/24` nghƒ©a l√† **24 bit ƒë·∫ßu ti√™n** c·ªßa ƒë·ªãa ch·ªâ IP d√πng ƒë·ªÉ x√°c ƒë·ªãnh **network**, c√≤n l·∫°i **8 bit cu·ªëi** ƒë·ªÉ ƒë√°nh s·ªë host.
    
- Subnet mask t∆∞∆°ng ·ª©ng l√† **255.255.255.0**.
    
- Nh∆∞ v·∫≠y, m·ªôt m·∫°ng `/24` c√≥ th·ªÉ ch·ª©a t·ªëi ƒëa **256 ƒë·ªãa ch·ªâ IP** (t·ª´ `.0` ƒë·∫øn `.255`), trong ƒë√≥:
    
    - `.0` l√† ƒë·ªãa ch·ªâ network,
        
    - `.255` l√† ƒë·ªãa ch·ªâ broadcast,
        
    - c√≤n l·∫°i ~254 ƒë·ªãa ch·ªâ d√†nh cho host/container.
        

V√≠ d·ª•:

- `10.200.0.0/24` ‚Üí d·∫£i IP kh·∫£ d·ª•ng: `10.200.0.1` ƒë·∫øn `10.200.0.254`.
    
- `192.168.1.0/24` ‚Üí d·∫£i IP kh·∫£ d·ª•ng: `192.168.1.1` ƒë·∫øn `192.168.1.254`.
    

üëâ N·∫øu b·∫°n ƒë·ªÉ `/16` th√¨ s·∫Ω c√≥ 65,534 IP kh·∫£ d·ª•ng (qu√° r·ªông, d·ªÖ xung ƒë·ªôt).  
üëâ V·ªõi Docker, th∆∞·ªùng d√πng `/24` ƒë·ªÉ ƒë·ªß ch·ªó cho v√†i container nh∆∞ng kh√¥ng chi·∫øm nhi·ªÅu d·∫£i IP.


---
# 4. Ch√∫ √Ω v·∫•n ƒë·ªÅ: ch·ªìng l·∫•n subnet  


Kh√¥ng ƒë∆∞·ª£c. N·∫øu hai file Docker Compose khai b√°o hai network v·ªõi **c√πng m·ªôt subnet**, d√π gateway kh√°c, th√¨ Docker v·∫´n b√°o l·ªói "Pool overlaps with other one on this address space" v√† kh√¥ng cho ph√©p t·∫°o.[docker+2](https://docs.docker.com/reference/cli/docker/network/create/)

## Gi·∫£i th√≠ch

- Docker y√™u c·∫ßu c√°c network kh√¥ng ƒë∆∞·ª£c s·ª≠ d·ª•ng c√°c subnet b·ªã tr√πng ho·∫∑c ch·ªìng l·∫•n nhau‚Äîeven n·∫øu gateway kh√°c, subnet v·∫´n l√† ph·∫°m vi ƒë·ªãa ch·ªâ IP n√™n s·∫Ω b·ªã l·ªói overlap.[thorsell+1](https://thorsell.io/2024/02/05/docker-network.html)
    
- Gateway ch·ªâ l√† ƒë·ªãa ch·ªâ m·∫∑c ƒë·ªãnh routing trong subnet, nh∆∞ng subnet th√¨ ƒë·∫°i di·ªán cho to√†n b·ªô d·∫£i ƒë·ªãa ch·ªâ m√† network qu·∫£n l√Ω. Vi·ªác tr√πng subnet s·∫Ω d·∫´n t·ªõi xung ƒë·ªôt NAT/routing, n√™n gateway kh√°c c≈©ng kh√¥ng ƒë∆∞·ª£c ph√©p.[stackoverflow+2](https://stackoverflow.com/questions/67674332/docker-network-bridge-overlapping-with-ip-addressing-used-for-the-vpn-clients-on)

- N·∫øu mu·ªën c√≥ hai network ri√™ng bi·ªát, ph·∫£i d√πng hai subnet kh√°c nhau, v√≠ d·ª•:
    
    - Network A: `10.10.0.0/24`
        
    - Network B: `10.20.0.0/24`
        
- Gateway c√≥ th·ªÉ ƒë·∫∑t t√πy √Ω trong m·ªói subnet (nh∆∞ng kh√¥ng ƒë∆∞·ª£c tr√πng subnet).
    

Docker s·∫Ω ch·ªâ cho ph√©p t·∫°o nhi·ªÅu network n·∫øu subnet ho√†n to√†n kh√¥ng ch·ªìng l·∫•n nhau, gateway kh√¥ng ·∫£nh h∆∞·ªüng t·ªõi ƒëi·ªÅu ki·ªán n√†y.[docker+2](https://docs.docker.com/reference/cli/docker/network/create/)

1. [https://docs.docker.com/reference/cli/docker/network/create/](https://docs.docker.com/reference/cli/docker/network/create/)
2. [https://thorsell.io/2024/02/05/docker-network.html](https://thorsell.io/2024/02/05/docker-network.html)
3. [https://stackoverflow.com/questions/67674332/docker-network-bridge-overlapping-with-ip-addressing-used-for-the-vpn-clients-on](https://stackoverflow.com/questions/67674332/docker-network-bridge-overlapping-with-ip-addressing-used-for-the-vpn-clients-on)
4. [https://forums.docker.com/t/docker-compose-multiple-networks/128718](https://forums.docker.com/t/docker-compose-multiple-networks/128718)
5. [https://stackoverflow.com/questions/38088279/communication-between-multiple-docker-compose-projects](https://stackoverflow.com/questions/38088279/communication-between-multiple-docker-compose-projects)
6. [https://www.reddit.com/r/docker/comments/ldkmry/how_to_run_two_docker_hosts_with_macvlan_on_the/](https://www.reddit.com/r/docker/comments/ldkmry/how_to_run_two_docker_hosts_with_macvlan_on_the/)
7. [https://docs.docker.com/compose/how-tos/networking/](https://docs.docker.com/compose/how-tos/networking/)
8. [https://www.netmaker.io/resources/docker-compose-network](https://www.netmaker.io/resources/docker-compose-network)
9. [https://github.com/moby/moby/issues/20179](https://github.com/moby/moby/issues/20179)
10. [https://docs.docker.com/engine/network/](https://docs.docker.com/engine/network/)
11. [https://github.com/moby/moby/issues/26912](https://github.com/moby/moby/issues/26912)
12. [https://forums.docker.com/t/network-with-255-255-255-255-as-subnet/79321](https://forums.docker.com/t/network-with-255-255-255-255-as-subnet/79321)
13. [https://stackoverflow.com/questions/50514275/docker-bridge-conflicts-with-host-network](https://stackoverflow.com/questions/50514275/docker-bridge-conflicts-with-host-network)
14. [https://philippmundhenk.github.io/Docker_IP_addresses/](https://philippmundhenk.github.io/Docker_IP_addresses/)


# 5. Summay Ph√¢n bi·ªát 2 lo·∫°i l·ªói tr√™n 

| Lo·∫°i l·ªói                 | Th√¥ng b√°o l·ªói                                                                                              | Nguy√™n nh√¢n                                                         | V√≠ d·ª• subnet                                                             | Gi·∫£i ph√°p                                                                                                                                                                                                                                                                                                                              |
| ------------------------ | ---------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------- | ------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| H·∫øt d·∫£i network kh·∫£ d·ª•ng | could not find an available, non-overlapping IPv4 address pool among the defaults to assign to the network | Docker ƒë√£ d√πng h·∫øt d·∫£i IP m·∫∑c ƒë·ªãnh ho·∫∑c c√°c subnet kh√¥ng c√≤n ƒë·ªß nh·ªè | C√≥ nhi·ªÅu m·∫°ng/16chi·∫øm g·∫ßn h·∫øt 172.x.x.x, 192.168.x.x m·∫∑c ƒë·ªãnh            | - D√πng m·ªôt subnet ho√†n to√†n m·ªõi ngo√†i v√πng ƒë√£ b·ªã Docker chi·∫øm h·∫øt (v√≠ d·ª• d√πng d·∫£i10.x.x.x/24thay v√¨ c√°c d·∫£i m·∫∑c ƒë·ªãnh) - X√≥a b·ªõt c√°c network kh√¥ng s·ª≠ d·ª•ng (docker network pruneho·∫∑cdocker network rm <network_name>) - M·ªü r·ªông/add th√™m pools kh·∫£ d·ª•ng trong/etc/docker/daemon.jsonv·ªõidefault-address-pools, r·ªìi restart Docker daemon |
| Ch·ªìng l·∫•n (overlap)      | Pool overlaps with other one on this address space                                                         | Hai network d√πng c√πng ho·∫∑c ch·ªìng l·∫•n subnet, d√π gateway kh√°c nhau   | A:10.10.0.0/24 B:10.10.0.0/24 Ho·∫∑c: A:10.10.0.0/16, B:10.10.1.0/24       | - ƒê·ªïi sang subnet/d·∫£i IP ch∆∞a b·ªã tr√πng ho·∫∑c ch·ªìng v·ªõi network n√†o kh√°c - Ki·ªÉm tra subnet c√°c network hi·ªán c√≥ tr∆∞·ªõc khi khai b√°o m·ªõi b·∫±ngdocker network ls,docker network inspect - X√≥a c√°c network kh√¥ng c√≤n c·∫ßn d√πng n·∫øu b·ªã tr√πng                                                                                                     |

# 6. Check d·∫£i network

```bash
docker network ls -q | xargs -n1 docker network inspect \ --format '{{.Name}}: {{range .IPAM.Config}}{{.Subnet}}{{end}}'
```

```
docker network ls -q | xargs -n1 docker network inspect \ --format '{{.Name}}: {{range .IPAM.Config}}{{.Subnet}}{{end}}'
```