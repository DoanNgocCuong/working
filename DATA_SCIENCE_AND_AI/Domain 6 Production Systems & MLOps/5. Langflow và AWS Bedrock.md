# Langflow và AWS Bedrock

## Hướng dẫn Setup Langflow với AWS Bedrock

### Tổng quan Workflow

| Bước | Nội dung chi tiết |
|------|-------------------|
| 1. Chuẩn bị môi trường | - Đã có tài khoản AWS, bật dịch vụ Bedrock<br>- Có API Key/credentials AWS<br>- Đã cài Langflow trên server/local hoặc cloud Docker/K8s |
| 2. Tạo Project/Flow mới | - Đăng nhập Langflow, tạo New Project → Blank Flow hoặc chọn template |
| 3. Thêm component "Amazon Bedrock Adapter" | - Tìm và kéo thả khối "Amazon Bedrock" vào flow<br>- Kết nối với block Input |
| 4. Thiết lập thông số Bedrock | Điền các thông số:<br>- aws_access_key_id<br>- aws_secret_access_key<br>- aws_session_token (nếu dùng)<br>- region_name<br>- model_id<br>- endpoint_url (nếu cần) |
| 5. Kết nối các component | - Input → Bedrock Adapter → Output<br>- Có thể tích hợp AstraDB cho vector/RAG |
| 6. Run/Test flow | - Bấm Run để kiểm tra<br>- Test response, luồng truyền dữ liệu |
| 7. Xử lý lỗi | - Xem log, debug lỗi xác thực<br>- Đảm bảo output đúng format |
| 8. Optimize và mở rộng | - Tối ưu prompt, logic agent<br>- Scale lên K8s/Docker nếu cần |
| 9. Demo/migrate production | - Demo trên cloud<br>- Xuất flow dưới dạng API |

---

## Cách lấy AWS Credentials

| Trường trong Langflow | Cách lấy/Giải thích nguồn |
|----------------------|---------------------------|
| **AWS Access Key ID** | 1. Vào AWS Console → IAM<br>2. Chọn "Users" → chọn user muốn lấy key<br>3. Vào tab "Security credentials"<br>4. Bấm "Create access key" nếu chưa có<br>5. Copy "Access key ID" |
| **AWS Secret Access Key** | - Khi tạo "Access key", AWS sẽ hiển thị cả "Secret access key"<br>- Lưu ý: Secret Access Key chỉ hiện 1 lần khi tạo<br>- Nếu quên phải tạo lại key mới |
| **AWS Session Token** | - Chỉ cần nếu dùng temp credentials hoặc role được STS cấp<br>- Có thể bỏ trống nếu dùng Access Key chuẩn |
| **Region Name** | - Điền region AWS mà bạn đã cấu hình Bedrock<br>- Ví dụ: "us-east-1", "ap-southeast-2" |

---

## Thêm Model mới vào Langflow

Để add model không có sẵn trong Langflow:

1. Tạo một Agent với Bedrock làm LLM
2. Nhấn vào "Code" để edit code của component
3. Thêm đoạn code sau vào sau phần Import và trước phần khai báo class:

```python
AWS_MODEL_IDs = AWS_MODEL_IDs + [
    "openai.gpt-oss-20b-1:0", 
    "openai.gpt-oss-120b-1:0", 
    "anthropic.claude-haiku-4-5-20251001-v1:0", 
    "anthropic.claude-sonnet-4-5-20250929-v1:0"
]
```

Sau đó bạn sẽ chọn được model này trong list.

**Thông tin model Bedrock**: https://docs.aws.amazon.com/bedrock/latest/userguide/models-supported.html

---

## Loại Key AWS

| Loại Key | Mục đích, phạm vi, cách dùng |
|----------|------------------------------|
| **AWS Access Key ID & Secret Access Key (IAM)** | - Cấp từ dịch vụ IAM<br>- Dùng để xác thực truy cập tất cả API dịch vụ AWS<br>- Phạm vi rộng, quản lý tập trung qua IAM<br>- Nếu bị lộ có thể truy cập nhiều dịch vụ AWS |
| **Bedrock API Key** | - Tạo trực tiếp trong Amazon Bedrock Console<br>- Chỉ dùng để xác thực với Amazon Bedrock API<br>- Tùy cấu hình: short-term (12h) hoặc long-term (1 năm)<br>- Phạm vi giới hạn, chỉ cho Bedrock |

---

## MCP Server với Langflow

### Các MCP Server cần build:

1. **MCP Server để trích dẫn điều khoản từ UCP 600 hoặc ISBP 821**
   - Implement bằng file
   - Agent đọc file, dùng LLM xử lý nội dung
   - Expose thành MCP Server trên Langflow với SSE

2. **MCP Server để access Business Handbook**
   - Tương tự như trên

### Cách hoạt động:

- Tên và Description của Flow sẽ chính là tool và description
- Gọi tool này từ một flow khác là được

### Test:

Thử prompt một vài thư hoặc chat hỏi đáp với UPC 600 và ISBP.


