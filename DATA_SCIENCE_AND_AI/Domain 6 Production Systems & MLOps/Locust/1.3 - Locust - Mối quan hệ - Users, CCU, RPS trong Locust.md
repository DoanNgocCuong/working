## Mối quan hệ: Users, CCU, RPS trong Locust

### Công thức cốt lõi

```
RPS = Users / (Response Time + Wait Time)
```

### Giải thích

| Thuật ngữ          | Ý nghĩa                                           |
| ------------------ | ------------------------------------------------- |
| **Users (Locust)** | Số virtual users đang chạy đồng thời = CCU        |
| **CCU**            | Concurrent Users = chính là số Users trong Locust |
| **RPS**            | Số requests server nhận được mỗi giây             |

### Ví dụ thực tế

```
Users = 100
Response Time = 0.1s (100ms)
Wait Time = 2.0s (trung bình của 1-3s)

RPS = 100 / (0.1 + 2.0) = 100 / 2.1 ≈ 48 RPS
```

### Tại sao 100 users không phải 100 RPS?

Vì mỗi user phải **đợi** giữa các request:

```
User 1: [Request 0.1s] → [Wait 2s] → [Request 0.1s] → [Wait 2s] → ...
User 2: [Request 0.1s] → [Wait 2s] → [Request 0.1s] → [Wait 2s] → ...
...
```

Mỗi user chỉ gửi được **1 request / 2.1 giây**, không phải 1 request/giây.

### Muốn tăng RPS?

|Cách|Hệ quả|
|---|---|
|Tăng Users|Tăng tải server|
|Giảm Wait Time|Tăng tần suất request/user|
|Giảm Response Time|Server xử lý nhanh hơn|


# Ơ, nhưng nếu đặt wait là 1-3 giây thì khi để 100 user dùng thì RPS có 48 ??? THẾ ĐÃ PHẢN ÁNH ĐÚNG cái CCU=100 chưa ?

## RPS 48 Có Phản Ánh Đúng CCU=100 Không?

**Có, hoàn toàn đúng.** Với 100 user, response time 0.1s + wait 1-3s (trung bình 2s), mỗi user gửi ~1 request / 2.1s, nên tổng RPS ≈ 100 / 2.1 = 48. Đây chính là CCU=100 thực tế, vì Locust Users = số người dùng đồng thời đang hoạt động song song.[github+1](https://github.com/locustio/locust/issues/646)​

## Tại Sao RPS < Users Là Bình Thường?

- **Mỗi user có chu kỳ riêng**: User1 gửi request → chờ 2s → gửi tiếp; User2 lệch pha một chút → tổng 48 request/giây từ 100 user cùng lúc.[github](https://github.com/locustio/locust/issues/646)​
    
- **Công thức chuẩn**: RPS = Users / (Response Time + Avg Wait Time), khớp chính xác ví dụ của bạn.[stackoverflow+1](https://stackoverflow.com/questions/27713104/locust-io-controlling-the-request-per-second-parameter)​
    
- **CCU server cũng =100**: Server thấy ~100 kết nối đồng thời, xử lý 48 req/s - phản ánh đúng tải thực tế.[stackoverflow](https://stackoverflow.com/questions/68466767/locust-take-response-time-out-of-rps-equation)​
    

## Kiểm Tra Thực Tế

Chạy test và xem server logs: số concurrent connections ≈100, RPS≈48 → đã đúng. Nếu muốn RPS=100, giảm wait_time xuống ~0s (nhưng không thực tế cho web app) hoặc dùng `constant_throughput(1)`. Stress test mục tiêu là CCU thực, không phải RPS max.[locust+1](https://docs.locust.io/en/stable/writing-a-locustfile.html)​

1. [https://github.com/locustio/locust/issues/646](https://github.com/locustio/locust/issues/646)
2. [https://docs.locust.io/en/stable/writing-a-locustfile.html](https://docs.locust.io/en/stable/writing-a-locustfile.html)
3. [https://github.com/locustio/locust/issues/2399](https://github.com/locustio/locust/issues/2399)
4. [https://stackoverflow.com/questions/27713104/locust-io-controlling-the-request-per-second-parameter](https://stackoverflow.com/questions/27713104/locust-io-controlling-the-request-per-second-parameter)
5. [https://learn.microsoft.com/en-us/azure/app-testing/load-testing/concept-load-testing-concepts](https://learn.microsoft.com/en-us/azure/app-testing/load-testing/concept-load-testing-concepts)
6. [https://docs.locust.io/en/stable/api.html](https://docs.locust.io/en/stable/api.html)
7. [https://coffeebytes.dev/en/python/how-to-measure-requests-per-second-with-locust-in-python/](https://coffeebytes.dev/en/python/how-to-measure-requests-per-second-with-locust-in-python/)
8. [https://community.cratedb.com/t/load-testing-cratedb-using-locust/1686](https://community.cratedb.com/t/load-testing-cratedb-using-locust/1686)
9. [https://www.diva-portal.org/smash/get/diva2:685934/FULLTEXT01.pdf](https://www.diva-portal.org/smash/get/diva2:685934/FULLTEXT01.pdf)
10. [https://stackoverflow.com/questions/68466767/locust-take-response-time-out-of-rps-equation](https://stackoverflow.com/questions/68466767/locust-take-response-time-out-of-rps-equation)
