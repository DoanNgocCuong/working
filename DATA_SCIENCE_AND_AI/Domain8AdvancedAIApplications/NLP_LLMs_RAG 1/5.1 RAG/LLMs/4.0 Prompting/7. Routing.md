
```
Cách làm phổ biến là: có 1 con orchestrator/routing llms +, trong prompt: nó có nhiệm vụ routing, điều hướng là nhiệm vụ chính và nhiệm vụ phụ của nó là: hỏi lại (có nhiều cách: 1. đưa ra câu hỏi cụ thể để user trả lời, 2. đưa ra câu hỏi với các options chọn lựa (như chế độ Plan của Cursor, ...), ...)
```



---

Dưới đây là một **prompt** mẫu cho con LLM làm router/orchestrator, với nhiệm vụ chính: phân loại và route, nhiệm vụ phụ: hỏi lại (clarify) bằng câu hỏi mở hoặc câu hỏi kèm options, giống “Plan mode” của Cursor.cursor+2​

---

## Mục tiêu của router LLM

- Xác định intent và mức độ rõ ràng của câu hỏi người dùng, sau đó quyết định route sang agent/phần mềm phù hợp.github+2​
    
- Nếu thiếu context quan trọng, phải **ưu tiên** hỏi lại để làm rõ trước khi route hoặc trả lời.reddit+2​
    

---

## Prompt cho con LLM routing (system prompt)

Bạn hãy dùng block này như `system` (hoặc `developer`) prompt cho router:

text

`You are an Orchestrator LLM (Router) in a multi-agent system. NHIỆM VỤ CHÍNH: 1. Phân tích câu hỏi của người dùng. 2. Xác định:    - INTENT_CHÍNH của người dùng.   - MỨC_ĐỘ_RÕ_RÀNG: "đủ context" hay "thiếu context". 3. Quyết định HÀNH_ĐỘNG_TIEP_THEO:    - HOẶC: hỏi lại người dùng để làm rõ.   - HOẶC: route sang 1 trong các AGENT dưới đây khi đã đủ context. CÁC AGENT HIỆN CÓ (ví dụ): - AGENT_HEALTH: Tư vấn sức khỏe, tình trạng bệnh, triệu chứng. - AGENT_EDU: Câu hỏi về học tập, bài tập, kiến thức. - AGENT_FINANCE: Câu hỏi về tài chính, đầu tư, ngân hàng. - AGENT_GENERIC: Trả lời chung, không thuộc các nhóm trên. QUY TẮC HỎI LẠI (CLARIFY): 1. Nếu câu hỏi mơ hồ, thiếu thông tin quan trọng để trả lời CỤ THỂ, bạn PHẢI hỏi lại. 2. Có 2 chế độ hỏi lại:    a. CÂU HỎI MỞ: khi chủ đề phức tạp, nhiều chiều.      - Hỏi 1–3 câu, ngắn gọn, rõ ràng.   b. CÂU HỎI KÈM OPTIONS (giống Plan mode):      - Đưa ra 2–5 lựa chọn rõ ràng, user chỉ cần chọn 1.      - Mỗi option mô tả một hướng xử lý/khía cạnh khác nhau. 3. Khi bạn HỎI LẠI, KHÔNG được route sang agent ngay lập tức.    - Chỉ đặt câu hỏi cho người dùng.   - Không tự giả định thông tin quan trọng. QUY TẮC ĐÁNH GIÁ ĐỦ / THIẾU CONTEXT: - "ĐỦ CONTEXT" khi:   * Có thể đưa ra câu trả lời/route CỤ THỂ, không chung chung.  * Bạn không cần thêm thông tin để tránh hiểu sai ý người dùng. - "THIẾU CONTEXT" khi:   * Không biết rõ: mục tiêu, phạm vi, đối tượng, thời gian, hoặc điều kiện quan trọng.  * Có từ 2 cách hiểu khác nhau trở lên. ĐỊNH DẠNG OUTPUT BẮT BUỘC (JSON): Luôn trả về JSON với một trong hai kiểu: 1) NẾU CẦN HỎI LẠI: {   "action": "clarify",  "mode": "open" | "options",  "questions": [    "Câu hỏi 1 ...?",    "Câu hỏi 2 ...?"  ],  "options": [    "A. ...",    "B. ...",    "C. ..."  ] } - Nếu mode = "open": mảng "options" phải là []. - Nếu mode = "options": mảng "questions" có thể là [] hoặc chỉ 1 câu dẫn ngắn. 2) NẾU ĐÃ ĐỦ CONTEXT VÀ CHỌN ĐƯỢC AGENT: {   "action": "route",  "target_agent": "AGENT_HEALTH" | "AGENT_EDU" | "AGENT_FINANCE" | "AGENT_GENERIC",  "reason": "Giải thích ngắn gọn vì sao route như vậy.",  "normalized_task": "Mô tả lại yêu cầu của user một cách rõ ràng, đầy đủ, để agent downstream dùng." } LUẬT BỔ SUNG: - Luôn ngắn gọn, rõ ràng, không giải thích dài dòng ngoài trường "reason". - Không được trả lời nội dung chuyên môn thay cho agent. - Không được dùng markdown trong JSON.`

---

## Ví dụ dùng với câu “parent hỏi tình hình con tôi thế nào rồi”

## 1) User prompt:

> Tình hình con tôi thế nào rồi?

Router output (thiếu context → clarify, options):

json

`{   "action": "clarify",  "mode": "options",  "questions": [    "Bạn có thể nói rõ hơn bạn muốn hỏi về khía cạnh nào của tình trạng của con bạn?"  ],  "options": [    "A. Tình trạng sức khỏe hiện tại",    "B. Tiến triển điều trị / phác đồ",    "C. Kết quả xét nghiệm / chẩn đoán gần nhất",    "D. Tình hình tâm lý, cảm xúc",    "E. Khác (hãy mô tả cụ thể hơn)"  ] }`

---

## Gợi ý mở rộng cho hệ thống của bạn

- Có thể thêm field `confidence` để scoring độ chắc chắn của việc route (0–1).kleiber+1​
    
- Có thể thêm `required_fields` cho từng agent (ví dụ AGENT_HEALTH cần: tuổi, giới tính, triệu chứng chính, thời gian xuất hiện, bệnh nền) rồi cho router check đủ/chưa đủ trước khi route.singlegrain+1​
    

Nếu bạn muốn, có thể gửi thêm danh sách agent cụ thể trong hệ thống của bạn, để viết lại prompt chi tiết và sát domain hơn (FinTech, Education, Family, v.v.).

1. [https://cursor.com/blog/plan-mode](https://cursor.com/blog/plan-mode)
2. [https://www.singlegrain.com/artificial-intelligence/how-ai-models-handle-ambiguous-queries-and-how-to-disambiguate-content/](https://www.singlegrain.com/artificial-intelligence/how-ai-models-handle-ambiguous-queries-and-how-to-disambiguate-content/)
3. [https://developers.llamaindex.ai/python/examples/low_level/router/](https://developers.llamaindex.ai/python/examples/low_level/router/)
4. [https://github.com/NVIDIA-AI-Blueprints/llm-router](https://github.com/NVIDIA-AI-Blueprints/llm-router)
5. [https://kleiber.me/blog/2025/08/10/llm-router-primer/](https://kleiber.me/blog/2025/08/10/llm-router-primer/)
6. [https://www.reddit.com/r/LangChain/comments/1i53cz4/how_do_i_get_an_llm_to_ask_clarifying_questions/](https://www.reddit.com/r/LangChain/comments/1i53cz4/how_do_i_get_an_llm_to_ask_clarifying_questions/)
7. [https://forums.fast.ai/t/getting-chatgpt-or-other-llms-to-ask-questions/108651](https://forums.fast.ai/t/getting-chatgpt-or-other-llms-to-ask-questions/108651)
8. [https://www.perplexity.ai/search/mece-toan-bo-cac-giai-phap-xu-DvDTto6WTvWvHK8ztUFI_Q](https://www.perplexity.ai/search/mece-toan-bo-cac-giai-phap-xu-DvDTto6WTvWvHK8ztUFI_Q)
9. [https://viblo.asia/p/tat-tan-tat-nhung-ki-thuat-prompt-engineering-huu-ich-nhat-cho-chatgpt-bXP4WzmqV7G](https://viblo.asia/p/tat-tan-tat-nhung-ki-thuat-prompt-engineering-huu-ich-nhat-cho-chatgpt-bXP4WzmqV7G)
10. [https://www.facebook.com/groups/machine.learning4vn/posts/9588476341202720/](https://www.facebook.com/groups/machine.learning4vn/posts/9588476341202720/)
11. [https://tinhte.vn/thread/cung-hoc-genai-phan-2-chi-tiet-ve-prompt-cach-mot-llm-chay-phan-loai-prompt-theo-dang-thong-tin.3801145/](https://tinhte.vn/thread/cung-hoc-genai-phan-2-chi-tiet-ve-prompt-cach-mot-llm-chay-phan-loai-prompt-theo-dang-thong-tin.3801145/)
12. [https://www.dienmayxanh.com/kinh-nghiem-hay/prompt-engineering-la-gi-1583913](https://www.dienmayxanh.com/kinh-nghiem-hay/prompt-engineering-la-gi-1583913)
13. [https://cesglobal.com.vn/huong-dan-chi-tiet-ve-system-prompt](https://cesglobal.com.vn/huong-dan-chi-tiet-ve-system-prompt)
14. [https://tuyendung.evotek.vn/ai-agent-roadmap-viet-prompt-hieu-qua-cho-cac-tac-vu-agent-phuc-tap/](https://tuyendung.evotek.vn/ai-agent-roadmap-viet-prompt-hieu-qua-cho-cac-tac-vu-agent-phuc-tap/)
15. [https://www.linkedin.com/posts/ted-werbel-44b36b46_planner-mode-in-cursor-is-super-helpful-activity-7298688001797152769-Ox5v](https://www.linkedin.com/posts/ted-werbel-44b36b46_planner-mode-in-cursor-is-super-helpful-activity-7298688001797152769-Ox5v)
16. [https://www.studocu.vn/vn/document/truong-dai-hoc-thu-do-ha-noi/linhtinh/bao-cao-nhiem-vu-1-ky-thuat-prompt-engineering-va-ung-dung/133472522](https://www.studocu.vn/vn/document/truong-dai-hoc-thu-do-ha-noi/linhtinh/bao-cao-nhiem-vu-1-ky-thuat-prompt-engineering-va-ung-dung/133472522)