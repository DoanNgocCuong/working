# P2 : MANUS - Lá»™ TrÃ¬nh ToÃ n Diá»‡n Äá»ƒ LÃ m Chá»§ Thiáº¿t Káº¿ Há»‡ Thá»‘ng Agent

**TÃ¡c giáº£:** Manus AI
**PhiÃªn báº£n:** 1.0
**NgÃ y cáº­p nháº­t:** 13/12/2025
**Äá»‘i tÆ°á»£ng:** Láº­p trÃ¬nh viÃªn, kiáº¿n trÃºc sÆ° pháº§n má»m, vÃ  cÃ¡c nhÃ  lÃ£nh Ä‘áº¡o sáº£n pháº©m táº¡i Viá»‡t Nam.

---

## Lá»i Má»Ÿ Äáº§u

NÄƒm 2025 Ä‘Ã¡nh dáº¥u má»™t bÆ°á»›c ngoáº·t trong ngÃ nh cÃ´ng nghiá»‡p pháº§n má»m: sá»± trá»—i dáº­y cá»§a **Agentic AI** - cÃ¡c há»‡ thá»‘ng TrÃ­ tuá»‡ NhÃ¢n táº¡o cÃ³ kháº£ nÄƒng tá»± chá»§. KhÃ´ng cÃ²n lÃ  nhá»¯ng cÃ´ng cá»¥ thá»¥ Ä‘á»™ng chá»‰ pháº£n há»“i theo lá»‡nh, cÃ¡c agent AI cÃ³ thá»ƒ nháº­n thá»©c mÃ´i trÆ°á»ng, tá»± láº­p káº¿ hoáº¡ch, vÃ  thá»±c thi cÃ¡c hÃ nh Ä‘á»™ng phá»©c táº¡p Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c má»¥c tiÃªu. ChÃºng Ä‘áº¡i diá»‡n cho má»™t mÃ´ hÃ¬nh má»›i vá» cÃ¡ch con ngÆ°á»i vÃ  mÃ¡y mÃ³c tÆ°Æ¡ng tÃ¡c, há»©a háº¹n tá»± Ä‘á»™ng hÃ³a cÃ¡c quy trÃ¬nh nháº­n thá»©c vÃ  giáº£i quyáº¿t váº¥n Ä‘á» á»Ÿ má»™t quy mÃ´ chÆ°a tá»«ng cÃ³.

Tuy nhiÃªn, sá»± bÃ¹ng ná»• cá»§a cÃ¡c thuáº­t ngá»¯ nhÆ° "autonomous agents", "AI swarms", vÃ  cÃ¡c framework nhÆ° LangGraph, CrewAI Ä‘Ã£ táº¡o ra má»™t bá»‘i cáº£nh vá»«a thÃº vá»‹ vá»«a há»—n loáº¡n. Äá»‘i vá»›i cÃ¡c láº­p trÃ¬nh viÃªn vÃ  ká»¹ sÆ° táº¡i Viá»‡t Nam, viá»‡c náº¯m báº¯t Ä‘Æ°á»£c báº£n cháº¥t cá»§a nhá»¯ng há»‡ thá»‘ng nÃ y, phÃ¢n biá»‡t giá»¯a cÆ°á»ng Ä‘iá»‡u vÃ  thá»±c táº¿, vÃ  xÃ¢y dá»±ng má»™t lá»™ trÃ¬nh há»c táº­p cÃ³ há»‡ thá»‘ng lÃ  má»™t thÃ¡ch thá»©c lá»›n.

TÃ i liá»‡u nÃ y Ä‘Æ°á»£c táº¡o ra Ä‘á»ƒ giáº£i quyáº¿t chÃ­nh xÃ¡c thÃ¡ch thá»©c Ä‘Ã³. Vá»›i cáº¥u trÃºc **MECE (Mutually Exclusive, Collectively Exhaustive - Loáº¡i trá»« láº«n nhau, Bao hÃ m toÃ n diá»‡n)**, chÃºng tÃ´i sáº½ "má»• xáº»" toÃ n bá»™ cÃ¡c khÃ­a cáº¡nh cá»§a thiáº¿t káº¿ há»‡ thá»‘ng agent, tá»« nhá»¯ng thÃ nh pháº§n cÆ¡ báº£n nháº¥t Ä‘áº¿n cÃ¡c kiáº¿n trÃºc Ä‘a agent phá»©c táº¡p Ä‘Æ°á»£c sá»­ dá»¥ng bá»Ÿi cÃ¡c cÃ´ng ty cÃ´ng nghá»‡ hÃ ng Ä‘áº§u. Má»¥c tiÃªu cá»§a chÃºng tÃ´i khÃ´ng chá»‰ lÃ  cung cáº¥p kiáº¿n thá»©c, mÃ  lÃ  má»™t **báº£n Ä‘á»“ chi tiáº¿t**â€”má»™t lá»™ trÃ¬nh 40 trangâ€”Ä‘á»ƒ báº¥t ká»³ nhÃ  phÃ¡t triá»ƒn nÃ o cÅ©ng cÃ³ thá»ƒ tá»± tin bÆ°á»›c vÃ o lÄ©nh vá»±c Ä‘áº§y tiá»m nÄƒng nÃ y, xÃ¢y dá»±ng cÃ¡c á»©ng dá»¥ng agentic máº¡nh máº½, vÃ  trá»Ÿ thÃ nh ngÆ°á»i dáº«n Ä‘áº§u trong cuá»™c cÃ¡ch máº¡ng AI tiáº¿p theo.

---

## PHáº¦N I: Ná»€N Táº¢NG Cá»¦A Há»† THá»NG AGENT

### ChÆ°Æ¡ng 1: Giá»›i thiá»‡u vá» TÆ° duy Agentic (Agentic Thinking)

#### 1.1. Agentic AI lÃ  gÃ¬?

Äá»ƒ hiá»ƒu vá» Agentic AI, chÃºng ta cáº§n phÃ¢n biá»‡t nÃ³ vá»›i hai lÃ n sÃ³ng AI trÆ°á»›c Ä‘Ã³:

| Loáº¡i AI | MÃ´ táº£ | VÃ­ dá»¥ | Vai trÃ² |
| :--- | :--- | :--- | :--- |
| **AI PhÃ¢n tÃ­ch (Analytical AI)** | Há»c cÃ¡c máº«u tá»« dá»¯ liá»‡u lá»‹ch sá»­ Ä‘á»ƒ Ä‘Æ°a ra dá»± Ä‘oÃ¡n vá» tÆ°Æ¡ng lai. | MÃ´ hÃ¬nh dá»± Ä‘oÃ¡n giÃ¡ cá»• phiáº¿u, há»‡ thá»‘ng gá»£i Ã½ sáº£n pháº©m. | **NhÃ  phÃ¢n tÃ­ch dá»¯ liá»‡u.** |
| **AI Táº¡o sinh (Generative AI)** | Táº¡o ra ná»™i dung má»›i (vÄƒn báº£n, hÃ¬nh áº£nh, Ã¢m thanh) dá»±a trÃªn cÃ¡c máº«u Ä‘Ã£ há»c. | ChatGPT, Midjourney, Sora. | **NgÆ°á»i sÃ¡ng táº¡o ná»™i dung.** |
| **AI Agentic (Agentic AI)** | Tá»± chá»§ hÃ nh Ä‘á»™ng trong má»™t mÃ´i trÆ°á»ng Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c má»¥c tiÃªu. NÃ³ sá»­ dá»¥ng AI táº¡o sinh Ä‘á»ƒ suy luáº­n vÃ  láº­p káº¿ hoáº¡ch. | Agent tá»± Ä‘á»™ng Ä‘áº·t vÃ© mÃ¡y bay, agent quáº£n lÃ½ chuá»—i cung á»©ng. | **NgÆ°á»i thá»±c thi cÃ´ng viá»‡c.** |

**Agentic AI** lÃ  má»™t há»‡ thá»‘ng pháº§n má»m cÃ³ kháº£ nÄƒng **nháº­n thá»©c (perceive)** mÃ´i trÆ°á»ng cá»§a nÃ³, **láº­p káº¿ hoáº¡ch (plan)** má»™t chuá»—i cÃ¡c hÃ nh Ä‘á»™ng Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c má»™t má»¥c tiÃªu cá»¥ thá»ƒ, vÃ  **thá»±c thi (execute)** nhá»¯ng hÃ nh Ä‘á»™ng Ä‘Ã³ báº±ng cÃ¡ch sá»­ dá»¥ng má»™t táº­p há»£p cÃ¡c cÃ´ng cá»¥ (tools). NÃ³ lÃ  sá»± káº¿t há»£p giá»¯a kháº£ nÄƒng suy luáº­n cá»§a AI táº¡o sinh vÃ  kháº£ nÄƒng tÆ°Æ¡ng tÃ¡c vá»›i tháº¿ giá»›i thá»±c (hoáº·c tháº¿ giá»›i sá»‘) thÃ´ng qua cÃ¡c API vÃ  hÃ nh Ä‘á»™ng.

Sá»± thay Ä‘á»•i cá»‘t lÃµi tá»« Generative AI sang Agentic AI lÃ  sá»± chuyá»ƒn Ä‘á»•i tá»« **pháº£n há»“i (response)** sang **hÃ nh Ä‘á»™ng (action)**. Má»™t mÃ´ hÃ¬nh ngÃ´n ngá»¯ lá»›n (LLM) chá»‰ cÃ³ thá»ƒ cung cáº¥p cho báº¡n má»™t cÃ¢u tráº£ lá»i, nhÆ°ng má»™t agent cÃ³ thá»ƒ láº¥y cÃ¢u tráº£ lá»i Ä‘Ã³ vÃ  thá»±c hiá»‡n má»™t Ä‘iá»u gÃ¬ Ä‘Ã³ vá»›i nÃ³.

#### 1.2. Táº¡i sao 2025 lÃ  nÄƒm cá»§a Agent?

Sá»± há»™i tá»¥ cá»§a ba yáº¿u tá»‘ chÃ­nh Ä‘Ã£ táº¡o nÃªn má»™t "cÆ¡n bÃ£o hoÃ n háº£o" cho sá»± bÃ¹ng ná»• cá»§a agent:

1.  **Sá»± trÆ°á»Ÿng thÃ nh cá»§a LLM:** CÃ¡c mÃ´ hÃ¬nh nhÆ° GPT-4, Claude 3, vÃ  Gemini Ä‘Ã£ Ä‘áº¡t Ä‘áº¿n má»™t ngÆ°á»¡ng Ä‘á»§ máº¡nh máº½ Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c tÃ¡c vá»¥ suy luáº­n vÃ  láº­p káº¿ hoáº¡ch phá»©c táº¡p, vá»‘n lÃ  "bá»™ nÃ£o" cá»§a agent.
2.  **Sá»± phá»• biáº¿n cá»§a API:** Háº§u háº¿t má»i dá»‹ch vá»¥ ká»¹ thuáº­t sá»‘ ngÃ y nay Ä‘á»u cung cáº¥p API, táº¡o ra má»™t "sÃ¢n chÆ¡i" rá»™ng lá»›n Ä‘á»ƒ cÃ¡c agent cÃ³ thá»ƒ tÆ°Æ¡ng tÃ¡c vÃ  hÃ nh Ä‘á»™ng.
3.  **Sá»± phÃ¡t triá»ƒn cá»§a cÃ¡c Framework Agentic:** CÃ¡c cÃ´ng cá»¥ mÃ£ nguá»“n má»Ÿ nhÆ° LangChain, LangGraph, vÃ  CrewAI Ä‘Ã£ trá»«u tÆ°á»£ng hÃ³a pháº§n lá»›n sá»± phá»©c táº¡p trong viá»‡c xÃ¢y dá»±ng agent, cho phÃ©p cÃ¡c nhÃ  phÃ¡t triá»ƒn táº­p trung vÃ o logic nghiá»‡p vá»¥ thay vÃ¬ cÃ¡c chi tiáº¿t ká»¹ thuáº­t cáº¥p tháº¥p.

TÃ¡c Ä‘á»™ng cá»§a xu hÆ°á»›ng nÃ y Ä‘á»‘i vá»›i ngÃ nh cÃ´ng nghiá»‡p pháº§n má»m lÃ  vÃ´ cÃ¹ng to lá»›n. NÃ³ bÃ¡o trÆ°á»›c má»™t sá»± thay Ä‘á»•i tá»« viá»‡c xÃ¢y dá»±ng cÃ¡c á»©ng dá»¥ng cÃ³ giao diá»‡n ngÆ°á»i dÃ¹ng Ä‘á»“ há»a (GUI) sang viá»‡c xÃ¢y dá»±ng cÃ¡c "giao diá»‡n ngÆ°á»i dÃ¹ng ngÃ´n ngá»¯" (LUI - Language User Interfaces), nÆ¡i ngÆ°á»i dÃ¹ng chá»‰ cáº§n nÃªu ra má»¥c tiÃªu cá»§a há» báº±ng ngÃ´n ngá»¯ tá»± nhiÃªn, vÃ  má»™t Ä‘á»™i quÃ¢n cÃ¡c agent sáº½ lÃ m pháº§n cÃ²n láº¡i.

#### 1.3. Cáº¥u trÃºc tÃ i liá»‡u vÃ  Lá»™ trÃ¬nh há»c táº­p

TÃ i liá»‡u nÃ y Ä‘Æ°á»£c cáº¥u trÃºc thÃ nh bá»‘n pháº§n chÃ­nh, táº¡o thÃ nh má»™t lá»™ trÃ¬nh há»c táº­p lÅ©y tiáº¿n:

*   **Pháº§n I: Ná»n táº£ng cá»§a Há»‡ thá»‘ng Agent:** ChÃºng ta sáº½ báº¯t Ä‘áº§u báº±ng cÃ¡ch phÃ¢n tÃ­ch cáº¥u trÃºc cÆ¡ báº£n cá»§a má»™t agent, xÃ¡c Ä‘á»‹nh cÃ¡c thÃ nh pháº§n cá»‘t lÃµi theo nguyÃªn táº¯c MECE.
*   **Pháº§n II: PhÃ¢n loáº¡i cÃ¡c Kiáº¿n trÃºc vÃ  á»¨ng dá»¥ng:** ChÃºng ta sáº½ khÃ¡m phÃ¡ cÃ¡c loáº¡i kiáº¿n trÃºc agent khÃ¡c nhau, tá»« Ä‘Æ¡n giáº£n Ä‘áº¿n phá»©c táº¡p, vÃ  cÃ¡c trÆ°á»ng há»£p sá»­ dá»¥ng thá»±c táº¿ cá»§a chÃºng.
*   **Pháº§n III: Lá»™ trÃ¬nh LÃ m chá»§ Thiáº¿t káº¿ Há»‡ thá»‘ng Agent:** ÄÃ¢y lÃ  pháº§n cá»‘t lÃµi cá»§a tÃ i liá»‡u, cung cáº¥p má»™t lá»™ trÃ¬nh 5 cáº¥p Ä‘á»™ chi tiáº¿t, kÃ¨m theo cÃ¡c dá»± Ã¡n thá»±c hÃ nh cÃ³ code máº«u Ä‘á»ƒ báº¡n cÃ³ thá»ƒ xÃ¢y dá»±ng vÃ  há»c há»i.
*   **Pháº§n IV: ChuyÃªn sÃ¢u vÃ  TÆ°Æ¡ng lai:** ChÃºng ta sáº½ tháº£o luáº­n vá» cÃ¡c chá»§ Ä‘á» nÃ¢ng cao vÃ  nhÃ¬n vá» tÆ°Æ¡ng lai cá»§a lÄ©nh vá»±c agentic AI.

Báº±ng cÃ¡ch Ä‘i theo lá»™ trÃ¬nh nÃ y, báº¡n sáº½ xÃ¢y dá»±ng Ä‘Æ°á»£c má»™t ná»n táº£ng kiáº¿n thá»©c vá»¯ng cháº¯c vÃ  cÃ³ há»‡ thá»‘ng, sáºµn sÃ ng Ä‘á»ƒ chinh phá»¥c nhá»¯ng thÃ¡ch thá»©c phá»©c táº¡p nháº¥t trong lÄ©nh vá»±c thiáº¿t káº¿ há»‡ thá»‘ng agent.


### ChÆ°Æ¡ng 2: PhÃ¢n tÃ­ch MECE cÃ¡c ThÃ nh pháº§n cá»§a má»™t Agent

Äá»ƒ xÃ¢y dá»±ng má»™t há»‡ thá»‘ng agent máº¡nh máº½ vÃ  cÃ³ thá»ƒ báº£o trÃ¬, chÃºng ta khÃ´ng thá»ƒ xem nÃ³ nhÆ° má»™t "há»™p Ä‘en" bÃ­ áº©n. Thay vÃ o Ä‘Ã³, chÃºng ta pháº£i Ã¡p dá»¥ng tÆ° duy ká»¹ thuáº­t há»‡ thá»‘ng, phÃ¢n rÃ£ nÃ³ thÃ nh cÃ¡c thÃ nh pháº§n chá»©c nÄƒng riÃªng biá»‡t, khÃ´ng chá»“ng chÃ©o. Khung MECE dÆ°á»›i Ä‘Ã¢y cung cáº¥p má»™t "báº£n thiáº¿t káº¿" tiÃªu chuáº©n cho má»i agent, báº¥t ká»ƒ má»©c Ä‘á»™ phá»©c táº¡p.

Má»™t agent cÃ³ thá»ƒ Ä‘Æ°á»£c chia thÃ nh bá»‘n lá»›p (Layer) chÃ­nh, má»—i lá»›p chá»©a cÃ¡c thÃ nh pháº§n (Component) cá»¥ thá»ƒ. Bá»‘n lá»›p nÃ y Ä‘áº¡i diá»‡n cho chu trÃ¬nh xá»­ lÃ½ hoÃ n chá»‰nh cá»§a má»™t agent: tá»« viá»‡c nháº­n thÃ´ng tin Ä‘áº¿n viá»‡c thá»±c hiá»‡n hÃ nh Ä‘á»™ng.

**SÆ¡ Ä‘á»“ tá»•ng quan cÃ¡c lá»›p MECE cá»§a má»™t Agent:**

```mermaid
graph LR
    subgraph Perception
        InputProcessor
        EnvironmentMonitor
    end
    subgraph Cognition
        ReasoningEngine
        PlanningModule
        MemorySystem
    end
    subgraph Action
        ToolLibrary
        ExecutionEngine
    end
    subgraph Governance
        Guardrails
        HITL
    end

    Perception --> Cognition;
    Cognition --> Action;
    Action --> Perception;
    Governance -- Monitors & Controls --> Cognition;
    Governance -- Monitors & Controls --> Action;
```

```mermaid
%%{init: {'theme':'base', 'themeVariables': { 'primaryColor':'#e3f2fd','primaryTextColor':'#000','primaryBorderColor':'#1976d2','lineColor':'#546e7a','secondaryColor':'#fff9c4','tertiaryColor':'#c8e6c9','fontSize':'14px'}}}%%
flowchart TB
    %% External entities
    User(["ğŸ‘¨â€ğŸ’» USER INPUT<br/>Text | Voice | Image | Video"])
    
    %% ========== PERCEPTION LAYER ==========
    subgraph PERCEPTION["ğŸ” PERCEPTION LAYER - Thu tháº­p & Chuáº©n hÃ³a Context"]
        direction TB
        
        subgraph IP["ğŸ“¥ INPUT PROCESSOR"]
            direction TB
            IP1["ğŸ­ Modality Handler<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Speech-to-Text<br/>â€¢ Vision Model<br/>â€¢ File Parser"]
            IP2["ğŸ›¡ï¸ Validation & Sanitization<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Format Check<br/>â€¢ Prompt Injection Defense<br/>â€¢ Malicious Code Filter"]
            IP3["âš™ï¸ Normalization<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Unified Format<br/>â€¢ ISO Standards<br/>â€¢ JSON Structure"]
            IP1 --> IP2 --> IP3
        end
        
        subgraph EM["ğŸŒ ENVIRONMENT MONITOR"]
            direction TB
            EM1["ğŸ“Š State Tracking<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Time & Location<br/>â€¢ Order Status<br/>â€¢ API States"]
            EM2["ğŸ”„ Update Mechanism<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Real-time (WebSocket)<br/>â€¢ Periodic (Polling)<br/>â€¢ Event-driven"]
            EM3["ğŸš¨ Event Detection<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Change Detection<br/>â€¢ Trigger System<br/>â€¢ Alert Generation"]
            EM1 --> EM2 --> EM3
        end
        
        IP ~~~ EM
    end
    
    %% ========== COGNITION LAYER ==========
    subgraph COGNITION["ğŸ§  COGNITION LAYER - Suy luáº­n, Láº­p káº¿ hoáº¡ch & Ghi nhá»›"]
        direction TB
        
        subgraph RE["ğŸ’¡ REASONING ENGINE"]
            direction TB
            RE1["ğŸ¯ Model Selection<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ GPT-4o (Complex)<br/>â€¢ GPT-4o-mini (Simple)<br/>â€¢ Fine-tuned Models"]
            RE2["ğŸ“ Prompt Architecture<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ System Prompt<br/>â€¢ Few-Shot Examples<br/>â€¢ Context Injection"]
            RE3["ğŸ”— Reasoning Patterns<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Chain-of-Thought<br/>â€¢ ReAct (Reason+Act)<br/>â€¢ Tree of Thoughts"]
            RE1 --> RE2 --> RE3
        end
        
        subgraph PM["ğŸ“‹ PLANNING MODULE"]
            direction TB
            PM1["ğŸ§© Task Decomposition<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Break into Subtasks<br/>â€¢ Define Dependencies<br/>â€¢ Set Priorities"]
            PM2["ğŸ“ Plan Representation<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Sequential List<br/>â€¢ DAG (Parallel)<br/>â€¢ State Machine"]
            PM3["ğŸ”„ Dynamic Replanning<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Failure Detection<br/>â€¢ Alternative Routes<br/>â€¢ Adaptive Strategy"]
            PM1 --> PM2 --> PM3
        end
        
        subgraph MS["ğŸ’¾ MEMORY SYSTEM"]
            direction TB
            MS1["âš¡ Short-Term Memory<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Context Window<br/>â€¢ Current Session<br/>â€¢ Redis Cache"]
            MS2["ğŸ—„ï¸ Long-Term Memory<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Vector DB (RAG)<br/>â€¢ User Preferences<br/>â€¢ Knowledge Base"]
            MS1 -.->|Session Data| MS2
        end
        
        RE --> PM
        PM -.->|Query| MS
        MS -.->|Context| RE
    end
    
    %% ========== ACTION LAYER ==========
    subgraph ACTION["âš¡ ACTION LAYER - Thá»±c thi & Quan sÃ¡t"]
        direction TB
        
        subgraph TL["ğŸ”§ TOOL & FUNCTION LIBRARY"]
            direction TB
            TL1["ğŸ“š Tool Definition<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Function Name<br/>â€¢ Docstring<br/>â€¢ Pydantic Schema"]
            TL2["ğŸ”¨ Tool Types<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Python Functions<br/>â€¢ External APIs<br/>â€¢ Sub-Agents"]
            TL3["ğŸ“¦ Versioning & Management<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Version Control<br/>â€¢ API Compatibility<br/>â€¢ Registry System"]
            TL1 --> TL2 --> TL3
        end
        
        subgraph EE["ğŸš€ EXECUTION ENGINE"]
            direction TB
            EE1["ğŸ“ Tool Invocation<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Function Calls<br/>â€¢ API Requests<br/>â€¢ Parameter Binding"]
            EE2["ğŸ”§ Error Handling<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Try-Catch Logic<br/>â€¢ Exponential Backoff<br/>â€¢ Circuit Breaker"]
            EE3["âš™ï¸ Advanced Features<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Timeout Control<br/>â€¢ Concurrent Execution<br/>â€¢ Result Parsing"]
            EE1 --> EE2 --> EE3
        end
        
        TL -.->|Provide Tools| EE
    end
    
    %% ========== GOVERNANCE LAYER ==========
    subgraph GOVERNANCE["ğŸ›¡ï¸ GOVERNANCE LAYER - GiÃ¡m sÃ¡t, Kiá»ƒm soÃ¡t & An toÃ n"]
        direction TB
        
        subgraph GR["âš–ï¸ GUARDRAILS & SAFETY"]
            direction TB
            GR1["ğŸ›¡ï¸ Input/Output Filtering<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Prompt Injection Defense<br/>â€¢ PII Protection<br/>â€¢ Content Moderation"]
            GR2["ğŸ” Access Control<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ RBAC (Role-Based)<br/>â€¢ Tool Permissions<br/>â€¢ Privilege Management"]
            GR3["ğŸ’° Resource Monitoring<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Token Budget<br/>â€¢ API Rate Limits<br/>â€¢ Cost Tracking"]
            GR1 --> GR2 --> GR3
        end
        
        subgraph HITL["ğŸ‘¤ HUMAN-IN-THE-LOOP"]
            direction TB
            HITL1["ğŸ›‘ Checkpoint Definition<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Critical Actions<br/>â€¢ Low Confidence<br/>â€¢ High Cost"]
            HITL2["ğŸ–¥ï¸ Review Interface<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Approve/Reject UI<br/>â€¢ Plan Visualization<br/>â€¢ Edit Parameters"]
            HITL3["ğŸ”º Escalation Paths<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Expert Routing<br/>â€¢ Failure Handling<br/>â€¢ Manual Override"]
            HITL1 --> HITL2 --> HITL3
        end
        
        GR ~~~ HITL
    end
    
    %% Final output
    Output(["ğŸ“¤ FINAL OUTPUT<br/>Action Results | Response"])
    
    %% ========== MAIN FLOW ==========
    User -->|Raw Input| PERCEPTION
    PERCEPTION -->|Normalized Context<br/>+ Environment State| COGNITION
    COGNITION -->|Action Plan<br/>+ Tool Selection| ACTION
    ACTION -->|Execution Results<br/>+ Observations| PERCEPTION
    ACTION -->|Preliminary Output| GOVERNANCE
    GOVERNANCE -->|Validated Output| Output
    
    %% ========== GOVERNANCE MONITORING ==========
    GOVERNANCE -.->|Monitor Reasoning<br/>& Planning| COGNITION
    GOVERNANCE -.->|Control Execution<br/>& Tool Access| ACTION
    HITL -.->|Human Approval<br/>for Critical Actions| Output
    
    %% ========== STYLING ==========
    
    %% Layer styling
    style PERCEPTION fill:#e3f2fd,stroke:#1976d2,stroke-width:4px,color:#000
    style COGNITION fill:#fff9c4,stroke:#f57f00,stroke-width:4px,color:#000
    style ACTION fill:#c8e6c9,stroke:#388e3c,stroke-width:4px,color:#000
    style GOVERNANCE fill:#ffccbc,stroke:#d84315,stroke-width:4px,color:#000
    
    %% Perception components
    style IP fill:#bbdefb,stroke:#1565c0,stroke-width:3px,color:#000
    style EM fill:#bbdefb,stroke:#1565c0,stroke-width:3px,color:#000
    style IP1 fill:#90caf9,stroke:#0d47a1,stroke-width:2px
    style IP2 fill:#90caf9,stroke:#0d47a1,stroke-width:2px
    style IP3 fill:#90caf9,stroke:#0d47a1,stroke-width:2px
    style EM1 fill:#90caf9,stroke:#0d47a1,stroke-width:2px
    style EM2 fill:#90caf9,stroke:#0d47a1,stroke-width:2px
    style EM3 fill:#90caf9,stroke:#0d47a1,stroke-width:2px
    
    %% Cognition components
    style RE fill:#fff59d,stroke:#f57c00,stroke-width:3px,color:#000
    style PM fill:#fff59d,stroke:#f57c00,stroke-width:3px,color:#000
    style MS fill:#fff59d,stroke:#f57c00,stroke-width:3px,color:#000
    style RE1 fill:#fff176,stroke:#e65100,stroke-width:2px
    style RE2 fill:#fff176,stroke:#e65100,stroke-width:2px
    style RE3 fill:#fff176,stroke:#e65100,stroke-width:2px
    style PM1 fill:#fff176,stroke:#e65100,stroke-width:2px
    style PM2 fill:#fff176,stroke:#e65100,stroke-width:2px
    style PM3 fill:#fff176,stroke:#e65100,stroke-width:2px
    style MS1 fill:#fff176,stroke:#e65100,stroke-width:2px
    style MS2 fill:#fff176,stroke:#e65100,stroke-width:2px
    
    %% Action components
    style TL fill:#a5d6a7,stroke:#2e7d32,stroke-width:3px,color:#000
    style EE fill:#a5d6a7,stroke:#2e7d32,stroke-width:3px,color:#000
    style TL1 fill:#81c784,stroke:#1b5e20,stroke-width:2px
    style TL2 fill:#81c784,stroke:#1b5e20,stroke-width:2px
    style TL3 fill:#81c784,stroke:#1b5e20,stroke-width:2px
    style EE1 fill:#81c784,stroke:#1b5e20,stroke-width:2px
    style EE2 fill:#81c784,stroke:#1b5e20,stroke-width:2px
    style EE3 fill:#81c784,stroke:#1b5e20,stroke-width:2px
    
    %% Governance components
    style GR fill:#ffab91,stroke:#bf360c,stroke-width:3px,color:#000
    style HITL fill:#ffab91,stroke:#bf360c,stroke-width:3px,color:#000
    style GR1 fill:#ff8a65,stroke:#bf360c,stroke-width:2px
    style GR2 fill:#ff8a65,stroke:#bf360c,stroke-width:2px
    style GR3 fill:#ff8a65,stroke:#bf360c,stroke-width:2px
    style HITL1 fill:#ff8a65,stroke:#bf360c,stroke-width:2px
    style HITL2 fill:#ff8a65,stroke:#bf360c,stroke-width:2px
    style HITL3 fill:#ff8a65,stroke:#bf360c,stroke-width:2px
    
    %% External entities
    style User fill:#e1bee7,stroke:#6a1b9a,stroke-width:3px,color:#000
    style Output fill:#aed581,stroke:#33691e,stroke-width:3px,color:#000
```

```mermaid
%%{init: {'theme':'base', 'themeVariables': { 'primaryColor':'#e3f2fd','fontSize':'15px'}}}%%
flowchart TB
    User(["ğŸ‘¨â€ğŸ’» USER<br/>Input"])
    
    subgraph P1["ğŸ” PERCEPTION LAYER"]
        direction LR
        P1A["ğŸ“¥ Input Processor<br/>â”â”â”â”â”â”â”â”â”<br/>ğŸ­ Modality Handler<br/>ğŸ›¡ï¸ Validation<br/>âš™ï¸ Normalization"]
        P1B["ğŸŒ Environment Monitor<br/>â”â”â”â”â”â”â”â”â”<br/>ğŸ“Š State Tracking<br/>ğŸ”„ Updates<br/>ğŸš¨ Events"]
        P1A ~~~ P1B
    end
    
    subgraph P2["ğŸ§  COGNITION LAYER"]
        direction LR
        P2A["ğŸ’¡ Reasoning Engine<br/>â”â”â”â”â”â”â”â”â”<br/>ğŸ¯ Model Selection<br/>ğŸ“ Prompt Design<br/>ğŸ”— CoT/ReAct"]
        P2B["ğŸ“‹ Planning Module<br/>â”â”â”â”â”â”â”â”â”<br/>ğŸ§© Decomposition<br/>ğŸ“ DAG/Sequential<br/>ğŸ”„ Replanning"]
        P2C["ğŸ’¾ Memory<br/>â”â”â”â”â”â”â”â”â”<br/>âš¡ Short-term<br/>ğŸ—„ï¸ Long-term"]
        P2A --> P2B
        P2B -.-> P2C
        P2C -.-> P2A
    end
    
    subgraph P3["âš¡ ACTION LAYER"]
        direction LR
        P3A["ğŸ”§ Tool Library<br/>â”â”â”â”â”â”â”â”â”<br/>ğŸ“š Definitions<br/>ğŸ”¨ Functions/APIs<br/>ğŸ“¦ Versioning"]
        P3B["ğŸš€ Execution Engine<br/>â”â”â”â”â”â”â”â”â”<br/>ğŸ“ Invocation<br/>ğŸ”§ Error Handling<br/>âš™ï¸ Concurrency"]
        P3A -.-> P3B
    end
    
    subgraph P4["ğŸ›¡ï¸ GOVERNANCE LAYER"]
        direction LR
        P4A["âš–ï¸ Guardrails<br/>â”â”â”â”â”â”â”â”â”<br/>ğŸ›¡ï¸ I/O Filter<br/>ğŸ” RBAC<br/>ğŸ’° Budget"]
        P4B["ğŸ‘¤ HITL<br/>â”â”â”â”â”â”â”â”â”<br/>ğŸ›‘ Checkpoints<br/>ğŸ–¥ï¸ Review UI<br/>ğŸ”º Escalation"]
        P4A ~~~ P4B
    end
    
    Output(["ğŸ“¤ OUTPUT"])
    
    User --> P1
    P1 -->|Context| P2
    P2 -->|Plan| P3
    P3 -->|Results| P1
    P3 --> P4
    P4 --> Output
    
    P4 -.->|Monitor| P2
    P4 -.->|Control| P3
    
    style P1 fill:#e3f2fd,stroke:#1976d2,stroke-width:4px
    style P2 fill:#fff9c4,stroke:#f57f00,stroke-width:4px
    style P3 fill:#c8e6c9,stroke:#388e3c,stroke-width:4px
    style P4 fill:#ffccbc,stroke:#d84315,stroke-width:4px
    
    style P1A fill:#90caf9,stroke:#0d47a1,stroke-width:2px
    style P1B fill:#90caf9,stroke:#0d47a1,stroke-width:2px
    style P2A fill:#fff176,stroke:#e65100,stroke-width:2px
    style P2B fill:#fff176,stroke:#e65100,stroke-width:2px
    style P2C fill:#fff176,stroke:#e65100,stroke-width:2px
    style P3A fill:#81c784,stroke:#1b5e20,stroke-width:2px
    style P3B fill:#81c784,stroke:#1b5e20,stroke-width:2px
    style P4A fill:#ff8a65,stroke:#bf360c,stroke-width:2px
    style P4B fill:#ff8a65,stroke:#bf360c,stroke-width:2px
    
    style User fill:#e1bee7,stroke:#6a1b9a,stroke-width:3px
    style Output fill:#aed581,stroke:#33691e,stroke-width:3px
```

BÃ¢y giá», chÃºng ta sáº½ Ä‘i sÃ¢u vÃ o tá»«ng thÃ nh pháº§n trong má»—i lá»›p.

#### 2.1. Lá»›p 1: Nháº­n thá»©c (Perception Layer)

ÄÃ¢y lÃ  lá»›p chá»‹u trÃ¡ch nhiá»‡m thu tháº­p thÃ´ng tin tá»« tháº¿ giá»›i bÃªn ngoÃ i vÃ  chuyá»ƒn Ä‘á»•i nÃ³ thÃ nh má»™t Ä‘á»‹nh dáº¡ng mÃ  "bá»™ nÃ£o" cá»§a agent cÃ³ thá»ƒ hiá»ƒu Ä‘Æ°á»£c. Náº¿u khÃ´ng cÃ³ lá»›p nháº­n thá»©c hiá»‡u quáº£, agent sáº½ bá»‹ "mÃ¹" vÃ  "Ä‘iáº¿c".

**2.1.1. ThÃ nh pháº§n: Bá»™ xá»­ lÃ½ Ä‘áº§u vÃ o (Input Processor)**

*   **Chá»©c nÄƒng:** LÃ  cá»­a ngÃµ Ä‘áº§u tiÃªn cá»§a agent, chá»‹u trÃ¡ch nhiá»‡m tiáº¿p nháº­n, lÃ m sáº¡ch vÃ  chuáº©n hÃ³a táº¥t cáº£ cÃ¡c loáº¡i dá»¯ liá»‡u Ä‘áº§u vÃ o.
*   **Chi tiáº¿t hoáº¡t Ä‘á»™ng:**
    *   **Xá»­ lÃ½ Ä‘a phÆ°Æ¡ng thá»©c (Modality Handling):** Agent khÃ´ng chá»‰ nháº­n vÄƒn báº£n. NÃ³ cÃ³ thá»ƒ nháº­n hÃ¬nh áº£nh (tá»« file upload), giá»ng nÃ³i (tá»« microphone), video, hoáº·c dá»¯ liá»‡u cÃ³ cáº¥u trÃºc (tá»« má»™t API call). Input Processor pháº£i xÃ¡c Ä‘á»‹nh loáº¡i dá»¯ liá»‡u vÃ  sá»­ dá»¥ng cÃ¡c mÃ´ hÃ¬nh chuyÃªn biá»‡t (vÃ­ dá»¥: mÃ´ hÃ¬nh Speech-to-Text nhÆ° Whisper cho Ã¢m thanh, mÃ´ hÃ¬nh Vision cho hÃ¬nh áº£nh) Ä‘á»ƒ chuyá»ƒn Ä‘á»•i táº¥t cáº£ vá» má»™t Ä‘á»‹nh dáº¡ng chung, thÆ°á»ng lÃ  vÄƒn báº£n hoáº·c JSON.
    *   **XÃ¡c thá»±c vÃ  lÃ m sáº¡ch (Validation & Sanitization):** Dá»¯ liá»‡u Ä‘áº§u vÃ o tá»« ngÆ°á»i dÃ¹ng hoáº·c há»‡ thá»‘ng bÃªn ngoÃ i khÃ´ng bao giá» Ä‘Ã¡ng tin cáº­y 100%. ThÃ nh pháº§n nÃ y pháº£i kiá»ƒm tra xem dá»¯ liá»‡u cÃ³ há»£p lá»‡ khÃ´ng (vÃ­ dá»¥: má»™t Ä‘á»‹a chá»‰ email cÃ³ Ä‘Ãºng Ä‘á»‹nh dáº¡ng khÃ´ng?), vÃ  quan trá»ng hÆ¡n, loáº¡i bá» cÃ¡c mÃ£ Ä‘á»™c háº¡i hoáº·c cÃ¡c ká»¹ thuáº­t táº¥n cÃ´ng nhÆ° **Prompt Injection**.
    *   **Chuáº©n hÃ³a (Normalization):** Dá»¯ liá»‡u tá»« cÃ¡c nguá»“n khÃ¡c nhau cÃ³ thá»ƒ cÃ³ Ä‘á»‹nh dáº¡ng khÃ¡c nhau. VÃ­ dá»¥, ngÃ y thÃ¡ng cÃ³ thá»ƒ lÃ  `DD/MM/YYYY` hoáº·c `MM-DD-YY`. Input Processor sáº½ chuyá»ƒn Ä‘á»•i táº¥t cáº£ vá» má»™t Ä‘á»‹nh dáº¡ng thá»‘ng nháº¥t (vÃ­ dá»¥: ISO 8601) Ä‘á»ƒ cÃ¡c lá»›p sau cÃ³ thá»ƒ xá»­ lÃ½ má»™t cÃ¡ch nháº¥t quÃ¡n.
*   **Táº§m quan trá»ng:** Má»™t Input Processor yáº¿u kÃ©m sáº½ dáº«n Ä‘áº¿n viá»‡c agent hiá»ƒu sai yÃªu cáº§u, dá»… bá»‹ táº¥n cÃ´ng, hoáº·c khÃ´ng thá»ƒ xá»­ lÃ½ cÃ¡c loáº¡i thÃ´ng tin Ä‘a dáº¡ng, lÃ m giáº£m Ä‘Ã¡ng ká»ƒ tÃ­nh há»¯u dá»¥ng cá»§a nÃ³.

**2.1.2. ThÃ nh pháº§n: Bá»™ giÃ¡m sÃ¡t mÃ´i trÆ°á»ng (Environment Monitor)**

*   **Chá»©c nÄƒng:** Duy trÃ¬ má»™t mÃ´ hÃ¬nh ná»™i táº¡i (internal model) vá» tráº¡ng thÃ¡i cá»§a tháº¿ giá»›i bÃªn ngoÃ i mÃ  agent cáº§n quan tÃ¢m. NÃ³ tráº£ lá»i cÃ¢u há»i: "Chuyá»‡n gÃ¬ Ä‘ang xáº£y ra xung quanh tÃ´i?"
*   **Chi tiáº¿t hoáº¡t Ä‘á»™ng:**
    *   **Theo dÃµi tráº¡ng thÃ¡i (State Tracking):** ThÃ nh pháº§n nÃ y cÃ³ thá»ƒ theo dÃµi cÃ¡c thÃ´ng tin nhÆ°: thá»i gian hiá»‡n táº¡i, vá»‹ trÃ­ cá»§a ngÆ°á»i dÃ¹ng, tráº¡ng thÃ¡i cá»§a má»™t Ä‘Æ¡n hÃ ng, giÃ¡ cá»• phiáº¿u hiá»‡n táº¡i, hoáº·c ná»™i dung cá»§a má»™t trang web. NÃ³ khÃ´ng chá»‰ lÃ  dá»¯ liá»‡u tÄ©nh mÃ  lÃ  má»™t bá»©c tranh Ä‘á»™ng vá» mÃ´i trÆ°á»ng.
    *   **Cáº­p nháº­t theo thá»i gian thá»±c hoáº·c Ä‘á»‹nh ká»³ (Real-time vs. Periodic Updates):** TÃ¹y thuá»™c vÃ o yÃªu cáº§u, viá»‡c cáº­p nháº­t cÃ³ thá»ƒ diá»…n ra liÃªn tá»¥c (vÃ­ dá»¥: qua WebSockets Ä‘á»ƒ theo dÃµi giÃ¡ tiá»n Ä‘iá»‡n tá»­) hoáº·c theo chu ká»³ (vÃ­ dá»¥: kiá»ƒm tra email má»›i má»—i 5 phÃºt).
    *   **PhÃ¡t hiá»‡n sá»± kiá»‡n (Event Detection):** ÄÃ¢y lÃ  má»™t chá»©c nÄƒng quan trá»ng. Thay vÃ¬ chá»‰ Ä‘á»c tráº¡ng thÃ¡i, Environment Monitor cÃ³ thá»ƒ phÃ¡t hiá»‡n nhá»¯ng *thay Ä‘á»•i* quan trá»ng vÃ  kÃ­ch hoáº¡t agent hÃ nh Ä‘á»™ng. VÃ­ dá»¥: "Khi tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng chuyá»ƒn tá»« 'Äang giao' sang 'ÄÃ£ giao', hÃ£y kÃ­ch hoáº¡t agent gá»­i email cáº£m Æ¡n cho khÃ¡ch hÃ ng."
*   **Táº§m quan trá»ng:** Náº¿u khÃ´ng cÃ³ Environment Monitor, agent chá»‰ cÃ³ thá»ƒ pháº£n á»©ng vá»›i cÃ¡c yÃªu cáº§u trá»±c tiáº¿p cá»§a ngÆ°á»i dÃ¹ng. Vá»›i nÃ³, agent cÃ³ thá»ƒ trá»Ÿ nÃªn **chá»§ Ä‘á»™ng (proactive)**, tá»± Ä‘á»™ng hÃ nh Ä‘á»™ng khi cÃ³ sá»± thay Ä‘á»•i trong mÃ´i trÆ°á»ng, má»Ÿ ra vÃ´ sá»‘ á»©ng dá»¥ng tá»± Ä‘á»™ng hÃ³a thÃ´ng minh.

#### 2.2. Lá»›p 2: Nháº­n thá»©c (Cognition Layer)

ÄÃ¢y lÃ  "bá»™ nÃ£o" cá»§a agent, nÆ¡i diá»…n ra cÃ¡c quÃ¡ trÃ¬nh suy luáº­n, láº­p káº¿ hoáº¡ch vÃ  ghi nhá»›. Cháº¥t lÆ°á»£ng cá»§a lá»›p nÃ y quyáº¿t Ä‘á»‹nh má»©c Ä‘á»™ "thÃ´ng minh" cá»§a agent.

**2.2.1. ThÃ nh pháº§n: Äá»™ng cÆ¡ suy luáº­n (Reasoning Engine)**

*   **Chá»©c nÄƒng:** LÃ  háº¡t nhÃ¢n cá»§a lá»›p nháº­n thá»©c, thÆ°á»ng lÃ  má»™t MÃ´ hÃ¬nh NgÃ´n ngá»¯ Lá»›n (LLM), chá»‹u trÃ¡ch nhiá»‡m hiá»ƒu yÃªu cáº§u, suy luáº­n logic, vÃ  Ä‘Æ°a ra cÃ¡c quyáº¿t Ä‘á»‹nh cáº¥p cao.
*   **Chi tiáº¿t hoáº¡t Ä‘á»™ng:**
    *   **Lá»±a chá»n MÃ´ hÃ¬nh (Model Selection):** KhÃ´ng pháº£i lÃºc nÃ o cÅ©ng cáº§n mÃ´ hÃ¬nh máº¡nh nháº¥t (vÃ  Ä‘áº¯t nháº¥t). Má»™t quyáº¿t Ä‘á»‹nh kiáº¿n trÃºc quan trá»ng lÃ  chá»n Ä‘Ãºng LLM cho Ä‘Ãºng cÃ´ng viá»‡c. VÃ­ dá»¥: dÃ¹ng GPT-4o cho cÃ¡c tÃ¡c vá»¥ láº­p káº¿ hoáº¡ch phá»©c táº¡p, nhÆ°ng dÃ¹ng GPT-4o-mini hoáº·c má»™t mÃ´ hÃ¬nh Ä‘Æ°á»£c fine-tune cho cÃ¡c tÃ¡c vá»¥ phÃ¢n loáº¡i Ä‘Æ¡n giáº£n Ä‘á»ƒ tiáº¿t kiá»‡m chi phÃ­ vÃ  giáº£m Ä‘á»™ trá»….
    *   **Kiáº¿n trÃºc Prompt (Prompt Architecture):** ÄÃ¢y lÃ  nghá»‡ thuáº­t vÃ  khoa há»c cá»§a viá»‡c "láº­p trÃ¬nh" LLM. Má»™t prompt tá»‘t khÃ´ng chá»‰ lÃ  má»™t cÃ¢u há»i. NÃ³ bao gá»“m:
        *   **System Prompt:** Äá»‹nh nghÄ©a vai trÃ², tÃ­nh cÃ¡ch, vÃ  cÃ¡c quy táº¯c báº¥t biáº¿n cá»§a agent (vÃ­ dá»¥: "Báº¡n lÃ  má»™t trá»£ lÃ½ du lá»‹ch chuyÃªn nghiá»‡p, luÃ´n tráº£ lá»i má»™t cÃ¡ch lá»‹ch sá»± vÃ  chi tiáº¿t.").
        *   **Few-Shot Examples:** Cung cáº¥p má»™t vÃ i vÃ­ dá»¥ vá» Ä‘áº§u vÃ o vÃ  Ä‘áº§u ra mong muá»‘n Ä‘á»ƒ hÆ°á»›ng dáº«n LLM hoáº¡t Ä‘á»™ng Ä‘Ãºng cÃ¡ch.
        *   **Context:** Cung cáº¥p thÃ´ng tin liÃªn quan tá»« Bá»™ nhá»› (Memory System) Ä‘á»ƒ agent cÃ³ thá»ƒ Ä‘Æ°a ra quyáº¿t Ä‘á»‹nh dá»±a trÃªn ngá»¯ cáº£nh.
    *   **CÃ¡c Máº«u Suy luáº­n (Reasoning Patterns):** Äá»ƒ giáº£i quyáº¿t cÃ¡c váº¥n Ä‘á» phá»©c táº¡p, agent cáº§n cÃ¡c ká»¹ thuáº­t suy luáº­n cÃ³ cáº¥u trÃºc. CÃ¡c máº«u phá»• biáº¿n bao gá»“m:
        *   **Chain-of-Thought (CoT):** HÆ°á»›ng dáº«n LLM "suy nghÄ© tá»«ng bÆ°á»›c" trÆ°á»›c khi Ä‘Æ°a ra cÃ¢u tráº£ lá»i cuá»‘i cÃ¹ng, giÃºp cáº£i thiá»‡n Ä‘á»™ chÃ­nh xÃ¡c cá»§a cÃ¡c bÃ i toÃ¡n logic.
        *   **ReAct (Reason + Act):** Má»™t máº«u cá»±c ká»³ quan trá»ng cho agent. LLM sáº½ láº·p Ä‘i láº·p láº¡i chu trÃ¬nh: **Suy luáº­n (Reason)** vá» bÆ°á»›c tiáº¿p theo cáº§n lÃ m -> **HÃ nh Ä‘á»™ng (Act)** báº±ng cÃ¡ch gá»i má»™t cÃ´ng cá»¥ -> **Quan sÃ¡t (Observe)** káº¿t quáº£ cá»§a cÃ´ng cá»¥ Ä‘Ã³. Chu trÃ¬nh nÃ y cho phÃ©p agent tÆ°Æ¡ng tÃ¡c vá»›i mÃ´i trÆ°á»ng vÃ  Ä‘iá»u chá»‰nh káº¿ hoáº¡ch cá»§a mÃ¬nh.
*   **Táº§m quan trá»ng:** ÄÃ¢y lÃ  thÃ nh pháº§n quyáº¿t Ä‘á»‹nh kháº£ nÄƒng giáº£i quyáº¿t váº¥n Ä‘á» cá»§a agent. Má»™t Reasoning Engine máº¡nh máº½ cÃ³ thá»ƒ hiá»ƒu Ä‘Æ°á»£c cÃ¡c yÃªu cáº§u mÆ¡ há»“, phÃ¡ vá»¡ cÃ¡c váº¥n Ä‘á» phá»©c táº¡p, vÃ  Ä‘Æ°a ra cÃ¡c quyáº¿t Ä‘á»‹nh thÃ´ng minh.

**2.2.2. ThÃ nh pháº§n: Module láº­p káº¿ hoáº¡ch (Planning Module)**

*   **Chá»©c nÄƒng:** Chuyá»ƒn Ä‘á»•i má»™t má»¥c tiÃªu cáº¥p cao, thÆ°á»ng mÆ¡ há»“ cá»§a ngÆ°á»i dÃ¹ng (vÃ­ dá»¥: "lÃªn káº¿ hoáº¡ch cho má»™t chuyáº¿n Ä‘i") thÃ nh má»™t chuá»—i cÃ¡c bÆ°á»›c cá»¥ thá»ƒ, cÃ³ thá»ƒ thá»±c thi Ä‘Æ°á»£c.
*   **Chi tiáº¿t hoáº¡t Ä‘á»™ng:**
    *   **PhÃ¢n rÃ£ nhiá»‡m vá»¥ (Task Decomposition):** ÄÃ¢y lÃ  chá»©c nÄƒng cá»‘t lÃµi. Module nÃ y sáº½ chia má»™t nhiá»‡m vá»¥ lá»›n thÃ nh cÃ¡c nhiá»‡m vá»¥ con nhá» hÆ¡n. VÃ­ dá»¥, "lÃªn káº¿ hoáº¡ch chuyáº¿n Ä‘i" Ä‘Æ°á»£c chia thÃ nh: (1) TÃ¬m vÃ© mÃ¡y bay, (2) TÃ¬m khÃ¡ch sáº¡n, (3) TÃ¬m cÃ¡c Ä‘á»‹a Ä‘iá»ƒm tham quan, (4) Láº­p lá»‹ch trÃ¬nh chi tiáº¿t.
    *   **Biá»ƒu diá»…n Káº¿ hoáº¡ch (Plan Representation):** Káº¿ hoáº¡ch cÃ³ thá»ƒ Ä‘Æ°á»£c biá»ƒu diá»…n dÆ°á»›i dáº¡ng má»™t danh sÃ¡ch cÃ¡c bÆ°á»›c tuáº§n tá»±, hoáº·c phá»©c táº¡p hÆ¡n, lÃ  má»™t **Äá»“ thá»‹ cÃ³ hÆ°á»›ng khÃ´ng chu trÃ¬nh (DAG - Directed Acyclic Graph)**, cho phÃ©p thá»±c hiá»‡n cÃ¡c bÆ°á»›c song song.
    *   **TÃ¡i láº­p káº¿ hoáº¡ch Ä‘á»™ng (Dynamic Replanning):** Tháº¿ giá»›i thá»±c khÃ´ng thá»ƒ Ä‘oÃ¡n trÆ°á»›c. Má»™t cÃ´ng cá»¥ cÃ³ thá»ƒ tháº¥t báº¡i, má»™t API cÃ³ thá»ƒ khÃ´ng tráº£ vá» dá»¯ liá»‡u. Planning Module pháº£i cÃ³ kháº£ nÄƒng nháº­n biáº¿t tháº¥t báº¡i tá»« Lá»›p HÃ nh Ä‘á»™ng (Action Layer) vÃ  tá»± Ä‘á»™ng Ä‘iá»u chá»‰nh káº¿ hoáº¡ch. VÃ­ dá»¥: "KhÃ´ng tÃ¬m tháº¥y chuyáº¿n bay vÃ o ngÃ y X, thá»­ tÃ¬m vÃ o ngÃ y Y."
    *   **CÃ¡c ká»¹ thuáº­t nÃ¢ng cao:** CÃ¡c há»‡ thá»‘ng phá»©c táº¡p cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c ká»¹ thuáº­t nhÆ° **Tree of Thoughts (ToT)**, nÆ¡i agent khÃ¡m phÃ¡ nhiá»u nhÃ¡nh káº¿ hoáº¡ch khÃ¡c nhau vÃ  Ä‘Ã¡nh giÃ¡ chÃºng trÆ°á»›c khi chá»n ra nhÃ¡nh tá»‘t nháº¥t.
*   **Táº§m quan trá»ng:** Náº¿u Reasoning Engine lÃ  bá»™ nÃ£o chiáº¿n lÆ°á»£c, thÃ¬ Planning Module lÃ  bá»™ nÃ£o chiáº¿n thuáº­t. NÃ³ biáº¿n Ã½ Ä‘á»‹nh thÃ nh má»™t káº¿ hoáº¡ch hÃ nh Ä‘á»™ng cá»¥ thá»ƒ, lÃ  cáº§u ná»‘i giá»¯a suy nghÄ© vÃ  thá»±c thi. CÃ¡c agent khÃ´ng cÃ³ Planning Module chá»‰ cÃ³ thá»ƒ thá»±c hiá»‡n cÃ¡c tÃ¡c vá»¥ má»™t bÆ°á»›c Ä‘Æ¡n giáº£n.

**2.2.3. ThÃ nh pháº§n: Há»‡ thá»‘ng bá»™ nhá»› (Memory System)**

*   **Chá»©c nÄƒng:** Cung cáº¥p cho agent kháº£ nÄƒng ghi nhá»› vÃ  truy xuáº¥t thÃ´ng tin, cho phÃ©p nÃ³ duy trÃ¬ ngá»¯ cáº£nh, há»c há»i tá»« cÃ¡c tÆ°Æ¡ng tÃ¡c trong quÃ¡ khá»©, vÃ  cÃ¡ nhÃ¢n hÃ³a tráº£i nghiá»‡m.
*   **Chi tiáº¿t hoáº¡t Ä‘á»™ng:** Bá»™ nhá»› cá»§a agent Ä‘Æ°á»£c chia thÃ nh hai loáº¡i chÃ­nh:
    *   **Bá»™ nhá»› Ngáº¯n háº¡n (Short-Term / Working Memory):**
        *   **Má»¥c Ä‘Ã­ch:** LÆ°u trá»¯ thÃ´ng tin liÃªn quan Ä‘áº¿n phiÃªn tÆ°Æ¡ng tÃ¡c hiá»‡n táº¡i.
        *   **VÃ­ dá»¥:** Lá»‹ch sá»­ cuá»™c trÃ² chuyá»‡n, cÃ¡c káº¿t quáº£ trung gian tá»« cÃ¡c lá»‡nh gá»i cÃ´ng cá»¥, káº¿ hoáº¡ch hiá»‡n táº¡i.
        *   **CÃ´ng nghá»‡:** ThÆ°á»ng Ä‘Æ°á»£c lÆ°u trá»¯ trong bá»™ nhá»› (in-memory) cá»§a á»©ng dá»¥ng hoáº·c trong cÃ¡c há»‡ thá»‘ng cache nhanh nhÆ° Redis. ÄÃ¢y chÃ­nh lÃ  "context window" Ä‘Æ°á»£c Ä‘Æ°a vÃ o prompt cá»§a LLM trong má»—i lÆ°á»£t tÆ°Æ¡ng tÃ¡c.
    *   **Bá»™ nhá»› DÃ i háº¡n (Long-Term / Knowledge Base):**
        *   **Má»¥c Ä‘Ã­ch:** LÆ°u trá»¯ thÃ´ng tin má»™t cÃ¡ch bá»n vá»¯ng qua nhiá»u phiÃªn, cho phÃ©p agent há»c há»i vÃ  phÃ¡t triá»ƒn theo thá»i gian.
        *   **VÃ­ dá»¥:** Sá»Ÿ thÃ­ch cá»§a ngÆ°á»i dÃ¹ng ("TÃ´i thÃ­ch cÃ¡c chuyáº¿n bay buá»•i sÃ¡ng"), cÃ¡c sá»± kiá»‡n quan trá»ng trong quÃ¡ khá»©, má»™t kho tÃ i liá»‡u kiáº¿n thá»©c lá»›n.
        *   **CÃ´ng nghá»‡:**
            *   **CÆ¡ sá»Ÿ dá»¯ liá»‡u Vector (Vector Database - vd: Pinecone, Chroma):** DÃ¹ng cho **tÃ¬m kiáº¿m ngá»¯ nghÄ©a (semantic search)**. CÃ¡c Ä‘oáº¡n vÄƒn báº£n Ä‘Æ°á»£c chuyá»ƒn thÃ nh cÃ¡c vector sá»‘ há»c. Khi cáº§n truy xuáº¥t, cÃ¢u truy váº¥n cÅ©ng Ä‘Æ°á»£c chuyá»ƒn thÃ nh vector vÃ  há»‡ thá»‘ng sáº½ tÃ¬m cÃ¡c vector gáº§n nháº¥t (tÆ°Æ¡ng Ä‘á»“ng nháº¥t vá» máº·t ngá»¯ nghÄ©a). ÄÃ¢y lÃ  cÃ´ng nghá»‡ ná»n táº£ng cá»§a **Retrieval-Augmented Generation (RAG)**.
            *   **CÆ¡ sá»Ÿ dá»¯ liá»‡u Quan há»‡/NoSQL (Relational/NoSQL DB):** DÃ¹ng Ä‘á»ƒ lÆ°u trá»¯ dá»¯ liá»‡u cÃ³ cáº¥u trÃºc nhÆ° thÃ´ng tin ngÆ°á»i dÃ¹ng, lá»‹ch sá»­ Ä‘Æ¡n hÃ ng, v.v.
*   **Táº§m quan trá»ng:** Bá»™ nhá»› lÃ  thá»© biáº¿n má»™t chatbot vÃ´ há»“n thÃ nh má»™t trá»£ lÃ½ cÃ¡ nhÃ¢n thá»±c thá»¥. NÃ³ cho phÃ©p agent nhá»› báº¡n lÃ  ai, báº¡n thÃ­ch gÃ¬, vÃ  nhá»¯ng gÃ¬ báº¡n Ä‘Ã£ lÃ m, táº¡o ra má»™t tráº£i nghiá»‡m liá»n máº¡ch vÃ  thÃ´ng minh hÆ¡n nhiá»u.

*(Tiáº¿p tá»¥c cÃ¡c Lá»›p 3 vÃ  4 trong cÃ¡c pháº§n sau...)*


#### 2.3. Lá»›p 3: HÃ nh Ä‘á»™ng (Action Layer)

Náº¿u Lá»›p Nháº­n thá»©c lÃ  tai vÃ  máº¯t, Lá»›p Nháº­n thá»©c lÃ  bá»™ nÃ£o, thÃ¬ Lá»›p HÃ nh Ä‘á»™ng chÃ­nh lÃ  tay vÃ  chÃ¢n cá»§a agent. ÄÃ¢y lÃ  nÆ¡i cÃ¡c quyáº¿t Ä‘á»‹nh vÃ  káº¿ hoáº¡ch Ä‘Æ°á»£c chuyá»ƒn thÃ nh cÃ¡c hÃ nh Ä‘á»™ng cá»¥ thá»ƒ, cÃ³ tÃ¡c Ä‘á»™ng Ä‘áº¿n tháº¿ giá»›i bÃªn ngoÃ i.

**2.3.1. ThÃ nh pháº§n: ThÆ° viá»‡n CÃ´ng cá»¥ & HÃ m (Tool & Function Library)**

*   **Chá»©c nÄƒng:** Cung cáº¥p má»™t bá»™ sÆ°u táº­p cÃ¡c "siÃªu nÄƒng lá»±c" mÃ  agent cÃ³ thá»ƒ sá»­ dá»¥ng. Má»—i cÃ´ng cá»¥ lÃ  má»™t hÃ nh Ä‘á»™ng cá»¥ thá»ƒ mÃ  agent cÃ³ thá»ƒ thá»±c hiá»‡n.
*   **Chi tiáº¿t hoáº¡t Ä‘á»™ng:**
    *   **Äá»‹nh nghÄ©a CÃ´ng cá»¥ (Tool Definition):** Má»™t cÃ´ng cá»¥ khÃ´ng chá»‰ lÃ  má»™t hÃ m code. Äá»ƒ LLM cÃ³ thá»ƒ hiá»ƒu vÃ  sá»­ dá»¥ng Ä‘Æ°á»£c, má»™t cÃ´ng cá»¥ pháº£i Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a má»™t cÃ¡ch rÃµ rÃ ng, thÆ°á»ng bao gá»“m:
        *   **TÃªn hÃ m:** Má»™t cÃ¡i tÃªn mang tÃ­nh mÃ´ táº£ cao (vÃ­ dá»¥: `search_flights` thay vÃ¬ `f1`).
        *   **MÃ´ táº£ (Docstring):** Má»™t cÃ¢u giáº£i thÃ­ch rÃµ rÃ ng vá» chá»©c nÄƒng cá»§a cÃ´ng cá»¥ (vÃ­ dá»¥: "TÃ¬m kiáº¿m cÃ¡c chuyáº¿n bay giá»¯a hai thÃ nh phá»‘ vÃ o má»™t ngÃ y cá»¥ thá»ƒ."). ÄÃ¢y lÃ  thÃ´ng tin quan trá»ng nháº¥t mÃ  LLM sáº½ dá»±a vÃ o Ä‘á»ƒ quyáº¿t Ä‘á»‹nh cÃ³ chá»n cÃ´ng cá»¥ nÃ y hay khÃ´ng.
        *   **Äá»‹nh nghÄ©a Tham sá»‘ (Parameter Definition):** CÃ¡c tham sá»‘ Ä‘áº§u vÃ o pháº£i Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a rÃµ rÃ ng vá»›i kiá»ƒu dá»¯ liá»‡u (vÃ­ dá»¥: `origin: str`, `destination: str`, `date: date`). CÃ¡c framework hiá»‡n Ä‘áº¡i thÆ°á»ng sá»­ dá»¥ng Pydantic model Ä‘á»ƒ lÃ m viá»‡c nÃ y.
    *   **CÃ¡c loáº¡i cÃ´ng cá»¥:** ThÆ° viá»‡n cÃ´ng cá»¥ cÃ³ thá»ƒ bao gá»“m:
        *   **CÃ¡c hÃ m Python ná»™i bá»™:** Äá»ƒ thá»±c hiá»‡n cÃ¡c phÃ©p tÃ­nh, xá»­ lÃ½ dá»¯ liá»‡u.
        *   **CÃ¡c lá»‡nh gá»i API bÃªn ngoÃ i:** Äá»ƒ tÆ°Æ¡ng tÃ¡c vá»›i cÃ¡c dá»‹ch vá»¥ cá»§a bÃªn thá»© ba (Google Maps, Stripe, Jira).
        *   **CÃ¡c agent khÃ¡c:** Trong kiáº¿n trÃºc Ä‘a agent, má»™t agent cÃ³ thá»ƒ lÃ  má»™t cÃ´ng cá»¥ cá»§a má»™t agent khÃ¡c.
    *   **Quáº£n lÃ½ vÃ  PhiÃªn báº£n (Versioning & Management):** Khi sá»‘ lÆ°á»£ng cÃ´ng cá»¥ tÄƒng lÃªn, viá»‡c quáº£n lÃ½ chÃºng trá»Ÿ nÃªn quan trá»ng. Cáº§n cÃ³ cÆ¡ cháº¿ Ä‘á»ƒ theo dÃµi phiÃªn báº£n cá»§a cÃ¡c cÃ´ng cá»¥, xá»­ lÃ½ cÃ¡c thay Ä‘á»•i (vÃ­ dá»¥: má»™t API thay Ä‘á»•i tham sá»‘), vÃ  Ä‘áº£m báº£o tÃ­nh tÆ°Æ¡ng thÃ­ch.
*   **Táº§m quan trá»ng:** CÃ´ng cá»¥ lÃ  thá»© mang láº¡i sá»©c máº¡nh thá»±c sá»± cho agent. Má»™t agent khÃ´ng cÃ³ cÃ´ng cá»¥ chá»‰ lÃ  má»™t chatbot. Má»™t agent vá»›i má»™t thÆ° viá»‡n cÃ´ng cá»¥ phong phÃº cÃ³ thá»ƒ trá»Ÿ thÃ nh má»™t nhÃ¢n viÃªn tá»± Ä‘á»™ng hÃ³a máº¡nh máº½.

**2.3.2. ThÃ nh pháº§n: Äá»™ng cÆ¡ thá»±c thi (Execution Engine)**

*   **Chá»©c nÄƒng:** Chá»‹u trÃ¡ch nhiá»‡m gá»i cÃ¡c cÃ´ng cá»¥ Ä‘Ã£ Ä‘Æ°á»£c Lá»›p Nháº­n thá»©c lá»±a chá»n má»™t cÃ¡ch Ä‘Ã¡ng tin cáº­y, xá»­ lÃ½ káº¿t quáº£ tráº£ vá», vÃ  bÃ¡o cÃ¡o láº¡i cho Lá»›p Nháº­n thá»©c.
*   **Chi tiáº¿t hoáº¡t Ä‘á»™ng:**
    *   **Gá»i cÃ´ng cá»¥ (Tool Invocation):** Sau khi Planning Module quyáº¿t Ä‘á»‹nh gá»i cÃ´ng cá»¥ `search_flights(origin="Hanoi", destination="Saigon")`, Execution Engine sáº½ thá»±c sá»± thá»±c hiá»‡n lá»‡nh gá»i hÃ m hoáº·c API call nÃ y.
    *   **Xá»­ lÃ½ lá»—i vÃ  Thá»­ láº¡i (Error Handling & Retry Logic):** CÃ¡c lá»‡nh gá»i máº¡ng thÆ°á»ng khÃ´ng Ä‘Ã¡ng tin cáº­y. API cÃ³ thá»ƒ bá»‹ lá»—i, máº¡ng cÃ³ thá»ƒ bá»‹ ngáº¯t. Execution Engine pháº£i Ä‘Æ°á»£c trang bá»‹ cÃ¡c cÆ¡ cháº¿ máº¡nh máº½ Ä‘á»ƒ xá»­ lÃ½ nhá»¯ng tÃ¬nh huá»‘ng nÃ y, vÃ­ dá»¥ nhÆ° **thá»­ láº¡i theo cáº¥p sá»‘ nhÃ¢n (exponential backoff)** - thá»­ láº¡i sau 1s, rá»“i 2s, rá»“i 4s,...
    *   **Quáº£n lÃ½ Timeout vÃ  Song song (Timeout & Concurrency Management):** Má»™t cÃ´ng cá»¥ khÃ´ng nÃªn Ä‘Æ°á»£c phÃ©p cháº¡y vÃ´ thá»i háº¡n. Execution Engine pháº£i Ä‘áº·t ra má»™t khoáº£ng thá»i gian chá» (timeout) vÃ  há»§y bá» cÃ´ng cá»¥ náº¿u nÃ³ khÃ´ng pháº£n há»“i. Trong cÃ¡c há»‡ thá»‘ng nÃ¢ng cao, nÃ³ cÅ©ng cÃ³ thá»ƒ quáº£n lÃ½ viá»‡c thá»±c thi nhiá»u cÃ´ng cá»¥ cÃ¹ng má»™t lÃºc (song song) Ä‘á»ƒ tÄƒng tá»‘c Ä‘á»™.
    *   **PhÃ¢n tÃ­ch vÃ  Chuáº©n hÃ³a Káº¿t quáº£ (Result Parsing & Normalization):** Káº¿t quáº£ tráº£ vá» tá»« má»™t cÃ´ng cá»¥ (vÃ­ dá»¥: má»™t chuá»—i JSON lá»›n tá»« API cá»§a hÃ£ng hÃ ng khÃ´ng) cáº§n Ä‘Æ°á»£c phÃ¢n tÃ­ch, trÃ­ch xuáº¥t thÃ´ng tin quan trá»ng, vÃ  chuyá»ƒn Ä‘á»•i thÃ nh má»™t Ä‘á»‹nh dáº¡ng Ä‘Æ¡n giáº£n Ä‘á»ƒ Lá»›p Nháº­n thá»©c cÃ³ thá»ƒ "tiÃªu hÃ³a" vÃ  sá»­ dá»¥ng cho bÆ°á»›c láº­p káº¿ hoáº¡ch tiáº¿p theo.
*   **Táº§m quan trá»ng:** Execution Engine Ä‘áº£m báº£o ráº±ng cÃ¡c hÃ nh Ä‘á»™ng cá»§a agent Ä‘Æ°á»£c thá»±c hiá»‡n má»™t cÃ¡ch Ä‘Ã¡ng tin cáº­y vÃ  hiá»‡u quáº£. NÃ³ lÃ  cáº§u ná»‘i vá»¯ng cháº¯c giá»¯a tháº¿ giá»›i trá»«u tÆ°á»£ng cá»§a viá»‡c láº­p káº¿ hoáº¡ch vÃ  tháº¿ giá»›i há»—n loáº¡n cá»§a viá»‡c thá»±c thi trong thá»±c táº¿.

#### 2.4. Lá»›p 4: Quáº£n trá»‹ (Governance Layer)

ÄÃ¢y lÃ  lá»›p giÃ¡m sÃ¡t vÃ  kiá»ƒm soÃ¡t, Ä‘áº£m báº£o ráº±ng agent hoáº¡t Ä‘á»™ng trong cÃ¡c giá»›i háº¡n an toÃ n, cÃ³ Ä‘áº¡o Ä‘á»©c, vÃ  cÃ³ thá»ƒ kiá»ƒm soÃ¡t Ä‘Æ°á»£c. Trong cÃ¡c há»‡ thá»‘ng sáº£n xuáº¥t, Ä‘Ã¢y lÃ  lá»›p quan trá»ng nháº¥t Ä‘á»ƒ xÃ¢y dá»±ng lÃ²ng tin vÃ  trÃ¡nh cÃ¡c háº­u quáº£ khÃ´ng mong muá»‘n.

**2.4.1. ThÃ nh pháº§n: RÃ o cháº¯n & Module an toÃ n (Guardrails & Safety Module)**

*   **Chá»©c nÄƒng:** Hoáº¡t Ä‘á»™ng nhÆ° má»™t "lÆ°Æ¡ng tÃ¢m" vÃ  "bá»™ pháº­n quáº£n lÃ½ rá»§i ro" cá»§a agent, Ã¡p Ä‘áº·t cÃ¡c quy táº¯c vÃ  rÃ ng buá»™c lÃªn hÃ nh vi cá»§a nÃ³.
*   **Chi tiáº¿t hoáº¡t Ä‘á»™ng:**
    *   **Lá»c Äáº§u vÃ o/Äáº§u ra (Input/Output Filtering):**
        *   **NgÄƒn cháº·n Prompt Injection:** PhÃ¡t hiá»‡n vÃ  vÃ´ hiá»‡u hÃ³a cÃ¡c ná»— lá»±c cá»§a ngÆ°á»i dÃ¹ng nháº±m ghi Ä‘Ã¨ lÃªn system prompt cá»§a agent.
        *   **Báº£o vá»‡ Dá»¯ liá»‡u CÃ¡ nhÃ¢n (PII Protection):** Tá»± Ä‘á»™ng phÃ¡t hiá»‡n vÃ  che giáº¥u cÃ¡c thÃ´ng tin nháº¡y cáº£m nhÆ° sá»‘ Ä‘iá»‡n thoáº¡i, email, sá»‘ tháº» tÃ­n dá»¥ng trong cáº£ log vÃ  cÃ¡c lá»‡nh gá»i cÃ´ng cá»¥.
        *   **Kiá»ƒm duyá»‡t ná»™i dung Ä‘á»™c háº¡i:** NgÄƒn cháº·n agent táº¡o ra hoáº·c xá»­ lÃ½ cÃ¡c ná»™i dung khÃ´ng phÃ¹ há»£p.
    *   **Kiá»ƒm soÃ¡t Truy cáº­p CÃ´ng cá»¥ (Tool Access Control):** KhÃ´ng pháº£i agent nÃ o cÅ©ng Ä‘Æ°á»£c phÃ©p sá»­ dá»¥ng má»i cÃ´ng cá»¥. Module nÃ y thá»±c thi cÃ¡c quy táº¯c **Kiá»ƒm soÃ¡t Truy cáº­p Dá»±a trÃªn Vai trÃ² (RBAC - Role-Based Access Control)**. VÃ­ dá»¥: chá»‰ cÃ³ "Financial Agent" má»›i Ä‘Æ°á»£c phÃ©p gá»i cÃ´ng cá»¥ `execute_payment`.
    *   **GiÃ¡m sÃ¡t NgÃ¢n sÃ¡ch vÃ  TÃ i nguyÃªn (Budget & Resource Monitoring):** Má»—i lá»‡nh gá»i LLM Ä‘á»u tá»‘n tiá»n. Guardrails sáº½ theo dÃµi tá»•ng chi phÃ­ token vÃ  cÃ³ thá»ƒ dá»«ng agent náº¿u nÃ³ vÆ°á»£t quÃ¡ má»™t ngÃ¢n sÃ¡ch Ä‘Ã£ Ä‘á»‹nh trÆ°á»›c Ä‘á»ƒ trÃ¡nh cÃ¡c hÃ³a Ä‘Æ¡n "trÃªn trá»i".
*   **Táº§m quan trá»ng:** Trong mÃ´i trÆ°á»ng doanh nghiá»‡p, má»™t agent khÃ´ng cÃ³ Guardrails lÃ  má»™t rá»§i ro khÃ´ng thá»ƒ cháº¥p nháº­n. Lá»›p nÃ y Ä‘áº£m báº£o agent hoáº¡t Ä‘á»™ng má»™t cÃ¡ch cÃ³ trÃ¡ch nhiá»‡m, an toÃ n vÃ  tuÃ¢n thá»§ cÃ¡c quy Ä‘á»‹nh.

**2.4.2. ThÃ nh pháº§n: Giao diá»‡n Con ngÆ°á»i trong vÃ²ng láº·p (Human-in-the-Loop - HITL Interface)**

*   **Chá»©c nÄƒng:** Cung cáº¥p má»™t cÆ¡ cháº¿ Ä‘á»ƒ con ngÆ°á»i cÃ³ thá»ƒ giÃ¡m sÃ¡t, can thiá»‡p, vÃ  phÃª duyá»‡t cÃ¡c hÃ nh Ä‘á»™ng cá»§a agent táº¡i cÃ¡c thá»i Ä‘iá»ƒm quan trá»ng.
*   **Chi tiáº¿t hoáº¡t Ä‘á»™ng:**
    *   **Äá»‹nh nghÄ©a Äiá»ƒm dá»«ng (Checkpoint Definition):** ÄÃ¢y lÃ  quyáº¿t Ä‘á»‹nh thiáº¿t káº¿ quan trá»ng: khi nÃ o agent nÃªn dá»«ng láº¡i vÃ  há»i Ã½ kiáº¿n con ngÆ°á»i? CÃ¡c Ä‘iá»ƒm dá»«ng phá»• biáº¿n bao gá»“m:
        *   TrÆ°á»›c khi thá»±c hiá»‡n má»™t hÃ nh Ä‘á»™ng khÃ´ng thá»ƒ Ä‘áº£o ngÆ°á»£c (vÃ­ dá»¥: xÃ³a file, gá»­i tiá»n).
        *   Khi agent cÃ³ Ä‘á»™ tin cáº­y tháº¥p vá» bÆ°á»›c Ä‘i tiáº¿p theo.
        *   Khi chi phÃ­ cá»§a hÃ nh Ä‘á»™ng tiáº¿p theo vÆ°á»£t quÃ¡ má»™t ngÆ°á»¡ng nháº¥t Ä‘á»‹nh.
    *   **Giao diá»‡n NgÆ°á»i dÃ¹ng (UI/UX) cho TÆ°Æ¡ng tÃ¡c:** Cáº§n cÃ³ má»™t giao diá»‡n rÃµ rÃ ng Ä‘á»ƒ con ngÆ°á»i cÃ³ thá»ƒ xem xÃ©t káº¿ hoáº¡ch cá»§a agent, cÃ¡c tham sá»‘ cá»§a cÃ´ng cá»¥ sáº¯p Ä‘Æ°á»£c gá»i, vÃ  sau Ä‘Ã³ Ä‘Æ°a ra quyáº¿t Ä‘á»‹nh: **PhÃª duyá»‡t (Approve)**, **Tá»« chá»‘i (Reject)**, hoáº·c **Chá»‰nh sá»­a (Edit)**.
    *   **CÆ¡ cháº¿ leo thang (Escalation Paths):** Náº¿u agent tháº¥t báº¡i nhiá»u láº§n hoáº·c gáº·p pháº£i má»™t váº¥n Ä‘á» mÃ  nÃ³ khÃ´ng thá»ƒ giáº£i quyáº¿t, há»‡ thá»‘ng HITL pháº£i cÃ³ má»™t quy trÃ¬nh Ä‘á»ƒ "leo thang" váº¥n Ä‘á» Ä‘Ã³ Ä‘áº¿n má»™t chuyÃªn gia con ngÆ°á»i phÃ¹ há»£p.
*   **Táº§m quan trá»ng:** HITL lÃ  cáº§u ná»‘i giá»¯a tá»± Ä‘á»™ng hÃ³a hoÃ n toÃ n vÃ  sá»± kiá»ƒm soÃ¡t cá»§a con ngÆ°á»i. NÃ³ cho phÃ©p cÃ¡c doanh nghiá»‡p táº­n dá»¥ng sá»©c máº¡nh cá»§a agent cho cÃ¡c tÃ¡c vá»¥ rá»§i ro cao, trong khi váº«n Ä‘áº£m báº£o ráº±ng quyáº¿t Ä‘á»‹nh cuá»‘i cÃ¹ng luÃ´n náº±m trong tay con ngÆ°á»i. ÄÃ¢y lÃ  má»™t thÃ nh pháº§n khÃ´ng thá»ƒ thiáº¿u Ä‘á»ƒ triá»ƒn khai agent má»™t cÃ¡ch cÃ³ trÃ¡ch nhiá»‡m trong cÃ¡c á»©ng dá»¥ng thá»±c táº¿.

---

*Káº¿t thÃºc Pháº§n I. ChÃºng ta Ä‘Ã£ hoÃ n thÃ nh viá»‡c phÃ¢n tÃ­ch MECE toÃ n bá»™ cÃ¡c thÃ nh pháº§n cáº¥u táº¡o nÃªn má»™t há»‡ thá»‘ng agent. Vá»›i ná»n táº£ng vá»¯ng cháº¯c nÃ y, trong Pháº§n II, chÃºng ta sáº½ khÃ¡m phÃ¡ cÃ¡c cÃ¡ch khÃ¡c nhau Ä‘á»ƒ láº¯p rÃ¡p cÃ¡c thÃ nh pháº§n nÃ y thÃ nh cÃ¡c loáº¡i kiáº¿n trÃºc agent khÃ¡c nhau Ä‘á»ƒ giáº£i quyáº¿t cÃ¡c bÃ i toÃ¡n thá»±c táº¿.*


## PHáº¦N II: PHÃ‚N LOáº I MECE CÃC KIáº¾N TRÃšC VÃ€ á»¨NG Dá»¤NG AGENT

Sau khi Ä‘Ã£ hiá»ƒu rÃµ cÃ¡c thÃ nh pháº§n cáº¥u táº¡o nÃªn má»™t agent, bÆ°á»›c tiáº¿p theo lÃ  tÃ¬m hiá»ƒu cÃ¡ch láº¯p rÃ¡p chÃºng thÃ nh cÃ¡c **kiáº¿n trÃºc (architectures)** khÃ¡c nhau. KhÃ´ng pháº£i táº¥t cáº£ cÃ¡c agent Ä‘á»u Ä‘Æ°á»£c táº¡o ra nhÆ° nhau. Viá»‡c lá»±a chá»n kiáº¿n trÃºc phÃ¹ há»£p lÃ  má»™t trong nhá»¯ng quyáº¿t Ä‘á»‹nh quan trá»ng nháº¥t, áº£nh hÆ°á»Ÿng trá»±c tiáº¿p Ä‘áº¿n Ä‘á»™ phá»©c táº¡p, chi phÃ­, vÃ  kháº£ nÄƒng cá»§a há»‡ thá»‘ng.

Trong pháº§n nÃ y, chÃºng ta sáº½ giá»›i thiá»‡u má»™t khung phÃ¢n loáº¡i MECE, giÃºp báº¡n Ä‘á»‹nh vá»‹ Ä‘Æ°á»£c bÃ i toÃ¡n cá»§a mÃ¬nh vÃ  lá»±a chá»n kiáº¿n trÃºc agent phÃ¹ há»£p nháº¥t.

### ChÆ°Æ¡ng 3: SÆ¡ Ä‘á»“ PhÃ¢n loáº¡i á»¨ng dá»¥ng Agent

#### 3.1. Hai trá»¥c phÃ¢n loáº¡i: Agency vÃ  Coordination

Dá»±a trÃªn cÃ¡c nghiÃªn cá»©u vÃ  thá»±c tiá»…n tá»« cÃ¡c cÃ´ng ty hÃ ng Ä‘áº§u nhÆ° Google, Anthropic, vÃ  Databricks, chÃºng ta cÃ³ thá»ƒ phÃ¢n loáº¡i háº§u háº¿t má»i á»©ng dá»¥ng agentic theo hai trá»¥c chÃ­nh, trá»±c giao vá»›i nhau:

1.  **Má»©c Ä‘á»™ Tá»± chá»§ (Agency):** Trá»¥c nÃ y Ä‘o lÆ°á»ng má»©c Ä‘á»™ tá»± do ra quyáº¿t Ä‘á»‹nh cá»§a agent. NÃ³ tráº£i dÃ i tá»« **Thá»¥ Ä‘á»™ng/XÃ¡c Ä‘á»‹nh (Deterministic)**, nÆ¡i agent chá»‰ tuÃ¢n theo má»™t ká»‹ch báº£n Ä‘Æ°á»£c láº­p trÃ¬nh sáºµn, Ä‘áº¿n **Tá»± chá»§/HÆ°á»›ng má»¥c tiÃªu (Autonomous/Goal-Oriented)**, nÆ¡i agent cÃ³ thá»ƒ tá»± láº­p káº¿ hoáº¡ch vÃ  thÃ­ch á»©ng Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c má»™t má»¥c tiÃªu cáº¥p cao.

2.  **Má»©c Ä‘á»™ Phá»‘i há»£p (Coordination):** Trá»¥c nÃ y Ä‘o lÆ°á»ng sá»‘ lÆ°á»£ng agent tham gia vÃ  cÃ¡ch chÃºng tÆ°Æ¡ng tÃ¡c. NÃ³ tráº£i dÃ i tá»« **ÄÆ¡n láº» (Single)**, nÆ¡i chá»‰ cÃ³ má»™t agent hoáº¡t Ä‘á»™ng Ä‘á»™c láº­p, Ä‘áº¿n **Äa agent/Phá»‘i há»£p (Multi-Agent)**, nÆ¡i nhiá»u agent lÃ m viá»‡c cÃ¹ng nhau.

#### 3.2. Ma tráº­n 4 Quadrant

Khi káº¿t há»£p hai trá»¥c nÃ y, chÃºng ta cÃ³ má»™t ma tráº­n 2x2 máº¡nh máº½, táº¡o ra bá»‘n loáº¡i kiáº¿n trÃºc agent cÆ¡ báº£n. Ma tráº­n nÃ y lÃ  má»™t cÃ´ng cá»¥ tÆ° duy cá»±c ká»³ há»¯u Ã­ch Ä‘á»ƒ phÃ¢n tÃ­ch vÃ  thiáº¿t káº¿ há»‡ thá»‘ng.

| | **Tháº¥p Agency** (XÃ¡c Ä‘á»‹nh, HÆ°á»›ng tÃ¡c vá»¥) | **Cao Agency** (Tá»± chá»§, HÆ°á»›ng má»¥c tiÃªu) |
| :--- | :--- | :--- |
| **Tháº¥p Coordination** (ÄÆ¡n agent) | **Quadrant 1: Instruction**<br>_"RPA Ä‘Æ°á»£c tÄƒng cÆ°á»ng LLM"_ | **Quadrant 3: Autonomy**<br>_"NgÆ°á»i giáº£i quyáº¿t váº¥n Ä‘á» Ä‘á»™c láº­p"_ |
| **Cao Coordination** (Äa agent) | **Quadrant 2: Orchestration**<br>_"DÃ¢y chuyá»n láº¯p rÃ¡p thÃ´ng minh"_ | **Quadrant 4: Choreography**<br>_"Äá»™i ngÅ© chuyÃªn gia tá»± quáº£n"_ |

Bá»‘n quadrant nÃ y khÃ´ng chá»‰ lÃ  lÃ½ thuyáº¿t. ChÃºng Ä‘áº¡i diá»‡n cho cÃ¡c máº«u kiáº¿n trÃºc (architectural patterns) phá»• biáº¿n nháº¥t trong thá»±c táº¿. Trong cÃ¡c chÆ°Æ¡ng tiáº¿p theo, chÃºng ta sáº½ Ä‘i sÃ¢u vÃ o tá»«ng quadrant, phÃ¢n tÃ­ch kiáº¿n trÃºc, vÃ­ dá»¥, vÃ  cÃ¡c trÆ°á»ng há»£p nÃªn/khÃ´ng nÃªn sá»­ dá»¥ng.

### ChÆ°Æ¡ng 4: PhÃ¢n tÃ­ch sÃ¢u Quadrant 1: Instruction

ÄÃ¢y lÃ  Ä‘iá»ƒm khá»Ÿi Ä‘áº§u cho háº§u háº¿t cÃ¡c á»©ng dá»¥ng agentic trong doanh nghiá»‡p. NÃ³ Ä‘Æ¡n giáº£n, Ä‘Ã¡ng tin cáº­y, vÃ  mang láº¡i giÃ¡ trá»‹ ngay láº­p tá»©c.

#### 4.1. Kiáº¿n trÃºc vÃ  Luá»“ng hoáº¡t Ä‘á»™ng

Má»™t agent "Instruction" hoáº¡t Ä‘á»™ng giá»‘ng nhÆ° má»™t quy trÃ¬nh Tá»± Ä‘á»™ng hÃ³a Quy trÃ¬nh Robot (RPA) Ä‘Æ°á»£c tÄƒng cÆ°á»ng bá»Ÿi kháº£ nÄƒng hiá»ƒu ngÃ´n ngá»¯ tá»± nhiÃªn cá»§a LLM. Luá»“ng hoáº¡t Ä‘á»™ng cá»§a nÃ³ lÃ  tuyáº¿n tÃ­nh vÃ  cÃ³ thá»ƒ dá»± Ä‘oÃ¡n Ä‘Æ°á»£c.

**SÆ¡ Ä‘á»“ luá»“ng hoáº¡t Ä‘á»™ng (VÃ­ dá»¥: Agent PhÃ¢n loáº¡i Ticket Há»— trá»£):**

![SÆ¡ Ä‘á»“ luá»“ng Agent Ä‘Æ¡n giáº£n](simple_agent_flow.png)

```mermaid
flowchart TD
    Start([External Trigger<br/>Email má»›i, Event...]) --> IP[Input Processor<br/>TrÃ­ch xuáº¥t ná»™i dung]
    
    IP --> Prompt[Fixed Prompt Template<br/>'PhÃ¢n loáº¡i ticket thÃ nh A/B/C<br/>Priority: High/Medium/Low<br/>Return JSON']
    
    Prompt --> LLM[Reasoning Engine<br/>LLM Call - Single Shot]
    
    LLM --> Parse[Parse JSON Output<br/>category, priority]
    
    Parse --> Tool[Execution Engine<br/>Call Single Tool:<br/>tag_support_ticket]
    
    Tool --> API[External API<br/>Jira/Zendesk]
    
    API --> End([End<br/>Ticket Ä‘Æ°á»£c tag])
    
    style Start fill:#e1f5ff
    style End fill:#c8e6c9
    style LLM fill:#fff9c4
    style Tool fill:#ffe0b2
    
    classDef deterministic fill:#f0f0f0,stroke:#333,stroke-width:2px
    class IP,Prompt,Parse deterministic
```

> Agent chá»‰ lÃ m má»™t viá»‡c tuyáº¿n tÃ­nh: nháº­n input, gá»i LLM 1 láº§n Ä‘á»ƒ phÃ¢n loáº¡i, rá»“i gá»i Ä‘Ãºng 1 tool. KhÃ´ng cÃ³ vÃ²ng láº·p, khÃ´ng láº­p káº¿ hoáº¡ch nhiá»u bÆ°á»›c, khÃ´ng nhá»› lá»‹ch sá»­.


*   **Luá»“ng hoáº¡t Ä‘á»™ng:**
    1.  **Äáº§u vÃ o:** Má»™t sá»± kiá»‡n bÃªn ngoÃ i kÃ­ch hoáº¡t agent (vÃ­ dá»¥: email má»›i Ä‘Æ°á»£c gá»­i Ä‘áº¿n hÃ²m thÆ° há»— trá»£).
    2.  **Xá»­ lÃ½:** Input Processor nháº­n email vÃ  trÃ­ch xuáº¥t ná»™i dung.
    3.  **Suy luáº­n:** Reasoning Engine (LLM) Ä‘Æ°á»£c gá»i vá»›i má»™t prompt ráº¥t cá»¥ thá»ƒ: "Dá»±a trÃªn ná»™i dung sau, hÃ£y phÃ¢n loáº¡i ticket thÃ nh má»™t trong cÃ¡c loáº¡i [A, B, C] vÃ  xÃ¡c Ä‘á»‹nh má»©c Ä‘á»™ Æ°u tiÃªn lÃ  [Cao, Trung bÃ¬nh, Tháº¥p]. Tráº£ vá» káº¿t quáº£ dÆ°á»›i dáº¡ng JSON."
    4.  **HÃ nh Ä‘á»™ng:** Execution Engine nháº­n káº¿t quáº£ JSON vÃ  gá»i má»™t cÃ´ng cá»¥ duy nháº¥t, `tag_support_ticket`, vá»›i cÃ¡c tham sá»‘ Ä‘Ã£ Ä‘Æ°á»£c phÃ¢n loáº¡i.
    5.  **Káº¿t thÃºc:** CÃ´ng cá»¥ tÆ°Æ¡ng tÃ¡c vá»›i API cá»§a Jira/Zendesk. Quy trÃ¬nh káº¿t thÃºc.

*   **Äáº·c Ä‘iá»ƒm kiáº¿n trÃºc:**
    *   **Tuyáº¿n tÃ­nh:** KhÃ´ng cÃ³ vÃ²ng láº·p phá»©c táº¡p hay tÃ¡i láº­p káº¿ hoáº¡ch.
    *   **Tráº¡ng thÃ¡i tá»‘i thiá»ƒu:** Agent khÃ´ng cáº§n nhá»› cÃ¡c tÆ°Æ¡ng tÃ¡c trÆ°á»›c Ä‘Ã³.
    *   **CÃ´ng cá»¥ chuyÃªn biá»‡t:** ThÆ°á»ng chá»‰ cÃ³ má»™t hoáº·c má»™t vÃ i cÃ´ng cá»¥ ráº¥t cá»¥ thá»ƒ.
    *   **Prompt Ä‘Æ°á»£c kiá»ƒm soÃ¡t cháº·t cháº½:** System prompt vÃ  user prompt Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ háº¡n cháº¿ tá»‘i Ä‘a sá»± "sÃ¡ng táº¡o" cá»§a LLM.

#### 4.2. VÃ­ dá»¥ thá»±c táº¿

*   **Chatbot Há»i-ÄÃ¡p trÃªn tÃ i liá»‡u (Simple RAG):** NgÆ°á»i dÃ¹ng há»i má»™t cÃ¢u, agent tÃ¬m kiáº¿m trong cÆ¡ sá»Ÿ dá»¯ liá»‡u vector, láº¥y ngá»¯ cáº£nh liÃªn quan, vÃ  káº¿t há»£p vá»›i cÃ¢u há»i Ä‘á»ƒ LLM tráº£ lá»i. ToÃ n bá»™ quy trÃ¬nh lÃ  má»™t chuá»—i cÃ¡c bÆ°á»›c xÃ¡c Ä‘á»‹nh.
*   **TÃ³m táº¯t cuá»™c há»p:** Agent nháº­n báº£n ghi Ã¢m cuá»™c há»p, sá»­ dá»¥ng cÃ´ng cá»¥ Speech-to-Text, sau Ä‘Ã³ gá»­i vÄƒn báº£n cho LLM vá»›i prompt "TÃ³m táº¯t cÃ¡c Ä‘iá»ƒm chÃ­nh vÃ  cÃ¡c má»¥c hÃ nh Ä‘á»™ng."
*   **PhÃ¢n loáº¡i cáº£m xÃºc khÃ¡ch hÃ ng:** Agent Ä‘á»c cÃ¡c bÃ i Ä‘Ã¡nh giÃ¡ sáº£n pháº©m vÃ  gáº¯n tháº» cáº£m xÃºc (TÃ­ch cá»±c, TiÃªu cá»±c, Trung tÃ­nh).

#### 4.3. Khi nÃ o nÃªn sá»­ dá»¥ng vÃ  giá»›i háº¡n

*   **NÃªn sá»­ dá»¥ng khi:**
    *   Quy trÃ¬nh nghiá»‡p vá»¥ rÃµ rÃ ng, cÃ³ tÃ­nh láº·p láº¡i.
    *   YÃªu cáº§u Ä‘á»™ tin cáº­y vÃ  tÃ­nh nháº¥t quÃ¡n cao.
    *   Rá»§i ro tá»« cÃ¡c hÃ nh Ä‘á»™ng sai láº§m lÃ  Ä‘Ã¡ng ká»ƒ, cáº§n sá»± kiá»ƒm soÃ¡t cháº·t cháº½.
    *   Báº¡n má»›i báº¯t Ä‘áº§u vá»›i agent vÃ  muá»‘n cÃ³ má»™t "chiáº¿n tháº¯ng" nhanh chÃ³ng, dá»… dÃ ng.
*   **Giá»›i háº¡n:**
    *   KhÃ´ng thá»ƒ xá»­ lÃ½ cÃ¡c yÃªu cáº§u mÆ¡ há»“ hoáº·c cÃ¡c tÃ¡c vá»¥ Ä‘Ã²i há»i sá»± linh hoáº¡t.
    *   KhÃ´ng thá»ƒ thÃ­ch á»©ng vá»›i cÃ¡c tÃ¬nh huá»‘ng khÃ´ng lÆ°á»ng trÆ°á»›c.
    *   KÃ©m hiá»‡u quáº£ Ä‘á»‘i vá»›i cÃ¡c váº¥n Ä‘á» cáº§n nhiá»u bÆ°á»›c hoáº·c nhiá»u nguá»“n dá»¯ liá»‡u khÃ¡c nhau.

### ChÆ°Æ¡ng 5: PhÃ¢n tÃ­ch sÃ¢u Quadrant 2: Orchestration

Khi má»™t quy trÃ¬nh nghiá»‡p vá»¥ trá»Ÿ nÃªn quÃ¡ phá»©c táº¡p cho má»™t agent Ä‘Æ¡n láº», nhÆ°ng váº«n cÃ³ thá»ƒ Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh trÆ°á»›c, chÃºng ta bÆ°á»›c vÃ o Quadrant 2.

#### 5.1. Kiáº¿n trÃºc vÃ  Luá»“ng hoáº¡t Ä‘á»™ng

```mermaid
flowchart TD
    SCHED[Scheduler hoac Trigger] --> ORCH[Orchestrator Workflow Engine]

    ORCH --> A1[Agent Thu thap Du lieu]
    A1 --> DB[He thong DB tai chinh]
    A1 --> ORCH

    ORCH --> A2[Agent Phan tich So lieu]
    A2 --> LIB[Thu vien Phan tich vd Pandas]
    A2 --> ORCH

    ORCH --> A3[Agent Viet Bao cao]
    A3 --> LLM[LLM sinh van ban]
    A3 --> ORCH

    ORCH --> A4[Agent Dinh dang tai lieu]
    A4 --> FORMAT[Tool xuat PDF hoac slide]
    A4 --> ORCH

    ORCH --> OUT[Gui bao cao cho Stakeholder]

```

```mermaid
flowchart TB
    Trigger([Scheduler Trigger<br/>NgÃ y cuá»‘i quÃ½]) --> Orchestrator{Central Orchestrator<br/>Code Ä‘iá»u phá»‘i}
    
    Orchestrator -->|Step 1| Agent1[Agent 1: Thu tháº­p Dá»¯ liá»‡u<br/>Tools: DB Connector]
    Agent1 --> Data1[(Raw Data<br/>Sales + Accounting)]
    
    Data1 --> Orchestrator
    
    Orchestrator -->|Step 2| Agent2[Agent 2: PhÃ¢n tÃ­ch<br/>Tools: Pandas, Calculator]
    Agent2 --> Data2[Computed Metrics<br/>Revenue, Profit, Cost]
    
    Data2 --> Orchestrator
    
    Orchestrator -->|Step 3| Agent3[Agent 3: Viáº¿t BÃ¡o cÃ¡o<br/>Tools: LLM Generator]
    Agent3 --> Report[Summary Text<br/>TÃ¬nh hÃ¬nh kinh doanh]
    
    Report --> Orchestrator
    
    Orchestrator -->|Step 4| Agent4[Agent 4: Äá»‹nh dáº¡ng<br/>Tools: PDF Generator]
    Agent4 --> PDF[Final PDF Report<br/>+ Logo]
    
    PDF --> Orchestrator
    
    Orchestrator -->|Final| Email[Send Email Tool<br/>Gá»­i cho Ban giÃ¡m Ä‘á»‘c]
    
    Email --> End([End])
    
    style Orchestrator fill:#ff9800,stroke:#e65100,stroke-width:3px,color:#fff
    style Agent1 fill:#64b5f6
    style Agent2 fill:#81c784
    style Agent3 fill:#ffb74d
    style Agent4 fill:#ba68c8
    style Email fill:#e57373
```

> Orchestrator (code) Ä‘iá»u phá»‘i láº§n lÆ°á»£t nhiá»u agent chuyÃªn biá»‡t. Má»—i agent lÃ m pháº§n viá»‡c cá»§a mÃ¬nh rá»“i tráº£ káº¿t quáº£ vá». Luá»“ng cÃ´ng viá»‡c cá»‘ Ä‘á»‹nh, Ã­t hoáº·c khÃ´ng cÃ³ tá»± chá»§ á»Ÿ tá»«ng agent.


Kiáº¿n trÃºc "Orchestration" giá»‘ng nhÆ° má»™t dÃ¢y chuyá»n láº¯p rÃ¡p thÃ´ng minh, nÆ¡i má»—i "tráº¡m" lÃ  má»™t agent chuyÃªn biá»‡t (hoáº·c má»™t LLM call). Má»™t "nhÃ  Ä‘iá»u phá»‘i" (Orchestrator), thÆ°á»ng lÃ  code cá»©ng chá»© khÃ´ng pháº£i LLM, sáº½ Ä‘iá»u hÆ°á»›ng cÃ´ng viá»‡c qua cÃ¡c tráº¡m theo má»™t luá»“ng Ä‘Ã£ Ä‘á»‹nh.

*   **Luá»“ng hoáº¡t Ä‘á»™ng (VÃ­ dá»¥: Quy trÃ¬nh táº¡o bÃ¡o cÃ¡o tÃ i chÃ­nh hÃ ng quÃ½):**
    1.  **KÃ­ch hoáº¡t:** ÄÃºng ngÃ y cuá»‘i cÃ¹ng cá»§a quÃ½, má»™t bá»™ láº­p lá»‹ch (scheduler) kÃ­ch hoáº¡t quy trÃ¬nh.
    2.  **Tráº¡m 1 (Agent Thu tháº­p Dá»¯ liá»‡u):** Orchestrator gá»i agent nÃ y. NÃ³ cÃ³ cÃ´ng cá»¥ Ä‘á»ƒ káº¿t ná»‘i vÃ o cÆ¡ sá»Ÿ dá»¯ liá»‡u bÃ¡n hÃ ng vÃ  káº¿ toÃ¡n, trÃ­ch xuáº¥t dá»¯ liá»‡u thÃ´.
    3.  **Tráº¡m 2 (Agent PhÃ¢n tÃ­ch):** Orchestrator nháº­n dá»¯ liá»‡u thÃ´ vÃ  chuyá»ƒn cho agent nÃ y. NÃ³ sá»­ dá»¥ng cÃ¡c cÃ´ng cá»¥ phÃ¢n tÃ­ch (vd: thÆ° viá»‡n Pandas) Ä‘á»ƒ tÃ­nh toÃ¡n cÃ¡c chá»‰ sá»‘ quan trá»ng (doanh thu, lá»£i nhuáº­n, chi phÃ­).
    4.  **Tráº¡m 3 (Agent Viáº¿t BÃ¡o cÃ¡o):** Orchestrator nháº­n cÃ¡c chá»‰ sá»‘ vÃ  chuyá»ƒn cho agent nÃ y. NÃ³ sá»­ dá»¥ng LLM vá»›i prompt "Viáº¿t má»™t báº£n tÃ³m táº¯t tÃ¬nh hÃ¬nh kinh doanh dá»±a trÃªn cÃ¡c sá»‘ liá»‡u sau."
    5.  **Tráº¡m 4 (Agent Äá»‹nh dáº¡ng):** Orchestrator nháº­n báº£n tÃ³m táº¯t vÃ  chuyá»ƒn cho agent nÃ y Ä‘á»ƒ Ä‘á»‹nh dáº¡ng thÃ nh file PDF vá»›i logo cÃ´ng ty.
    6.  **Káº¿t thÃºc:** Orchestrator gá»­i email file PDF cho ban giÃ¡m Ä‘á»‘c.

*   **Äáº·c Ä‘iá»ƒm kiáº¿n trÃºc:**
    *   **Dá»±a trÃªn quy trÃ¬nh (Process-driven):** Trá»ng tÃ¢m lÃ  luá»“ng cÃ´ng viá»‡c, khÃ´ng pháº£i má»™t agent Ä‘Æ¡n láº».
    *   **ChuyÃªn mÃ´n hÃ³a:** Má»—i agent/tráº¡m cÃ³ má»™t bá»™ cÃ´ng cá»¥ vÃ  trÃ¡ch nhiá»‡m riÃªng biá»‡t.
    *   **Äiá»u phá»‘i táº­p trung:** Orchestrator (code) kiá»ƒm soÃ¡t hoÃ n toÃ n luá»“ng Ä‘i cá»§a dá»¯ liá»‡u.
    *   **Agency tháº¥p:** CÃ¡c agent riÃªng láº» váº«n chá»‰ thá»±c hiá»‡n cÃ¡c tÃ¡c vá»¥ Ä‘Æ°á»£c giao, khÃ´ng tá»± ra quyáº¿t Ä‘á»‹nh.

#### 5.2. VÃ­ dá»¥ thá»±c táº¿

*   **Quy trÃ¬nh tuyá»ƒn dá»¥ng tá»± Ä‘á»™ng:** Má»™t agent quÃ©t há»“ sÆ¡ á»©ng viÃªn, má»™t agent khÃ¡c lÃªn lá»‹ch phá»ng váº¥n, má»™t agent thá»© ba gá»­i email xÃ¡c nháº­n.
*   **Tá»± Ä‘á»™ng hÃ³a Marketing:** Má»™t agent theo dÃµi cÃ¡c Ä‘á» cáº­p trÃªn máº¡ng xÃ£ há»™i, má»™t agent khÃ¡c táº¡o ná»™i dung tráº£ lá»i, vÃ  má»™t agent thá»© ba Ä‘Äƒng bÃ i.

#### 5.3. So sÃ¡nh vá»›i microservices truyá»n thá»‘ng

Kiáº¿n trÃºc Orchestration ráº¥t giá»‘ng vá»›i kiáº¿n trÃºc Microservices. Má»—i agent chuyÃªn biá»‡t cÃ³ thá»ƒ Ä‘Æ°á»£c xem nhÆ° má»™t microservice. Äiá»ƒm khÃ¡c biá»‡t chÃ­nh lÃ  cÃ¡c "microservice" nÃ y Ä‘Æ°á»£c tÄƒng cÆ°á»ng bá»Ÿi LLM, cho phÃ©p chÃºng xá»­ lÃ½ cÃ¡c Ä‘áº§u vÃ o/Ä‘áº§u ra báº±ng ngÃ´n ngá»¯ tá»± nhiÃªn vÃ  thá»±c hiá»‡n cÃ¡c tÃ¡c vá»¥ suy luáº­n mÃ  microservice truyá»n thá»‘ng khÃ´ng thá»ƒ.

### ChÆ°Æ¡ng 6: PhÃ¢n tÃ­ch sÃ¢u Quadrant 3: Autonomy

ÄÃ¢y lÃ  nÆ¡i sá»± "thÃ´ng minh" thá»±c sá»± cá»§a agent báº¯t Ä‘áº§u tá»a sÃ¡ng. Thay vÃ¬ chá»‰ lÃ m theo ká»‹ch báº£n, agent Ä‘Æ°á»£c trao quyá»n tá»± chá»§ Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c má»¥c tiÃªu.

#### 6.1. Kiáº¿n trÃºc vÃ  Luá»“ng hoáº¡t Ä‘á»™ng

```mermaid
flowchart TD
    U[User Goal muc tieu cap cao] --> A[Autonomous Agent]

    subgraph LOOP[Reason Act Observe Loop]
        A --> S[Agent State muc tieu va context]

        S --> R[Reason Step LLM suy luan]
        R --> DEC{Can goi tool?}

        DEC --> PLAN[No tool Can Tra loi hoac lap ke hoach cuoi]
        DEC --> CALL[Yes tool Call]

        CALL --> T[Tool Execution Layer]
        T --> T1[Domain Tools API DB FS]
        T --> T2[Knowledge Tools search RAG]
        T1 --> OBS[Observe ket qua]
        T2 --> OBS

        OBS --> S
    end

    PLAN --> OUT[Final Plan hoac Answer]
    OUT --> U

```

```mermaid
flowchart TD
    Goal([User Goal<br/>'Plan chuyáº¿n Ä‘i ÄÃ  Láº¡t<br/>cuá»‘i tuáº§n, focus cÃ  phÃª'])
    
    Goal --> State[Agent State<br/>Messages + Context]
    
    State --> Loop{ReAct Loop}
    
    Loop --> Reason1[ğŸ§  REASON #1<br/>'Cáº§n biáº¿t ngÃ y Ä‘i/vá»<br/>â†’ Há»i user']
    Reason1 --> Act1[ğŸ’¬ ACT: Ask User<br/>'Báº¡n muá»‘n Ä‘i cuá»‘i tuáº§n nÃ o?']
    Act1 --> Observe1[ğŸ‘ OBSERVE<br/>User reply: '20-22/12']
    
    Observe1 --> UpdateState1[Update State<br/>+ date info]
    UpdateState1 --> Loop
    
    Loop --> Reason2[ğŸ§  REASON #2<br/>'ÄÃ£ cÃ³ ngÃ y<br/>â†’ Cáº§n tÃ¬m chuyáº¿n bay']
    Reason2 --> Act2[ğŸ”§ ACT: Tool Call<br/>search_flights]
    Act2 --> Tool1[Flight Search API]
    Tool1 --> Observe2[ğŸ‘ OBSERVE<br/>List flights returned]
    
    Observe2 --> UpdateState2[Update State<br/>+ flight options]
    UpdateState2 --> Loop
    
    Loop --> Reason3[ğŸ§  REASON #3<br/>'ÄÃ£ cÃ³ bay<br/>â†’ TÃ¬m quÃ¡n cÃ  phÃª']
    Reason3 --> Act3[ğŸ”§ ACT: Tool Call<br/>search_POI type=cafe]
    Act3 --> Tool2[POI Search API]
    Tool2 --> Observe3[ğŸ‘ OBSERVE<br/>Cafe list returned]
    
    Observe3 --> UpdateState3[Update State<br/>+ cafe list]
    UpdateState3 --> Loop
    
    Loop --> ReasonN[ğŸ§  REASON #N<br/>'Äá»§ thÃ´ng tin<br/>â†’ Táº¡o lá»‹ch trÃ¬nh']
    ReasonN --> Final[ğŸ“‹ Final Output<br/>Complete Itinerary]
    
    Final --> End([End])
    
    style Loop fill:#ff5722,stroke:#bf360c,stroke-width:3px,color:#fff
    style Reason1 fill:#fff9c4
    style Reason2 fill:#fff9c4
    style Reason3 fill:#fff9c4
    style ReasonN fill:#fff9c4
    style Act1 fill:#e1bee7
    style Act2 fill:#e1bee7
    style Act3 fill:#e1bee7
    style Observe1 fill:#c5e1a5
    style Observe2 fill:#c5e1a5
    style Observe3 fill:#c5e1a5
    
    style State fill:#ffccbc,stroke:#d84315,stroke-width:2px
    style UpdateState1 fill:#ffccbc,stroke:#d84315,stroke-width:2px
    style UpdateState2 fill:#ffccbc,stroke:#d84315,stroke-width:2px
    style UpdateState3 fill:#ffccbc,stroke:#d84315,stroke-width:2px
```

> Má»™t agent duy nháº¥t láº·p vÃ²ng ReAct: Reason â†’ Act (tool) â†’ Observe â†’ Reasonâ€¦ cho Ä‘áº¿n khi Ä‘áº¡t má»¥c tiÃªu. NÃ³ tá»± quyáº¿t Ä‘á»‹nh cáº§n tool nÃ o, bao nhiÃªu bÆ°á»›c, káº¿ hoáº¡ch tháº¿ nÃ o.

Agent "Autonomy" hoáº¡t Ä‘á»™ng theo má»™t vÃ²ng láº·p liÃªn tá»¥c, ná»•i tiáº¿ng nháº¥t lÃ  máº«u **ReAct (Reason + Act)**. NÃ³ khÃ´ng Ä‘i theo má»™t Ä‘Æ°á»ng tháº³ng mÃ  lÃ  má»™t chu trÃ¬nh khÃ¡m phÃ¡ vÃ  Ä‘iá»u chá»‰nh.

*   **Luá»“ng hoáº¡t Ä‘á»™ng (VÃ­ dá»¥: Agent Láº­p káº¿ hoáº¡ch Du lá»‹ch):**
    1.  **Má»¥c tiÃªu:** NgÆ°á»i dÃ¹ng Ä‘Æ°a ra má»™t má»¥c tiÃªu cáº¥p cao: "TÃ¬m cho tÃ´i má»™t chuyáº¿n Ä‘i cuá»‘i tuáº§n Ä‘áº¿n ÄÃ  Láº¡t, táº­p trung vÃ o cÃ  phÃª vÃ  thiÃªn nhiÃªn."
    2.  **VÃ²ng láº·p 1:**
        *   **Reason (Suy luáº­n):** LLM nghÄ©: "Äá»ƒ lÃªn káº¿ hoáº¡ch, trÆ°á»›c háº¿t tÃ´i cáº§n biáº¿t ngÃ y Ä‘i vÃ  ngÃ y vá». TÃ´i sáº½ há»i ngÆ°á»i dÃ¹ng."
        *   **Act (HÃ nh Ä‘á»™ng):** Agent khÃ´ng cÃ³ cÃ´ng cá»¥ Ä‘á»ƒ há»i, nÃ³ chá»‰ tráº£ lá»i ngÆ°á»i dÃ¹ng: "Tuyá»‡t vá»i! Báº¡n muá»‘n Ä‘i vÃ o cuá»‘i tuáº§n nÃ o?"
    3.  **VÃ²ng láº·p 2 (Sau khi ngÆ°á»i dÃ¹ng tráº£ lá»i):**
        *   **Reason:** "OK, Ä‘Ã£ cÃ³ ngÃ y. Giá» tÃ´i cáº§n tÃ¬m chuyáº¿n bay. TÃ´i sáº½ dÃ¹ng cÃ´ng cá»¥ `search_flights`."
        *   **Act:** Execution Engine gá»i `search_flights(origin="SGN", destination="DLI", date="...")`.
        *   **Observe (Quan sÃ¡t):** CÃ´ng cá»¥ tráº£ vá» má»™t danh sÃ¡ch cÃ¡c chuyáº¿n bay.
    4.  **VÃ²ng láº·p 3:**
        *   **Reason:** "ÄÃ£ cÃ³ chuyáº¿n bay. Giá» tÃ´i cáº§n tÃ¬m cÃ¡c quÃ¡n cÃ  phÃª Ä‘áº¹p. TÃ´i sáº½ dÃ¹ng cÃ´ng cá»¥ `search_points_of_interest`."
        *   **Act:** Execution Engine gá»i `search_points_of_interest(location="Dalat", type="cafe")`.
        *   **Observe:** CÃ´ng cá»¥ tráº£ vá» má»™t danh sÃ¡ch cÃ¡c quÃ¡n cÃ  phÃª.
    5.  **...VÃ²ng láº·p tiáº¿p tá»¥c...** cho Ä‘áº¿n khi agent thu tháº­p Ä‘á»§ thÃ´ng tin vÃ  táº¡o ra má»™t lá»‹ch trÃ¬nh hoÃ n chá»‰nh.

*   **Äáº·c Ä‘iá»ƒm kiáº¿n trÃºc:**
    *   **HÆ°á»›ng má»¥c tiÃªu (Goal-oriented):** Agent chá»‰ cáº§n biáº¿t Ä‘Ã­ch Ä‘áº¿n, khÃ´ng cáº§n biáº¿t Ä‘Æ°á»ng Ä‘i.
    *   **VÃ²ng láº·p suy luáº­n:** Cá»‘t lÃµi lÃ  chu trÃ¬nh Reason-Act-Observe.
    *   **Lá»±a chá»n cÃ´ng cá»¥ Ä‘á»™ng:** Agent tá»± quyáº¿t Ä‘á»‹nh dÃ¹ng cÃ´ng cá»¥ nÃ o vÃ  khi nÃ o.
    *   **Quáº£n lÃ½ tráº¡ng thÃ¡i:** Agent pháº£i cÃ³ bá»™ nhá»› (ngáº¯n háº¡n) Ä‘á»ƒ lÆ°u trá»¯ káº¿t quáº£ cá»§a cÃ¡c bÆ°á»›c trÆ°á»›c Ä‘Ã³.

#### 6.2. VÃ­ dá»¥ thá»±c táº¿

*   **Agent NghiÃªn cá»©u:** NgÆ°á»i dÃ¹ng yÃªu cáº§u "Viáº¿t má»™t bÃ¡o cÃ¡o vá» thá»‹ trÆ°á»ng xe Ä‘iá»‡n táº¡i Viá»‡t Nam." Agent sáº½ tá»± tÃ¬m kiáº¿m Google, Ä‘á»c cÃ¡c bÃ i bÃ¡o, tá»•ng há»£p thÃ´ng tin, vÃ  viáº¿t bÃ¡o cÃ¡o.
*   **Agent Gá»¡ lá»—i Code:** Láº­p trÃ¬nh viÃªn Ä‘Æ°a ra má»™t Ä‘oáº¡n code lá»—i. Agent sáº½ tá»± Ä‘á»c lá»—i, Ä‘á» xuáº¥t cÃ¡c giáº£ thuyáº¿t, Ã¡p dá»¥ng cÃ¡c thay Ä‘á»•i, cháº¡y láº¡i code, vÃ  láº·p láº¡i cho Ä‘áº¿n khi sá»­a Ä‘Æ°á»£c lá»—i.

#### 6.3. ThÃ¡ch thá»©c: Sai sá»‘à¸—à¸šà¸§à¸ vÃ  Kiá»ƒm soÃ¡t

Sá»± tá»± do cá»§a agent tá»± chá»§ cÅ©ng lÃ  con dao hai lÆ°á»¡i. Má»™t sai láº§m nhá» á»Ÿ bÆ°á»›c Ä‘áº§u (vÃ­ dá»¥: hiá»ƒu sai má»™t káº¿t quáº£ tÃ¬m kiáº¿m) cÃ³ thá»ƒ dáº«n Ä‘áº¿n cÃ¡c quyáº¿t Ä‘á»‹nh sai láº§m á»Ÿ cÃ¡c bÆ°á»›c sau, táº¡o ra má»™t **sai sá»‘à¸—à¸šà¸§à¸ (compounding error)**. HÆ¡n ná»¯a, viá»‡c Ä‘á»ƒ agent tá»± do hÃ nh Ä‘á»™ng cÃ³ thá»ƒ dáº«n Ä‘áº¿n cÃ¡c káº¿t quáº£ khÃ´ng mong muá»‘n hoáº·c chi phÃ­ API tÄƒng vá»t. Do Ä‘Ã³, cÃ¡c agent nÃ y Ä‘Ã²i há»i pháº£i cÃ³ **sandboxing** (cháº¡y trong mÃ´i trÆ°á»ng bá»‹ cÃ´ láº­p) vÃ  cÃ¡c **Guardrails** (Lá»›p Quáº£n trá»‹) cá»±c ká»³ máº¡nh máº½.

### ChÆ°Æ¡ng 7: PhÃ¢n tÃ­ch sÃ¢u Quadrant 4: Choreography

ÄÃ¢y lÃ  biÃªn giá»›i cá»§a cÃ´ng nghá»‡ agentic, nÆ¡i cÃ¡c há»‡ thá»‘ng phá»©c táº¡p nháº¥t Ä‘Æ°á»£c xÃ¢y dá»±ng báº±ng cÃ¡ch cho nhiá»u agent tá»± chá»§ há»£p tÃ¡c vá»›i nhau.

#### 7.1. Kiáº¿n trÃºc vÃ  Luá»“ng hoáº¡t Ä‘á»™ng

Kiáº¿n trÃºc "Choreography" khÃ´ng cÃ³ má»™t nhÃ  Ä‘iá»u phá»‘i trung tÃ¢m. Thay vÃ o Ä‘Ã³, nÃ³ giá»‘ng nhÆ° má»™t Ä‘á»™i ngÅ© chuyÃªn gia, má»—i ngÆ°á»i cÃ³ chuyÃªn mÃ´n riÃªng, tá»± giao tiáº¿p vÃ  phá»‘i há»£p vá»›i nhau Ä‘á»ƒ giáº£i quyáº¿t má»™t váº¥n Ä‘á» lá»›n. HÃ nh vi cá»§a toÃ n bá»™ há»‡ thá»‘ng lÃ  **ná»•i hiá»‡n (emergent)** tá»« sá»± tÆ°Æ¡ng tÃ¡c cá»§a cÃ¡c cÃ¡ nhÃ¢n.

**SÆ¡ Ä‘á»“ luá»“ng hoáº¡t Ä‘á»™ng (VÃ­ dá»¥: Äá»™i Agent NghiÃªn cá»©u Thá»‹ trÆ°á»ng):**

```mermaid
flowchart TD
    PM[Product Manager hoac Business Owner] --> LEAD[Chief Agent Truong nhom]

    LEAD --> D1[Define Global Goal]
    D1 --> SPLIT[Phan ra cac nhiem vu con]

    SPLIT --> R1[Research Agent Thi truong]
    SPLIT --> R2[Finance Agent Von va doanh thu]
    SPLIT --> R3[Social Agent Cam xuc nguoi dung]

    R1 --> WEB[Web Search Tools va RAG]
    R2 --> FINAPI[API tai chinh vd Crunchbase]
    R3 --> SOCAPI[API mang xa hoi]

    WEB --> R1R[Report Market Findings]
    FINAPI --> R2R[Report Funding and Numbers]
    SOCAPI --> R3R[Report Sentiment Insights]

    R1R --> LEAD
    R2R --> LEAD
    R3R --> LEAD

    LEAD --> SYN[Summarize and Synthesize to Final Report]
    SYN --> PM

```

```mermaid
flowchart TB
    Goal([PM: Research Goal]) --> Chief[Chief Agent<br/>ğŸ“‹ Plan & Coordinate]
    
    Chief -.->|Assign| A1
    Chief -.->|Assign| A2
    Chief -.->|Assign| A3
    
    subgraph Agents[Autonomous Agents - Parallel Execution]
        A1[ğŸ“Š Data Agent<br/>Loop: Reason-Act-Observe<br/>Tools: Search, Parse]
        A2[ğŸ’° Finance Agent<br/>Loop: Reason-Act-Observe<br/>Tools: APIs, DB]
        A3[ğŸ“± Social Agent<br/>Loop: Reason-Act-Observe<br/>Tools: Social APIs]
    end
    
    %% Peer-to-peer
    A1 <-.->|P2P Communication| A2
    A2 <-.->|P2P Communication| A3
    A1 <-.->|P2P Communication| A3
    
    %% Results back
    A1 -->|Result| Chief
    A2 -->|Result| Chief
    A3 -->|Result| Chief
    
    %% Chief can request more
    Chief -.->|Request Details| A1
    Chief -.->|Clarify| A2
    
    Chief --> Synthesize[Synthesize & Report]
    Synthesize --> Final([Final Output])
    
    style Chief fill:#ff6f00,color:#fff,stroke:#e65100,stroke-width:3px
    style A1 fill:#2196f3,color:#fff
    style A2 fill:#4caf50,color:#fff
    style A3 fill:#9c27b0,color:#fff
    style Agents fill:#f5f5f5,stroke:#9e9e9e,stroke-width:2px,stroke-dasharray: 5 5
    
    linkStyle 0,1,2 stroke:#757575,stroke-width:1px,stroke-dasharray: 3 3
    linkStyle 3,4,5 stroke:#f44336,stroke-width:2px,stroke-dasharray: 5 5
    linkStyle 9,10 stroke:#2196f3,stroke-width:1px,stroke-dasharray: 3 3
```

![SÆ¡ Ä‘á»“ luá»“ng Agent phá»©c táº¡p](complex_agent_flow.png)

*   **Luá»“ng hoáº¡t Ä‘á»™ng:**
    1.  **Má»¥c tiÃªu:** Má»™t Product Manager Ä‘Æ°a ra yÃªu cáº§u cho **Agent TrÆ°á»Ÿng nhÃ³m (Chief Researcher)**: "PhÃ¢n tÃ­ch thá»‹ trÆ°á»ng protein thá»±c váº­t á»Ÿ ÄÃ´ng Nam Ã."
    2.  **PhÃ¢n rÃ£ & Giao viá»‡c:** Agent TrÆ°á»Ÿng nhÃ³m khÃ´ng tá»± lÃ m. NÃ³ phÃ¢n rÃ£ má»¥c tiÃªu thÃ nh cÃ¡c nhiá»‡m vá»¥ con vÃ  giao cho cÃ¡c agent chuyÃªn biá»‡t:
        *   Giao cho **Agent PhÃ¢n tÃ­ch Dá»¯ liá»‡u**: "TÃ¬m cÃ¡c bÃ i bÃ¡o, tin tá»©c, vÃ  bÃ¡o cÃ¡o thá»‹ trÆ°á»ng."
        *   Giao cho **Agent PhÃ¢n tÃ­ch TÃ i chÃ­nh**: "TÃ¬m thÃ´ng tin vá» cÃ¡c vÃ²ng gá»i vá»‘n cá»§a cÃ¡c cÃ´ng ty chá»§ chá»‘t."
        *   Giao cho **Agent PhÃ¢n tÃ­ch Máº¡ng xÃ£ há»™i**: "PhÃ¢n tÃ­ch cáº£m xÃºc cá»§a ngÆ°á»i tiÃªu dÃ¹ng trÃªn Twitter vÃ  Reddit."
    3.  **Thá»±c thi song song:** Cáº£ ba agent chuyÃªn biá»‡t báº¯t Ä‘áº§u lÃ m viá»‡c cÃ¹ng má»™t lÃºc, sá»­ dá»¥ng cÃ¡c cÃ´ng cá»¥ riÃªng cá»§a chÃºng (Web Search, Crunchbase API, Social Media API).
    4.  **Tá»•ng há»£p:** Khi cÃ¡c agent chuyÃªn biá»‡t hoÃ n thÃ nh, chÃºng gá»­i káº¿t quáº£ trá»Ÿ láº¡i cho Agent TrÆ°á»Ÿng nhÃ³m.
    5.  **HoÃ n thÃ nh:** Agent TrÆ°á»Ÿng nhÃ³m nháº­n táº¥t cáº£ cÃ¡c máº£nh thÃ´ng tin, Ä‘á»c, hiá»ƒu, vÃ  viáº¿t thÃ nh má»™t bÃ¡o cÃ¡o tá»•ng há»£p duy nháº¥t, máº¡ch láº¡c.

*   **Äáº·c Ä‘iá»ƒm kiáº¿n trÃºc:**
    *   **PhÃ¢n tÃ¡n:** KhÃ´ng cÃ³ Ä‘iá»ƒm kiá»ƒm soÃ¡t trung tÃ¢m duy nháº¥t.
    *   **ChuyÃªn mÃ´n hÃ³a cao:** Má»—i agent lÃ  má»™t chuyÃªn gia trong lÄ©nh vá»±c cá»§a mÃ¬nh.
    *   **Giao tiáº¿p ngang hÃ ng:** CÃ¡c agent cÃ³ thá»ƒ giao tiáº¿p trá»±c tiáº¿p vá»›i nhau (vÃ­ dá»¥: Agent PhÃ¢n tÃ­ch Dá»¯ liá»‡u cÃ³ thá»ƒ há»i Agent PhÃ¢n tÃ­ch TÃ i chÃ­nh vá» má»™t cÃ´ng ty mÃ  nÃ³ tÃ¬m tháº¥y).
    *   **HÃ nh vi ná»•i hiá»‡n:** Káº¿t quáº£ cuá»‘i cÃ¹ng lÃ  sáº£n pháº©m cá»§a sá»± há»£p tÃ¡c, khÃ´ng pháº£i lÃ  má»™t ká»‹ch báº£n Ä‘Æ°á»£c Ä‘á»‹nh trÆ°á»›c.

#### 7.2. VÃ­ dá»¥ thá»±c táº¿

*   **Tá»‘i Æ°u hÃ³a chuá»—i cung á»©ng (Uber/Grab):** Má»™t agent Ä‘áº¡i diá»‡n cho má»—i tÃ i xáº¿, má»™t agent Ä‘áº¡i diá»‡n cho má»—i hÃ nh khÃ¡ch. CÃ¡c agent nÃ y liÃªn tá»¥c giao tiáº¿p Ä‘á»ƒ tÃ¬m ra sá»± káº¿t há»£p tá»‘i Æ°u nháº¥t giá»¯a cung vÃ  cáº§u trong thá»i gian thá»±c.
*   **MÃ´ phá»ng thá»‹ trÆ°á»ng tÃ i chÃ­nh:** Má»—i agent Ä‘Ã³ng vai má»™t nhÃ  Ä‘áº§u tÆ° vá»›i má»™t chiáº¿n lÆ°á»£c riÃªng. Há»‡ thá»‘ng cháº¡y mÃ´ phá»ng Ä‘á»ƒ xem cÃ¡c chiáº¿n lÆ°á»£c nÃ y tÆ°Æ¡ng tÃ¡c vá»›i nhau nhÆ° tháº¿ nÃ o vÃ  tÃ¡c Ä‘á»™ng Ä‘áº¿n thá»‹ trÆ°á»ng ra sao.
*   **PhÃ¡t triá»ƒn pháº§n má»m tá»± Ä‘á»™ng:** Má»™t agent "Product Manager" viáº¿t yÃªu cáº§u, má»™t agent "Developer" viáº¿t code, má»™t agent "QA" viáº¿t vÃ  cháº¡y test. ChÃºng lÃ m viá»‡c cÃ¹ng nhau trong má»™t vÃ²ng láº·p Ä‘á»ƒ táº¡o ra pháº§n má»m.

#### 7.3. ThÃ¡ch thá»©c: Phá»©c táº¡p á»Ÿ quy mÃ´ lá»›n

Kiáº¿n trÃºc Choreography cá»±c ká»³ máº¡nh máº½ nhÆ°ng cÅ©ng vÃ´ cÃ¹ng phá»©c táº¡p Ä‘á»ƒ thiáº¿t káº¿ vÃ  gá»¡ lá»—i. CÃ¡c thÃ¡ch thá»©c chÃ­nh bao gá»“m:

*   **Giao tiáº¿p:** LÃ m tháº¿ nÃ o Ä‘á»ƒ cÃ¡c agent giao tiáº¿p hiá»‡u quáº£ vÃ  khÃ´ng bá»‹ "nhiá»…u" thÃ´ng tin?
*   **Giáº£i quyáº¿t xung Ä‘á»™t:** Äiá»u gÃ¬ xáº£y ra khi hai agent cÃ³ Ã½ kiáº¿n trÃ¡i ngÆ°á»£c nhau?
*   **Ghi nháº­n cÃ´ng lao (Credit Assignment):** Khi há»‡ thá»‘ng thÃ nh cÃ´ng, lÃ m tháº¿ nÃ o Ä‘á»ƒ biáº¿t agent nÃ o Ä‘Ã£ Ä‘Ã³ng gÃ³p nhiá»u nháº¥t?
*   **Kháº£ nÄƒng quan sÃ¡t:** Viá»‡c theo dÃµi vÃ  hiá»ƒu Ä‘Æ°á»£c luá»“ng suy nghÄ© cá»§a má»™t há»‡ thá»‘ng phÃ¢n tÃ¡n nhÆ° váº­y lÃ  má»™t bÃ i toÃ¡n cá»±c ká»³ khÃ³.

Do Ä‘Ã³, kiáº¿n trÃºc nÃ y hiá»‡n chá»§ yáº¿u Ä‘Æ°á»£c sá»­ dá»¥ng trong cÃ¡c mÃ´i trÆ°á»ng nghiÃªn cá»©u hoáº·c cÃ¡c á»©ng dá»¥ng ráº¥t chuyÃªn biá»‡t, cÃ³ giÃ¡ trá»‹ cá»±c cao cá»§a cÃ¡c cÃ´ng ty cÃ´ng nghá»‡ lá»›n.

---

*Káº¿t thÃºc Pháº§n II. ChÃºng ta Ä‘Ã£ khÃ¡m phÃ¡ bá»‘n loáº¡i kiáº¿n trÃºc agent chÃ­nh. Giá» Ä‘Ã¢y, báº¡n Ä‘Ã£ cÃ³ má»™t "la bÃ n" Ä‘á»ƒ Ä‘á»‹nh vá»‹ cÃ¡c loáº¡i bÃ i toÃ¡n khÃ¡c nhau. Trong Pháº§n III, chÃºng ta sáº½ báº¯t Ä‘áº§u hÃ nh trÃ¬nh thá»±c táº¿: xÃ¢y dá»±ng cÃ¡c agent thuá»™c cÃ¡c quadrant nÃ y thÃ´ng qua má»™t lá»™ trÃ¬nh chi tiáº¿t vá»›i code máº«u.*

```mermaid
graph TB
    subgraph Q1[QUADRANT 1: INSTRUCTION]
        Q1_Input[Input] --> Q1_LLM[LLM<br/>Single Shot]
        Q1_LLM --> Q1_Tool[1 Tool]
        Q1_Tool --> Q1_Output[Output]
    end
    
    subgraph Q2[QUADRANT 2: ORCHESTRATION]
        Q2_Orch{Orchestrator}
        Q2_Orch --> Q2_A1[Agent 1]
        Q2_Orch --> Q2_A2[Agent 2]
        Q2_Orch --> Q2_A3[Agent 3]
        Q2_A1 --> Q2_Orch
        Q2_A2 --> Q2_Orch
        Q2_A3 --> Q2_Orch
    end
    
    subgraph Q3[QUADRANT 3: AUTONOMY]
        Q3_Goal[Goal] --> Q3_Loop((ReAct<br/>Loop))
        Q3_Loop --> Q3_Reason[Reason]
        Q3_Reason --> Q3_Act[Act]
        Q3_Act --> Q3_Observe[Observe]
        Q3_Observe --> Q3_Loop
        Q3_Loop --> Q3_Output[Output]
    end
    
    subgraph Q4[QUADRANT 4: CHOREOGRAPHY]
        Q4_Chief[Chief Agent]
        Q4_Chief -.-> Q4_A1[Agent 1]
        Q4_Chief -.-> Q4_A2[Agent 2]
        Q4_Chief -.-> Q4_A3[Agent 3]
        Q4_A1 -.-> Q4_A2
        Q4_A2 -.-> Q4_A3
        Q4_A1 --> Q4_Chief
        Q4_A2 --> Q4_Chief
        Q4_A3 --> Q4_Chief
    end
    
    style Q1 fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    style Q2 fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    style Q3 fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style Q4 fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    
    style Q1_LLM fill:#fff9c4
    style Q2_Orch fill:#ff9800,color:#fff
    style Q3_Loop fill:#ff5722,color:#fff
    style Q4_Chief fill:#e91e63,color:#fff
```




---

# Demo Cursor 




## 3.1 Luá»“ng Ä‘Æ¡n giáº£n

```mermaid
flowchart TD
    U[Developer IDE Cursor] --> A[Cursor Agent Orchestrator]

    subgraph PERCEPTION
        A --> B1[Collect Context: active file, selection, cursor]
        B1 --> B2[Repo Analyzer: project tree, symbols, references]
        B2 --> B3[Collect Signals: test failures, lint errors, git diff]
    end

    B3 --> C[Agent State: messages plus repo context]

    subgraph LOOP
        C --> D[Reason Step: LLM decides next actions]
        D --> E{Has tool call}
        E --> F[Propose Changes: plan and code edits]
        E --> G[Tool Execution Layer]

        subgraph TOOLS
            G --> T1[read_file path]
            G --> T2[search_in_repo query]
            G --> T3[apply_diff]
            G --> T4[run_tests pattern]
            G --> T5[project_graph info]
        end

        T1 --> H[Observe Result from tools]
        T2 --> H
        T3 --> H
        T4 --> H
        T5 --> H

        H --> I[Update Agent State with tool results]
        I --> D
    end

    F --> J[Quality and Safety Check]
    J --> C
    J --> K[Present Patch in IDE]

    K --> L[Developer Decision]
    L --> M[Accept and apply changes]
    L --> N[Edit patch manually]
    L --> O[Reject patch]

    M --> P[Optional: run tests again]
    P --> Q{Tests pass}
    Q --> C
    Q --> S[Done]

```

```mermaid
flowchart TD
    U([ğŸ‘¨â€ğŸ’» Developer IDE Cursor<br/>'Fix this bug']) --> A[Agent Orchestrator]

    subgraph PERCEPTION["ğŸ” PERCEPTION LAYER"]
        A --> B1[ğŸ“¥ Collect Context<br/>active file, selection, cursor]
        B1 --> B2[ğŸ” Repo Analyzer<br/>project tree, symbols, references]
        B2 --> B3[ğŸ“Š Collect Signals<br/>test failures, lint errors, git diff]
    end

    B3 --> C[ğŸ’¾ Agent State<br/>messages + repo context]

    subgraph COGNITION["ğŸ§  COGNITION LAYER - ReAct Loop"]
        C --> D[ğŸ’¡ Reason Step<br/>LLM decides next actions]
        D --> E{ğŸ¤” Has<br/>tool call?}
        E -->|No - Ready| F[ğŸ“‹ Propose Changes<br/>plan and code edits]
        E -->|Yes - Need more| G[ğŸ¯ Tool Selection]

        subgraph ACTION["âš¡ ACTION LAYER"]
            G --> TOOLS[Tool Execution]
            
            subgraph TOOLS_SUB[Domain Tools]
                T1[ğŸ” read_file<br/>path]
                T2[ğŸ” search_in_repo<br/>query]
                T3[âœï¸ apply_diff]
                T4[ğŸ§ª run_tests<br/>pattern]
                T5[ğŸ“Š project_graph<br/>info]
            end
            
            TOOLS --> T1
            TOOLS --> T2
            TOOLS --> T3
            TOOLS --> T4
            TOOLS --> T5

            T1 --> H[ğŸ‘ï¸ Observe Results]
            T2 --> H
            T3 --> H
            T4 --> H
            T5 --> H
        end

        H --> I[ğŸ”„ Update Agent State<br/>with tool results]
        I --> D
    end

    subgraph GOVERNANCE["ğŸ›¡ï¸ GOVERNANCE LAYER"]
        F --> J[âš–ï¸ Quality & Safety Check<br/>syntax, scope, tests]
        J -.->|Need refinement| C
        J --> K[ğŸ–¥ï¸ Present Patch in IDE<br/>show diff + explanation]

        K --> L{ğŸ‘¤ Developer<br/>Decision}
        L --> M[âœ… Accept<br/>apply changes]
        L --> N[âœï¸ Edit<br/>manually]
        L --> O[âŒ Reject]
    end

    M --> P[ğŸ§ª Optional:<br/>run tests again]
    P --> Q{Tests<br/>pass?}
    Q -->|Fail| C
    Q -->|Pass| S([âœ¨ Done])
    N --> S
    O --> S

    %% Styling - Layers vá»›i mÃ u gradient/metallic
    style PERCEPTION fill:#e3f2fd,stroke:#1565c0,stroke-width:4px,color:#000
    style COGNITION fill:#fff9c4,stroke:#f57f00,stroke-width:4px,color:#000
    style ACTION fill:#c8e6c9,stroke:#2e7d32,stroke-width:4px,color:#000
    style GOVERNANCE fill:#ffccbc,stroke:#bf360c,stroke-width:4px,color:#000
    
    %% Styling - Perception components (Blue tones)
    style A fill:#90caf9,stroke:#1565c0,stroke-width:2px,color:#000
    style B1 fill:#64b5f6,stroke:#1976d2,stroke-width:2px,color:#fff
    style B2 fill:#42a5f5,stroke:#1565c0,stroke-width:2px,color:#fff
    style B3 fill:#2196f3,stroke:#0d47a1,stroke-width:2px,color:#fff
    
    %% Styling - Cognition components (Yellow/Orange tones)
    style C fill:#fff59d,stroke:#f9a825,stroke-width:3px,color:#000
    style D fill:#ffeb3b,stroke:#f57f00,stroke-width:2px,color:#000
    style E fill:#ffc107,stroke:#e65100,stroke-width:3px,color:#000
    style F fill:#ffb300,stroke:#e65100,stroke-width:2px,color:#000
    style G fill:#ff8f00,stroke:#e65100,stroke-width:2px,color:#fff
    style I fill:#fff59d,stroke:#f9a825,stroke-width:2px,color:#000
    
    %% Styling - Action components (Green tones)
    style TOOLS fill:#a5d6a7,stroke:#388e3c,stroke-width:2px,color:#000
    style TOOLS_SUB fill:#81c784,stroke:#2e7d32,stroke-width:2px,color:#000
    style T1 fill:#66bb6a,stroke:#2e7d32,stroke-width:1px,color:#fff
    style T2 fill:#66bb6a,stroke:#2e7d32,stroke-width:1px,color:#fff
    style T3 fill:#66bb6a,stroke:#2e7d32,stroke-width:1px,color:#fff
    style T4 fill:#66bb6a,stroke:#2e7d32,stroke-width:1px,color:#fff
    style T5 fill:#66bb6a,stroke:#2e7d32,stroke-width:1px,color:#fff
    style H fill:#4caf50,stroke:#1b5e20,stroke-width:2px,color:#fff
    
    %% Styling - Governance components (Red/Orange tones)
    style J fill:#ff8a65,stroke:#bf360c,stroke-width:2px,color:#fff
    style K fill:#ff7043,stroke:#d84315,stroke-width:2px,color:#fff
    style L fill:#ff5722,stroke:#bf360c,stroke-width:3px,color:#fff
    style M fill:#66bb6a,stroke:#2e7d32,stroke-width:2px,color:#fff
    style N fill:#42a5f5,stroke:#1565c0,stroke-width:2px,color:#fff
    style O fill:#ef5350,stroke:#c62828,stroke-width:2px,color:#fff
    style P fill:#ab47bc,stroke:#6a1b9a,stroke-width:2px,color:#fff
    style Q fill:#ffa726,stroke:#e65100,stroke-width:2px,color:#000
    
    %% Styling - Start/End (Purple/Green gradients)
    style U fill:#ce93d8,stroke:#6a1b9a,stroke-width:3px,color:#000
    style S fill:#aed581,stroke:#558b2f,stroke-width:3px,color:#000
```

### 1. Luá»“ng trÃªn Ä‘Ã£ â€œchuáº©n thá»±c táº¿â€ chÆ°a?

á» má»©c **khÃ¡i niá»‡m kiáº¿n trÃºc (highâ€‘level)**, luá»“ng Ä‘Ã³ khÃ¡ sÃ¡t vá»›i cÃ¡ch má»™t **coding agent kiá»ƒu Cursor** váº­n hÃ nh:

- CÃ³ **Orchestrator** á»Ÿ giá»¯a.
- CÃ³ bÆ°á»›c **thu tháº­p context** (file hiá»‡n táº¡i, selection, repo info, test/log).
- CÃ³ vÃ²ng **Reason â†’ Tool â†’ Observe â†’ Reason** (ReAct).
- CÃ³ lá»›p **tools**: Ä‘á»c file, search repo, apply diff, cháº¡y test, Ä‘á»c project graph.
- CÃ³ lá»›p **Quality/Safety check** trÆ°á»›c khi hiá»ƒn thá»‹ káº¿t quáº£.
- CÃ³ **Humanâ€‘inâ€‘theâ€‘loop**: dev xem diff â†’ accept/edit/reject.
- CÃ³ tÃ¹y chá»n **cháº¡y test láº¡i vÃ  láº·p** náº¿u test fail.

Äiá»ƒm cáº§n lÆ°u Ã½:

- Cursor thá»±c táº¿ cÃ³ thá»ƒ:
    - ThÃªm nhiá»u loáº¡i tool hÆ¡n (LLM chuyÃªn code, model khÃ¡c cho test, embedding index cho repo).
    - CÃ³ **multiâ€‘turn planning** â€œáº©nâ€ hÆ¡n (nhiá»u reasoning step bÃªn trong má»™t command).
    - CÃ³ thÃªm **telemetry, ranking, há»c tá»« history**, khÃ´ng thá»ƒ hiá»‡n trong diagram.
- NhÆ°ng vá»›i má»¥c tiÃªu: **dÃ¹ng nhÆ° khung tham chiáº¿u cho kiáº¿n trÃºc agent code/selfâ€‘healing cá»§a báº¡n**, thÃ¬ luá»“ng nÃ y **Ä‘á»§ Ä‘Ãºng vÃ  há»¯u Ã­ch**.

TÃ³m láº¡i:

- KhÃ´ng pháº£i â€œspec ná»™i bá»™ chÃ­nh thá»©c cá»§a Cursorâ€, nhÆ°ng **phÃ¹ há»£p vá»›i pattern SOTA cá»§a coding agent trong IDE** vÃ  cÃ³ thá»ƒ coi lÃ  **chuáº©n thá»±c táº¿ á»Ÿ má»©c kiáº¿n trÃºc** Ä‘á»ƒ dÃ¹ng trong tÃ i liá»‡u.

***

### 2. MÃ´ táº£ chi tiáº¿t luá»“ng trÃªn báº±ng lá»i

Äi theo tá»«ng khá»‘i trong diagram.

#### 2.1. Developer IDE Cursor â†’ Orchestrator

- Developer Ä‘ang á»Ÿ trong IDE (Cursor) thá»±c hiá»‡n má»™t hÃ nh Ä‘á»™ng:
    - GÃµ lá»‡nh trong command palette: â€œFix this errorâ€, â€œRefactor this functionâ€, â€œAdd loggingâ€, â€œExplain this codeâ€.
    - Hoáº·c chá»n Ä‘oáº¡n code rá»“i báº¥m má»™t phÃ­m táº¯t (vÃ­ dá»¥: â€œCmd+Kâ€).
- IDE gá»­i yÃªu cáº§u Ä‘Ã³ (command + context cÆ¡ báº£n: file hiá»‡n táº¡i, selection) tá»›i **Cursor Agent Orchestrator**.


#### 2.2. Khá»‘i PERCEPTION â€“ Thu tháº­p vÃ  xÃ¢y context

1) **Collect Context (B1)**
Orchestrator thu tháº­p context trá»±c tiáº¿p tá»« IDE:
    - File hiá»‡n táº¡i mÃ  developer Ä‘ang má»Ÿ.
    - Äoáº¡n code Ä‘ang Ä‘Æ°á»£c chá»n (selection), náº¿u cÃ³.
    - Vá»‹ trÃ­ con trá» (cursor position).
    - CÃ³ thá»ƒ kÃ¨m theo: ngÃ´n ngá»¯, framework, v.v.
2) **Repo Analyzer (B2)**
Orchestrator sá»­ dá»¥ng má»™t lá»›p phÃ¢n tÃ­ch repo Ä‘á»ƒ:
    - Äá»c **cÃ¢y project**: thÆ° má»¥c, file, module.
    - PhÃ¢n tÃ­ch **symbols \& references**: hÃ m/class Ä‘Æ°á»£c gá»i á»Ÿ Ä‘Ã¢u, Ä‘á»‹nh nghÄ©a á»Ÿ Ä‘Ã¢u.
    - XÃ¡c Ä‘á»‹nh cÃ¡c **file liÃªn quan** Ä‘áº¿n Ä‘oáº¡n code bug/feature (vÃ­ dá»¥: interface, implementation, test tÆ°Æ¡ng á»©ng).
3) **Collect Signals (B3)**
Orchestrator cÃ³ thá»ƒ gom thÃªm tÃ­n hiá»‡u phá»¥:
    - Káº¿t quáº£ test/linter má»›i nháº¥t (failures).
    - Lá»—i compile vá»«a xáº£y ra.
    - Git diff (nhá»¯ng thay Ä‘á»•i chÆ°a commit).
    - ThÃ´ng tin branch hiá»‡n táº¡i.

Táº¥t cáº£ Ä‘Æ°á»£c gom thÃ nh **Agent State ban Ä‘áº§u** (C): má»™t object chá»©a:

- messages khá»Ÿi táº¡o (system message + user command + context).
- repo metadata (file, project graph, signals).


#### 2.3. Khá»‘i LOOP â€“ Reason â€“ Act â€“ Observe

ÄÃ¢y lÃ  â€œtrÃ¡i timâ€ cá»§a Cursorâ€‘style agent.

1) **Reason Step (D)**
    - Orchestrator gá»i LLM vá»›i:
        - System prompt (vai trÃ²: coding agent).
        - Messages (user command + context + history).
        - Danh sÃ¡ch tools kháº£ dá»¥ng (read_file, search_in_repo, apply_diff, run_tests, project_graph).
    - LLM:
        - Hiá»ƒu má»¥c tiÃªu cá»§a dev.
        - Suy nghÄ© (thought) vá» nguyÃªn nhÃ¢n bug, vá»‹ trÃ­ cáº§n xem.
        - Quyáº¿t Ä‘á»‹nh:
            - CÃ³ cáº§n thÃªm thÃ´ng tin tá»« repo khÃ´ng?
            - CÃ³ thá»ƒ Ä‘á» xuáº¥t patch ngay khÃ´ng?
        - Náº¿u cáº§n tool â†’ táº¡o `tool_calls`.
2) **Branch quyáº¿t Ä‘á»‹nh (E)**
    - Náº¿u **khÃ´ng cÃ³ tool_call**:
        - Agent cho ráº±ng Ä‘Ã£ Ä‘á»§ hiá»ƒu, cÃ³ thá»ƒ **Ä‘á» xuáº¥t patch / giáº£i phÃ¡p** ngay â†’ sang F.
    - Náº¿u **cÃ³ tool_call**:
        - Agent muá»‘n **hÃ nh Ä‘á»™ng**: Ä‘á»c file khÃ¡c, search, apply diff, cháº¡y test â†’ sang G.
3) **Tool Execution Layer (G + TOOLS)**
Orchestrator Ä‘á»c danh sÃ¡ch tool_call vÃ  thá»±c thi:
    - `read_file(path)`: láº¥y ná»™i dung file trong repo (thÆ°á»ng dÃ¹ng nhiá»u Ä‘á»ƒ â€œmá»Ÿ rá»™ng contextâ€ cho LLM).
    - `search_in_repo(query)`: tÃ¬m nÆ¡i function/class Ä‘Æ°á»£c dÃ¹ng/Ä‘á»‹nh nghÄ©a; tÃ¬m pattern code; locate bug.
    - `apply_diff`: Ã¡p dá»¥ng má»™t unified diff mÃ  LLM Ä‘á» xuáº¥t vÃ o file (thÆ°á»ng trong **buffer táº¡m/sandbox**, khÃ´ng commit ngay).
    - `run_tests(pattern)`: cháº¡y test liÃªn quan hoáº·c toÃ n bá»™ suite tÃ¹y config.
    - `project_graph`: láº¥y thÃ´ng tin cáº¥u trÃºc project, dependency, entrypoint.
4) **Observe Result (H)**
    - Má»—i tool tráº£ vá» káº¿t quáº£:
        - Ná»™i dung file, snippet.
        - Vá»‹ trÃ­ tÃ¬m tháº¥y, cÃ¡c match trong repo.
        - Káº¿t quáº£ test (pass/fail, error message).
        - Káº¿t quáº£ Ã¡p dá»¥ng diff (thÃ nh cÃ´ng hay xung Ä‘á»™t).
    - CÃ¡c káº¿t quáº£ nÃ y Ä‘Æ°á»£c encode thÃ nh **tool messages** vÃ  thÃªm vÃ o Agent State.
5) **Update Agent State (I)**
    - Agent State Ä‘Æ°á»£c cáº­p nháº­t:
        - ThÃªm messages kiá»ƒu `role=tool` chá»©a káº¿t quáº£ tá»« cÃ¡c tool.
        - CÃ³ thá»ƒ cáº­p nháº­t thÃªm metadata: test Ä‘Ã£ cháº¡y, file Ä‘Ã£ chá»‰nh, vv.
    - Sau Ä‘Ã³ quay láº¡i **Reason Step D**:
        - Láº§n gá»i LLM tiáº¿p theo sáº½ â€œnhÃ¬n tháº¥yâ€ toÃ n bá»™ lá»‹ch sá»­:
            - Command ban Ä‘áº§u.
            - Thought trÆ°á»›c.
            - Tool Ä‘Ã£ gá»i.
            - Káº¿t quáº£ tool.
        - DÃ¹ng Ä‘Ã³ Ä‘á»ƒ:
            - Äiá»u chá»‰nh â€œgiáº£ thuyáº¿tâ€ bug.
            - Äá» xuáº¥t patch má»›i hoáº·c Ä‘á»c thÃªm file.
    - VÃ²ng nÃ y láº·p **nhiá»u láº§n** cho Ä‘áº¿n khi agent cáº£m tháº¥y Ä‘á»§ Ä‘á»ƒ Ä‘á» xuáº¥t solution.

#### 2.4. Khá»‘i F â€“ Quality \& Safety Check

Khi branch á»Ÿ E Ä‘i vÃ o **F (Propose Changes)**:

- LLM sinh output á»Ÿ dáº¡ng:
    - MÃ´ táº£ plainâ€‘text:
        - NguyÃªn nhÃ¢n bug.
        - Chiáº¿n lÆ°á»£c sá»­a.
    - Code edits / diff:
        - CÃ³ thá»ƒ lÃ  patch má»™t file.
        - Hoáº·c nhiá»u file liÃªn quan.
- TrÆ°á»›c khi hiá»ƒn thá»‹ cho dev, Orchestrator cháº¡y má»™t **layer Ä‘Ã¡nh giÃ¡**:
    - Patch cÃ³ há»£p lá»‡ vá» syntax, compile Ä‘Æ°á»£c khÃ´ng? (option).
    - Patch cÃ³ vÆ°á»£t quÃ¡ scope (sá»­a quÃ¡ nhiá»u file, thay Ä‘á»•i interface lá»›n) khÃ´ng?
    - CÃ³ vi pháº¡m policy/guardrail (xÃ³a file, cháº¡m vÃ o vÃ¹ng nháº¡y cáº£m) khÃ´ng?

Náº¿u tháº¥y cáº§n refine, Orchestrator cÃ³ thá»ƒ:

- ThÃªm message kiá»ƒu â€œsystem/user feedbackâ€ vÃ o state:
â€œPatch quÃ¡ lá»›n, hÃ£y Ä‘á» xuáº¥t chá»‰nh nhá» hÆ¡n, táº­p trung vÃ o function X.â€
- Quay láº¡i **C (Agent State)** â†’ vÃ²ng Reasonâ€“Actâ€“Observe láº·p thÃªm má»™t/ vÃ i lÆ°á»£t.

Náº¿u acceptable â†’ sang K.

#### 2.5. Khá»‘i K â€“ Present Patch in IDE

- Orchestrator gá»­i patch/diff + explanation vá» IDE (Cursor).
- IDE hiá»ƒn thá»‹:
    - Inline diff trong file.
    - Danh sÃ¡ch file thay Ä‘á»•i.
    - Cá»­a sá»• giáº£i thÃ­ch (Agent Panel / Chat Panel).

Dev tháº¥y Ä‘Æ°á»£c:

- Sá»± khÃ¡c biá»‡t trÆ°á»›c/sau (diff).
- LÃ½ do agent sá»­a nhÆ° váº­y.


#### 2.6. Human-in-the-loop â€“ Developer Decision (L)

Developer cÃ³ 3 lá»±a chá»n chÃ­nh:

1) **Accept (M)**
    - IDE Ã¡p dá»¥ng patch vÃ o filesystem:
        - Ghi file má»›i.
        - CÃ³ thá»ƒ stage vÃ o git (tuá»³ config).
    - ÄÃ¢y lÃ  Ä‘iá»ƒm mÃ  code thá»±c sá»± Ä‘Æ°á»£c thay Ä‘á»•i.
2) **Edit patch (N)**
    - Dev tá»± chá»‰nh sá»­a patch theo Ã½.
    - Sau Ä‘Ã³:
        - CÃ³ thá»ƒ gá»i láº¡i agent Ä‘á»ƒ â€œtiáº¿p tá»¥câ€ tá»« tráº¡ng thÃ¡i má»›i.
        - Hoáº·c cháº¡y test thá»§ cÃ´ng.
3) **Reject (O)**
    - Patch bá»‹ bá».
    - History agent váº«n Ä‘Æ°á»£c giá»¯ (telemetry, log) Ä‘á»ƒ cáº£i thiá»‡n model trong tÆ°Æ¡ng lai.

#### 2.7. Optional: cháº¡y test láº¡i vÃ  láº·p (M â†’ P â†’ Q â†’ C/S)

Náº¿u báº­t cháº¿ Ä‘á»™ â€œauto testâ€:

- Sau khi patch Ä‘Æ°á»£c **accept**:
    - Orchestrator hoáº·c IDE kÃ­ch hoáº¡t tool `run_tests(pattern)` (P).
- Dá»±a vÃ o káº¿t quáº£ test (Q):
    - Náº¿u **fail**:
        - Gá»­i error/test output trá»Ÿ láº¡i Agent State (C).
        - VÃ²ng Reasonâ€“Actâ€“Observe láº·p láº¡i:
            - Agent phÃ¢n tÃ­ch vÃ¬ sao patch fail,
            - Äá» xuáº¥t chá»‰nh sá»­a tiáº¿p.
    - Náº¿u **pass**:
        - Flow káº¿t thÃºc á»Ÿ **S (Done)**:
            - Bug Ä‘Æ°á»£c fix vÃ  test pass.

***

Náº¿u báº¡n muá»‘n, bÆ°á»›c tiáº¿p theo cÃ³ thá»ƒ:

- ÄÆ°a luá»“ng nÃ y vÃ o tÃ i liá»‡u cá»§a báº¡n nhÆ° **â€œCursor-style Coding Agent Architectureâ€**.
- Rá»“i bÃªn cáº¡nh lÃ  **â€œSelf-Healing Infra Agent Architectureâ€**, Ä‘á»ƒ so sÃ¡nh hai loáº¡i agent code: má»™t cháº¡y trong IDE (Cursor), má»™t cháº¡y trong production (self-healing platform).






---




